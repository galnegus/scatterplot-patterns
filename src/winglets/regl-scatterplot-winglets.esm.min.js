/* eslint-disable */
const VERSION="0.0.1";import createPubSub from"pub-sub-es";import createOriginalRegl from"regl";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,degree=Math.PI/180;function create$2(){var e=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function create$3(){var e=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone$3(e){var t=new ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function invert$3(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],y=t[15],m=r*s-n*a,b=r*l-o*a,_=r*u-i*a,A=n*l-o*s,T=n*u-i*s,w=o*u-i*l,E=c*v-h*d,S=c*g-f*d,L=c*y-p*d,x=h*g-f*v,O=h*y-p*v,$=f*y-p*g,C=m*$-b*O+_*x+A*L-T*S+w*E;return C?(C=1/C,e[0]=(s*$-l*O+u*x)*C,e[1]=(o*O-n*$-i*x)*C,e[2]=(v*w-g*T+y*A)*C,e[3]=(f*T-h*w-p*A)*C,e[4]=(l*L-a*$-u*S)*C,e[5]=(r*$-o*L+i*S)*C,e[6]=(g*_-d*w-y*b)*C,e[7]=(c*w-f*_+p*b)*C,e[8]=(a*O-s*L+u*E)*C,e[9]=(n*L-r*O-i*E)*C,e[10]=(d*T-v*_+y*m)*C,e[11]=(h*_-c*T-p*m)*C,e[12]=(s*S-a*x-l*E)*C,e[13]=(r*x-n*S+o*E)*C,e[14]=(v*b-d*A-g*m)*C,e[15]=(c*A-h*b+f*m)*C,e):null}function multiply$3(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],y=t[14],m=t[15],b=r[0],_=r[1],A=r[2],T=r[3];return e[0]=b*n+_*s+A*h+T*v,e[1]=b*o+_*l+A*f+T*g,e[2]=b*i+_*u+A*p+T*y,e[3]=b*a+_*c+A*d+T*m,b=r[4],_=r[5],A=r[6],T=r[7],e[4]=b*n+_*s+A*h+T*v,e[5]=b*o+_*l+A*f+T*g,e[6]=b*i+_*u+A*p+T*y,e[7]=b*a+_*c+A*d+T*m,b=r[8],_=r[9],A=r[10],T=r[11],e[8]=b*n+_*s+A*h+T*v,e[9]=b*o+_*l+A*f+T*g,e[10]=b*i+_*u+A*p+T*y,e[11]=b*a+_*c+A*d+T*m,b=r[12],_=r[13],A=r[14],T=r[15],e[12]=b*n+_*s+A*h+T*v,e[13]=b*o+_*l+A*f+T*g,e[14]=b*i+_*u+A*p+T*y,e[15]=b*a+_*c+A*d+T*m,e}function fromTranslation$2(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromScaling$3(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation$3(e,t,r){var n,o,i,a=r[0],s=r[1],l=r[2],u=Math.sqrt(a*a+s*s+l*l);return u<EPSILON?null:(a*=u=1/u,s*=u,l*=u,n=Math.sin(t),i=1-(o=Math.cos(t)),e[0]=a*a*i+o,e[1]=s*a*i+l*n,e[2]=l*a*i-s*n,e[3]=0,e[4]=a*s*i-l*n,e[5]=s*s*i+o,e[6]=l*s*i+a*n,e[7]=0,e[8]=a*l*i+s*n,e[9]=s*l*i-a*n,e[10]=l*l*i+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function getTranslation(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function getScaling(e,t){var r=t[0],n=t[1],o=t[2],i=t[4],a=t[5],s=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+n*n+o*o),e[1]=Math.sqrt(i*i+a*a+s*s),e[2]=Math.sqrt(l*l+u*u+c*c),e}function create$4(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function length(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function fromValues$4(e,t,r){var n=new ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=r,n}function normalize(e,t){var r=t[0],n=t[1],o=t[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],l=r[2];return e[0]=o*l-i*s,e[1]=i*a-n*l,e[2]=n*s-o*a,e}var len=length,forEach=function(){var e=create$4();return function(t,r,n,o,i,a){var s=void 0,l=void 0;for(r||(r=3),n||(n=0),l=o?Math.min(o*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],i(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();function create$5(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function normalize$1(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r*r+n*n+o*o+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=n*a,e[2]=o*a,e[3]=i*a),e}function transformMat4$1(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3];return e[0]=r[0]*n+r[4]*o+r[8]*i+r[12]*a,e[1]=r[1]*n+r[5]*o+r[9]*i+r[13]*a,e[2]=r[2]*n+r[6]*o+r[10]*i+r[14]*a,e[3]=r[3]*n+r[7]*o+r[11]*i+r[15]*a,e}var forEach$1=function(){var e=create$5();return function(t,r,n,o,i,a){var s=void 0,l=void 0;for(r||(r=4),n||(n=0),l=o?Math.min(o*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function create$6(){var e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function setAxisAngle(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function slerp(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=t[3],l=r[0],u=r[1],c=r[2],h=r[3],f=void 0,p=void 0,d=void 0,v=void 0,g=void 0;return(p=o*l+i*u+a*c+s*h)<0&&(p=-p,l=-l,u=-u,c=-c,h=-h),1-p>EPSILON?(f=Math.acos(p),d=Math.sin(f),v=Math.sin((1-n)*f)/d,g=Math.sin(n*f)/d):(v=1-n,g=n),e[0]=v*o+g*l,e[1]=v*i+g*u,e[2]=v*a+g*c,e[3]=v*s+g*h,e}function fromMat3(e,t){var r=t[0]+t[4]+t[8],n=void 0;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var o=0;t[4]>t[0]&&(o=1),t[8]>t[3*o+o]&&(o=2);var i=(o+1)%3,a=(o+2)%3;n=Math.sqrt(t[3*o+o]-t[3*i+i]-t[3*a+a]+1),e[o]=.5*n,n=.5/n,e[3]=(t[3*i+a]-t[3*a+i])*n,e[i]=(t[3*i+o]+t[3*o+i])*n,e[a]=(t[3*a+o]+t[3*o+a])*n}return e}var normalize$2=normalize$1,rotationTo=function(){var e=create$4(),t=fromValues$4(1,0,0),r=fromValues$4(0,1,0);return function(n,o,i){var a=dot(o,i);return a<-.999999?(cross(e,t,o),len(e)<1e-6&&cross(e,r,o),normalize(e,e),setAxisAngle(n,e,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(cross(e,o,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+a,normalize$2(n,n))}}(),sqlerp=function(){var e=create$6(),t=create$6();return function(r,n,o,i,a,s){return slerp(e,n,a,s),slerp(t,o,i,s),slerp(r,e,t,2*s*(1-s)),r}}(),setAxes=function(){var e=create$2();return function(t,r,n,o){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],normalize$2(t,fromMat3(t,e))}}();function create$8(){var e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function angle$1(e,t){var r=e[0],n=e[1],o=t[0],i=t[1],a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));var s=o*o+i*i;s>0&&(s=1/Math.sqrt(s));var l=(r*o+n*i)*a*s;return l>1?0:l<-1?Math.PI:Math.acos(l)}var forEach$2=function(){var e=create$8();return function(t,r,n,o,i,a){var s=void 0,l=void 0;for(r||(r=2),n||(n=0),l=o?Math.min(o*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],i(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}();const VIEW_CENTER=[0,0,0,1],createCamera=(e=[0,0],t=1,r=0)=>{const n=new Float32Array(16),o=new Float32Array(16),i=new Float32Array(16);let a=create$3();const s=()=>getScaling(n,a)[0],l=([e=0,t=0]=[],r=1,n=0)=>{a=create$3(),u([-e,-t]),h(n),c(1/r)},u=([e=0,t=0]=[])=>{n[0]=e,n[1]=t,n[2]=0;const r=fromTranslation$2(o,n);multiply$3(a,r,a)},c=(e,t)=>{if(e<=0)return;n[0]=e,n[1]=e,n[2]=1;const r=fromScaling$3(o,n),s=t?[...t,0]:VIEW_CENTER,l=fromTranslation$2(n,s);multiply$3(a,l,multiply$3(a,r,multiply$3(a,invert$3(i,l),a)))},h=e=>{const t=create$3();fromRotation$3(t,e,[0,0,1]),multiply$3(a,t,a)};return l(e,t,r),{get translation(){return(()=>getTranslation(n,a).slice(0,2))()},get target(){return(()=>transformMat4$1(n,VIEW_CENTER,invert$3(i,a)))()},get scaling(){return s()},get distance(){return(()=>1/s())()},get rotation(){return(()=>Math.acos(a[0]))()},get view(){return(()=>a)()},lookAt:l,translate:u,pan:u,rotate:h,scale:c,zoom:c,reset:()=>{l(e,t,r)},set:e=>{!e||e.length<16||(a=e)}}},down={},isKeyDown=e=>e?down[e]:down,reset=()=>{Object.keys(down).forEach(e=>{down[e]=!1})},keyup=({key:e})=>{down[e]=!1},keydown=({key:e})=>{down[e]=!0};function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}reset(),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("blur",reset,!1);var events=EventEmitter;function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,n,o,i,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}if(isUndefined(r=this._events[e]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(isObject(r))for(o=Array.prototype.slice.call(arguments,1),n=(a=r.slice()).length,i=0;i<n;i++)a[i].apply(this,o);return!0},EventEmitter.prototype.addListener=function(e,t){var r;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,i;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,n=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=o;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};var mousePosition=attach;function attach(e,t){var r=new events;if(r[0]=0,r[1]=0,r.prev=[0,0],r.flush=function(){r.prev[0]=r[0],r.prev[1]=r[1]},r.dispose=function(){r.removeAllListeners("move"),t.removeEventListener("mousemove",n)},"undefined"==typeof window)return r;t=t||e||window;var n=(e=e||document.body)===document.body||e===window?function(e){r.prev[0]=r[0],r.prev[1]=r[1],r[0]=e.clientX,r[1]=e.clientY,r.emit("move",e)}:function(t){r.prev[0]=r[0],r.prev[1]=r[1];var n=e.getBoundingClientRect();r[0]=t.clientX-n.left,r[1]=t.clientY-n.top,r.emit("move",t)};return t.addEventListener("mousemove",n,!1),r}var map=["left","middle","right"],mousePressed=pressed;function pressed(e,t){var r=new events;return r.left=!1,r.right=!1,r.middle=!1,r.dispose=function(){r.left=!1,r.right=!1,r.middle=!1,e&&(e.removeEventListener("contextmenu",i,!1),e.removeEventListener("mousedown",n,!1),window.removeEventListener("mouseup",o,!1))},"undefined"!=typeof window&&((e=e||window).addEventListener("mousedown",n,!1),window.addEventListener("mouseup",o,!1),t&&e.addEventListener("contextmenu",i,!1)),r;function n(e){if(r.right=!1,r[map[e.button]]=!0,r.emit("down",e),t){if(!e.preventDefault)return!1;e.preventDefault(),e.stopPropagation()}}function o(e){r.right=!1,r[map[e.button]]=!1,r.emit("up",e),t&&e.preventDefault&&(e.preventDefault(),e.stopPropagation())}function i(e){return e.preventDefault&&e.preventDefault()&&!1}}var _addEventListener,_removeEventListener,support,wheel=addWheelListener,addWheelListener_1=addWheelListener,removeWheelListener_1=removeWheelListener,prefix="";function addWheelListener(e,t,r){_addWheelListener(e,support,t,r),"DOMMouseScroll"==support&&_addWheelListener(e,"MozMousePixelScroll",t,r)}function removeWheelListener(e,t,r){_removeWheelListener(e,support,t,r),"DOMMouseScroll"==support&&_removeWheelListener(e,"MozMousePixelScroll",t,r)}function _addWheelListener(e,t,r,n){e[_addEventListener](prefix+t,"wheel"==support?r:function(e){!e&&(e=window.event);var t={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,deltaY:0,deltaZ:0,clientX:e.clientX,clientY:e.clientY,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){e.stopImmediatePropagation&&e.stopImmediatePropagation()}};return"mousewheel"==support?(t.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(t.deltaX=-.025*e.wheelDeltaX)):t.deltaY=e.detail,r(t)},n||!1)}function _removeWheelListener(e,t,r,n){e[_removeEventListener](prefix+t,r,n||!1)}function detectEventModel(e,t){e&&e.addEventListener?(_addEventListener="addEventListener",_removeEventListener="removeEventListener"):(_addEventListener="attachEvent",_removeEventListener="detachEvent",prefix="on"),support=t?"onwheel"in t.createElement("div")?"wheel":void 0!==t.onmousewheel?"mousewheel":"DOMMouseScroll":"wheel"}detectEventModel("undefined"!=typeof window&&window,"undefined"!=typeof document&&document),wheel.addWheelListener=addWheelListener_1,wheel.removeWheelListener=removeWheelListener_1;var addWheelListener$1=wheel.addWheelListener,removeWheelListener$1=wheel.removeWheelListener,scrollSpeed=getScroller;function getScroller(e,t){var r=new events;return r.flush=n,r.dispose=function(){removeWheelListener$1(e,o,!1)},n(),"undefined"==typeof window?r:(e=e||window,addWheelListener$1(e,o,!1),r);function n(){r[0]=r[1]=r[2]=0}function o(e){var n=1===e.deltaMode?12:1;r[0]+=n*(e.deltaX||0),r[1]+=n*(e.deltaY||0),r[2]+=n*(e.deltaZ||0),r.emit("scroll",r),t&&e.preventDefault&&(e.preventDefault(),e.stopPropagation&&e.stopPropagation())}}const canvas2dCamera=(e,{distance:t=1,target:r=[0,0],rotation:n=0,isFixed:o=!1,isPan:i=!0,panSpeed:a=1,isRotate:s=!0,rotateSpeed:l=1,isZoom:u=!0,zoomSpeed:c=1}={})=>{let h=createCamera(r,t,n),f=!1,p=mousePosition(e),d=mousePressed(e),v=scrollSpeed(e,u),g=e.height/window.devicePixelRatio,y=e.width/window.devicePixelRatio,m=y/g,b=!1;return h.config=(({isFixed:e=null,isPan:t=null,isRotate:r=null,isZoom:n=null,panSpeed:h=null,rotateSpeed:f=null,zoomSpeed:p=null}={})=>{o=null!==e?e:o,i=null!==t?t:i,s=null!==r?r:s,u=null!==n?n:u,a=+h>0?h:a,l=+f>0?f:l,c=+p>0?p:c}),h.dispose=(()=>{v.dispose(),d.dispose(),p.dispose(),h=void 0,v=void 0,d=void 0,p=void 0}),h.refresh=(()=>{g=e.height/window.devicePixelRatio,y=e.width/window.devicePixelRatio,m=y/g}),h.tick=(()=>{if(o)return!1;b=isKeyDown("Alt"),f=!1;const{0:e,1:t}=p,{0:r,1:n}=p.prev;if(i&&d.left&&!b&&(h.pan([a*(e-r)/y*2*m,a*(n-t)/g*2]),f=!0),u&&v[1]){const r=c*Math.exp(v[1]/g),n=(e/y*2-1)*m,o=1-t/g*2;h.scale(1/r,[n,o]),f=!0}if(s&&d.left&&b){const o=y/2,i=g/2,a=r-o,s=i-n,u=e-o,c=i-t,p=angle$1([a,s],[u,c]),d=a*c-u*s;h.rotate(l*p*Math.sign(d)),f=!0}return v.flush(),p.flush(),f}),h};function sortKD(e,t,r,n,o,i){if(o-n<=r)return;const a=n+o>>1;select(e,t,a,n,o,i%2),sortKD(e,t,r,n,a-1,i+1),sortKD(e,t,r,a+1,o,i+1)}function select(e,t,r,n,o,i){for(;o>n;){if(o-n>600){const a=o-n+1,s=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(s-a/2<0?-1:1);select(e,t,r,Math.max(n,Math.floor(r-s*u/a+c)),Math.min(o,Math.floor(r+(a-s)*u/a+c)),i)}const a=t[2*r+i];let s=n,l=o;for(swapItem(e,t,n,r),t[2*o+i]>a&&swapItem(e,t,n,o);s<l;){for(swapItem(e,t,s,l),s++,l--;t[2*s+i]<a;)s++;for(;t[2*l+i]>a;)l--}t[2*n+i]===a?swapItem(e,t,n,l):swapItem(e,t,++l,o),l<=r&&(n=l+1),r<=l&&(o=l-1)}}function swapItem(e,t,r,n){swap(e,r,n),swap(t,2*r,2*n),swap(t,2*r+1,2*n+1)}function swap(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function range(e,t,r,n,o,i,a){const s=[0,e.length-1,0],l=[];let u,c;for(;s.length;){const h=s.pop(),f=s.pop(),p=s.pop();if(f-p<=a){for(let a=p;a<=f;a++)u=t[2*a],c=t[2*a+1],u>=r&&u<=o&&c>=n&&c<=i&&l.push(e[a]);continue}const d=Math.floor((p+f)/2);u=t[2*d],c=t[2*d+1],u>=r&&u<=o&&c>=n&&c<=i&&l.push(e[d]);const v=(h+1)%2;(0===h?r<=u:n<=c)&&(s.push(p),s.push(d-1),s.push(v)),(0===h?o>=u:i>=c)&&(s.push(d+1),s.push(f),s.push(v))}return l}function within(e,t,r,n,o,i){const a=[0,e.length-1,0],s=[],l=o*o;for(;a.length;){const u=a.pop(),c=a.pop(),h=a.pop();if(c-h<=i){for(let o=h;o<=c;o++)sqDist(t[2*o],t[2*o+1],r,n)<=l&&s.push(e[o]);continue}const f=Math.floor((h+c)/2),p=t[2*f],d=t[2*f+1];sqDist(p,d,r,n)<=l&&s.push(e[f]);const v=(u+1)%2;(0===u?r-o<=p:n-o<=d)&&(a.push(h),a.push(f-1),a.push(v)),(0===u?r+o>=p:n+o>=d)&&(a.push(f+1),a.push(c),a.push(v))}return s}function sqDist(e,t,r,n){const o=e-r,i=t-n;return o*o+i*i}const defaultGetX=e=>e[0],defaultGetY=e=>e[1];class KDBush{constructor(e,t=defaultGetX,r=defaultGetY,n=64,o=Float64Array){this.nodeSize=n,this.points=e;const i=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new i(e.length),s=this.coords=new o(2*e.length);for(let n=0;n<e.length;n++)a[n]=n,s[2*n]=t(e[n]),s[2*n+1]=r(e[n]);sortKD(a,s,n,0,a.length-1,0)}range(e,t,r,n){return range(this.ids,this.coords,e,t,r,n,this.nodeSize)}within(e,t,r){return within(this.ids,this.coords,e,t,r,this.nodeSize)}}function isObject$1(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),now=function(){return root.Date.now()},Symbol$1=root.Symbol,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=void 0}catch(e){}var n=nativeObjectToString.call(e);return t?e[symToStringTag]=r:delete e[symToStringTag],n}var objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var symbolTag="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&baseGetTag(e)==symbolTag}var NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject$1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(e,t,r){var n,o,i,a,s,l,u=0,c=!1,h=!1,f=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function p(t){var r=n,i=o;return n=o=void 0,u=t,a=e.apply(i,r)}function d(e){var r=e-l;return void 0===l||r>=t||r<0||h&&e-u>=i}function v(){var e=now();if(d(e))return g(e);s=setTimeout(v,function(e){var r=t-(e-l);return h?nativeMin(r,i-(e-u)):r}(e))}function g(e){return s=void 0,f&&n?p(e):(n=o=void 0,a)}function y(){var e=now(),r=d(e);if(n=arguments,o=this,l=e,r){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),c?p(e):a}(l);if(h)return clearTimeout(s),s=setTimeout(v,t),p(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=toNumber(t)||0,isObject$1(r)&&(c=!!r.leading,i=(h="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):i,f="trailing"in r?!!r.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=l=o=s=void 0},y.flush=function(){return void 0===s?a:g(now())},y}var FUNC_ERROR_TEXT$1="Expected a function";function throttle(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);return isObject$1(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),debounce(e,t,{leading:n,maxWait:t,trailing:o})}const withRaf=(e,t,r=window.requestAnimationFrame)=>{let n=!1;return(...o)=>{if(!n)return r(()=>{const r=e(...o);t&&t(r),n=!1})}},FRAGMENT_SHADER="\nprecision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",VERTEX_SHADER="\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\nuniform float aspectRatio;\n\nuniform float width;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float offsetScale;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  mat4 projViewModel = projection * view * model;\n  vec4 prevProjected = projViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n}",{push:push,unshift:unshift}=Array.prototype,I=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),FLOAT_BYTES=Float32Array.BYTES_PER_ELEMENT,createMesh=(e,t,r=[])=>{for(let n=0;n<e-1;n++){const e=t+2*n,o=e+1,i=e+2,a=e+3;r.push(e,o,i,i,o,a)}return r},buffer={duplicate(e,t=1,r=1){const n=[],o=new Array(2*t);for(let i=0,a=e.length/t;i<a;i++){const a=i*t;for(let n=0;n<t;n++){const i=e[a+n];o[n]=i,o[n+t]=i*r}push.apply(n,o)}return n},mapElement(e,t,r,n){for(let o=0,i=e.length/r;o<i;o++){const i=t+o*r;e[i]=n(e[i],i,o)}return e},pushElement(e,t,r){const n=new Array(r),o=t*r;for(let t=0;t<r;t++)n[t]=e[o+t];return push.apply(e,n),e},unshiftElement(e,t,r){const n=new Array(r),o=t*r;for(let t=0;t<r;t++)n[t]=e[o+t];return unshift.apply(e,n),e},increaseStride(e,t,r,n=0){const o=[],i=new Array(r).fill(n);for(let r=0,n=e.length/t;r<n;r++){const n=r*t;for(let r=0;r<t;r++)i[r]=e[n+r];push.apply(o,i)}return o}},createLine=(e,{projection:t=I,model:r=I,view:n=I,points:o=[],widths:i=[],color:a=[.8,.5,0,1],width:s=1,miter:l=1,is2d:u=!1,zPos2d:c=0}={})=>{if(!e)return void console.error("Regl instance is undefined.");let h,f,p,d,v,g,y,m,b,_,A,T=u?2:3;const w=()=>{y=e.buffer(),m=e.buffer(),b={prevPosition:{buffer:()=>y,offset:0,stride:3*FLOAT_BYTES},currPosition:{buffer:()=>y,offset:3*FLOAT_BYTES*2,stride:3*FLOAT_BYTES},nextPosition:{buffer:()=>y,offset:3*FLOAT_BYTES*4,stride:3*FLOAT_BYTES},offsetScale:()=>m},_=e.elements(),A=e({attributes:b,depth:{enable:!u},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projection:e.prop("projection"),model:e.prop("model"),view:e.prop("view"),aspectRatio:({viewportWidth:e,viewportHeight:t})=>e/t,color:()=>a,width:({viewportWidth:e})=>s/e*window.devicePixelRatio,miter:l},elements:()=>_,vert:VERTEX_SHADER,frag:FRAGMENT_SHADER})},E=()=>{S(),w()},S=()=>{o=null,p=null,d=null,v=null,g=null,y.destroy(),m.destroy(),_.destroy()},L=(e=[],t=i,r=u)=>{o=e,T=(u=r)?2:3,h=Math.floor(o.length/T),f=h+2,t.length===h&&(i=t),o&&o.length>1?(o.length%T>0&&console.warn(`The length of points (${h}) does not match the dimensions (${T}). Incomplete points are ignored.`),p=o.slice(0,h*T),u&&(p=buffer.increaseStride(p,2,3,c)),i.length!==h&&(i=new Array(h).fill(1)),buffer.pushElement(p,h-1,3),buffer.unshiftElement(p,0,3),d=new Float32Array(buffer.duplicate(p,3)),v=buffer.duplicate(i,1,-1),g=createMesh(h,0),y({usage:"dynamic",type:"float",length:3*f*2*FLOAT_BYTES,data:d}),m({usage:"dynamic",type:"float",length:1*h*2*FLOAT_BYTES,data:v}),_({primitive:"triangles",usage:"dynamic",type:"uint16",data:g})):E()};return w(),o&&o.length>1&&L(o),{clear:E,destroy:S,draw:({projection:e,model:i,view:a}={})=>{e&&(t=e),i&&(r=i),a&&(n=a),o&&o.length>1&&A({projection:t,model:r,view:n})},getPoints:()=>o,setPoints:L,getData:()=>({points:d,widths:v}),getBuffer:()=>({points:y,widths:m}),getStyle:()=>({color:a,miter:l,width:s}),setStyle:({color:e,miter:t,width:r}={})=>{e&&(a=e),t&&(l=t),+r>0&&(s=r)}}};var addWheelListener$2=wheel.addWheelListener,removeWheelListener$2=wheel.removeWheelListener,scrollSpeed$1=getScroller$1;function getScroller$1(e,t){var r=new events;return r.flush=n,r.dispose=function(){removeWheelListener$2(e,o,!1)},n(),"undefined"==typeof window?r:(e=e||window,addWheelListener$2(e,o,!1),r);function n(){r[0]=r[1]=r[2]=0}function o(e){var n=1===e.deltaMode?12:1;r[0]+=n*(e.deltaX||0),r[1]+=n*(e.deltaY||0),r[2]+=n*(e.deltaZ||0),r.emit("scroll",r),t&&e.preventDefault&&(e.preventDefault(),e.stopPropagation&&e.stopPropagation())}}const FRAGMENT_SHADER$1="\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",VERTEX_SHADER$1="\nprecision mediump float;\n\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = projection * view * model * vec4(1.0 - 2.0 * position, 0, 1);\n}\n",FRAGMENT_SHADER$2="\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\n\nvarying vec4 color;\n\nvoid main() {\n  float r = 0.0, delta = 0.0, alpha = 1.0;\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  r = dot(cxy, cxy);\n\n  #ifdef GL_OES_standard_derivatives\n    delta = fwidth(r);\n    alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n  #endif\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",VERTEX_SHADER$2='\nprecision mediump float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float pointSize;\nuniform float pointSizeExtra;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByCategory;\nuniform float isColoredByValue;\nuniform float maxColor;\nuniform float numColorStates;\nuniform float scaling;\nuniform mat4 projection;\nuniform mat4 model;\nuniform mat4 view;\n\nattribute float stateIndex;\n\n// variables to send to the fragment shader\nvarying vec4 color;\n\nvoid main() {\n  // First get the state\n  float eps = 0.5 / stateTexRes;\n  float stateRowIndex = floor((stateIndex + eps) / stateTexRes);\n  vec2 stateTexIndex = vec2(\n    (stateIndex / stateTexRes) - stateRowIndex + eps,\n    stateRowIndex / stateTexRes\n  );\n\n  vec4 state = texture2D(stateTex, stateTexIndex);\n\n  gl_Position = projection * view * model * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexCat = state.z * isColoredByCategory;\n  float colorIndexVal = floor(state.w * maxColor) * isColoredByValue;\n  float colorIndex = colorIndexCat + colorIndexVal;\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  colorIndex *= numColorStates;\n  // Half a "pixel" or "texel" in texture coordinates\n  eps = 0.5 / colorTexRes;\n  float colorLinearIndex = colorIndex + globalState;\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + eps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + eps,\n    colorRowIndex / colorTexRes\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // The final scaling consists of linear scaling in [0, 1] and log scaling\n  // in [1, [\n  float finalScaling = min(1.0, scaling) + log2(max(1.0, scaling));\n\n  gl_PointSize = pointSize * finalScaling + pointSizeExtra;\n}\n';var asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$1(e){if(!isObject$1(e))return!1;var t=baseGetTag(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}var coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto=Function.prototype,funcToString=funcProto.toString;function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$2=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$1=objectProto$2.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$1).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$1(e)||isMasked(e))&&(isFunction$1(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function arrayAggregator(e,t,r,n){for(var o=-1,i=null==e?0:e.length;++o<i;){var a=e[o];t(n,a,r(a),e)}return n}function createBaseFor(e){return function(t,r,n){for(var o=-1,i=Object(t),a=n(t),s=a.length;s--;){var l=a[e?s:++o];if(!1===r(i[l],l,i))break}return t}}var baseFor=createBaseFor();function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag}var objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArray=Array.isArray;function stubFalse(){return!1}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var MAX_SAFE_INTEGER$1=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag$1="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{var e=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return e||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray(e),n=!r&&isArguments(e),o=!r&&!n&&isBuffer(e),i=!r&&!n&&!o&&isTypedArray(e),a=r||n||o||i,s=a?baseTimes(e.length,String):[],l=s.length;for(var u in e)!t&&!hasOwnProperty$3.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,l))||s.push(u);return s}var objectProto$5=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$5)}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys=overArg(Object.keys,Object),objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$4.call(e,r)&&"constructor"!=r&&t.push(r);return t}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction$1(e)}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function baseForOwn(e,t){return e&&baseFor(e,t,keys)}function createBaseEach(e,t){return function(r,n){if(null==r)return r;if(!isArrayLike(r))return e(r,n);for(var o=r.length,i=t?o:-1,a=Object(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}var baseEach=createBaseEach(baseForOwn);function baseAggregator(e,t,r,n){return baseEach(e,function(e,o,i){t(n,e,r(e),i)}),n}function listCacheClear(){this.__data__=[],this.size=0}function eq(e,t){return e===t||e!=e&&t!=t}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map"),nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED="__lodash_hash_undefined__",objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var r=t[e];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty$5.call(t,e)?t[e]:void 0}var objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$6.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map$1||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var HASH_UNDEFINED$2="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED$2),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function equalArrays(e,t,r,n,o,i){var a=r&COMPARE_PARTIAL_FLAG,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var u=i.get(e);if(u&&i.get(t))return u==t;var c=-1,h=!0,f=r&COMPARE_UNORDERED_FLAG?new SetCache:void 0;for(i.set(e,t),i.set(t,e);++c<s;){var p=e[c],d=t[c];if(n)var v=a?n(d,p,c,t,e,i):n(p,d,c,e,t,i);if(void 0!==v){if(v)continue;h=!1;break}if(f){if(!arraySome(t,function(e,t){if(!cacheHas(f,t)&&(p===e||o(p,e,r,n,i)))return f.push(t)})){h=!1;break}}else if(p!==d&&!o(p,d,r,n,i)){h=!1;break}}return i.delete(e),i.delete(t),h}var Uint8Array=root.Uint8Array;function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",mapTag$1="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,r,n,o,i,a){switch(r){case dataViewTag$1:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag$1:return!(e.byteLength!=t.byteLength||!i(new Uint8Array(e),new Uint8Array(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq(+e,+t);case errorTag$1:return e.name==t.name&&e.message==t.message;case regexpTag$1:case stringTag$1:return e==t+"";case mapTag$1:var s=mapToArray;case setTag$1:var l=n&COMPARE_PARTIAL_FLAG$1;if(s||(s=setToArray),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;n|=COMPARE_UNORDERED_FLAG$1,a.set(e,t);var c=equalArrays(s(e),s(t),n,o,i,a);return a.delete(e),c;case symbolTag$1:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}function arrayPush(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}function baseGetAllKeys(e,t,r){var n=t(e);return isArray(e)?n:arrayPush(n,r(e))}function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[o++]=a)}return i}function stubArray(){return[]}var objectProto$9=Object.prototype,propertyIsEnumerable$1=objectProto$9.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable$1.call(e,t)}))}:stubArray;function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols)}var COMPARE_PARTIAL_FLAG$2=1,objectProto$a=Object.prototype,hasOwnProperty$7=objectProto$a.hasOwnProperty;function equalObjects(e,t,r,n,o,i){var a=r&COMPARE_PARTIAL_FLAG$2,s=getAllKeys(e),l=s.length;if(l!=getAllKeys(t).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in t:hasOwnProperty$7.call(t,c)))return!1}var h=i.get(e);if(h&&i.get(t))return h==t;var f=!0;i.set(e,t),i.set(t,e);for(var p=a;++u<l;){var d=e[c=s[u]],v=t[c];if(n)var g=a?n(v,d,c,t,e,i):n(d,v,c,e,t,i);if(!(void 0===g?d===v||o(d,v,r,n,i):g)){f=!1;break}p||(p="constructor"==c)}if(f&&!p){var y=e.constructor,m=t.constructor;y!=m&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof m&&m instanceof m)&&(f=!1)}return i.delete(e),i.delete(t),f}var DataView=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),mapTag$2="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$2="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag(new Map$1)!=mapTag$2||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag$2||WeakMap&&getTag(new WeakMap)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$2;case promiseCtorString:return promiseTag;case setCtorString:return setTag$2;case weakMapCtorString:return weakMapTag$1}return t});var getTag$1=getTag,COMPARE_PARTIAL_FLAG$3=1,argsTag$2="[object Arguments]",arrayTag$1="[object Array]",objectTag$2="[object Object]",objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty;function baseIsEqualDeep(e,t,r,n,o,i){var a=isArray(e),s=isArray(t),l=a?arrayTag$1:getTag$1(e),u=s?arrayTag$1:getTag$1(t),c=(l=l==argsTag$2?objectTag$2:l)==objectTag$2,h=(u=u==argsTag$2?objectTag$2:u)==objectTag$2,f=l==u;if(f&&isBuffer(e)){if(!isBuffer(t))return!1;a=!0,c=!1}if(f&&!c)return i||(i=new Stack),a||isTypedArray(e)?equalArrays(e,t,r,n,o,i):equalByTag(e,t,l,r,n,o,i);if(!(r&COMPARE_PARTIAL_FLAG$3)){var p=c&&hasOwnProperty$8.call(e,"__wrapped__"),d=h&&hasOwnProperty$8.call(t,"__wrapped__");if(p||d){var v=p?e.value():e,g=d?t.value():t;return i||(i=new Stack),o(v,g,r,n,i)}}return!!f&&(i||(i=new Stack),equalObjects(e,t,r,n,o,i))}function baseIsEqual(e,t,r,n,o){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,r,n,baseIsEqual,o))}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2;function baseIsMatch(e,t,r,n){var o=r.length,i=o,a=!n;if(null==e)return!i;for(e=Object(e);o--;){var s=r[o];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<i;){var l=(s=r[o])[0],u=e[l],c=s[1];if(a&&s[2]){if(void 0===u&&!(l in e))return!1}else{var h=new Stack;if(n)var f=n(u,c,l,e,t,h);if(!(void 0===f?baseIsEqual(c,u,COMPARE_PARTIAL_FLAG$4|COMPARE_UNORDERED_FLAG$2,n,h):f))return!1}}return!0}function isStrictComparable(e){return e==e&&!isObject$1(e)}function getMatchData(e){for(var t=keys(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,isStrictComparable(o)]}return t}function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var FUNC_ERROR_TEXT$2="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$2);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=e.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(memoize.Cache||MapCache),r}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize(e,function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e}),r=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,function(e,r,n,o){t.push(n?o.replace(reEscapeChar,"$1"):r||e)}),t});function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var INFINITY=1/0,symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$1?symbolProto$1.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}function toString(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray(e)?e:isKey(e,t)?[e]:stringToPath(toString(e))}var INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}function baseGet(e,t){for(var r=0,n=(t=castPath(t,e)).length;null!=e&&r<n;)e=e[toKey(t[r++])];return r&&r==n?e:void 0}function get(e,t,r){var n=null==e?void 0:baseGet(e,t);return void 0===n?r:n}function baseHasIn(e,t){return null!=e&&t in Object(e)}function hasPath(e,t,r){for(var n=-1,o=(t=castPath(t,e)).length,i=!1;++n<o;){var a=toKey(t[n]);if(!(i=null!=e&&r(e,a)))break;e=e[a]}return i||++n!=o?i:!!(o=null==e?0:e.length)&&isLength(o)&&isIndex(a,o)&&(isArray(e)||isArguments(e))}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function baseMatchesProperty(e,t){return isKey(e)&&isStrictComparable(t)?matchesStrictComparable(toKey(e),t):function(r){var n=get(r,e);return void 0===n&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG$5|COMPARE_UNORDERED_FLAG$3)}}function identity$6(e){return e}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function basePropertyDeep(e){return function(t){return baseGet(t,e)}}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}function baseIteratee(e){return"function"==typeof e?e:null==e?identity$6:"object"==typeof e?isArray(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}function createAggregator(e,t){return function(r,n){var o=isArray(r)?arrayAggregator:baseAggregator,i=t?t():{};return o(r,e,baseIteratee(n,2),i)}}var objectProto$c=Object.prototype,hasOwnProperty$9=objectProto$c.hasOwnProperty,groupBy=createAggregator(function(e,t,r){hasOwnProperty$9.call(e,r)?e[r].push(t):baseAssignValue(e,r,[t])}),spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,r,n,o){var i=-1,a=e.length;for(r||(r=isFlattenable),o||(o=[]);++i<a;){var s=e[i];t>0&&r(s)?t>1?baseFlatten(s,t-1,r,n,o):arrayPush(o,s):n||(o[o.length]=s)}return o}function flatten(e){return(null==e?0:e.length)?baseFlatten(e,1):[]}function gaussKernel(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*(r*r+n*n))}function mean(e,t){return e.reduce(function(e,r){return e+r[t]},0)/e.length}function stdDev(e){var t=mean(e,0),r=mean(e,1),n=e.length,o=0,i=0;return e.forEach(function(e){o+=Math.pow(e[0]-t,2),i+=Math.pow(e[1]-r,2)}),[Math.sqrt(1/(n-1)*o),Math.sqrt(1/(n-1)*i)]}function getBandwidth(e){var t=e.length,r=_slicedToArray(stdDev(e),2),n=r[0],o=r[1];return[Math.pow(t,-1/6)*n,Math.pow(t,-1/6)*o]}function diff(e,t){var r=_slicedToArray(e,2),n=r[0],o=r[1],i=_slicedToArray(t,2);return[i[0]-n,i[1]-o]}function applyBandwidth(e,t){return[e[0]/t[0],e[1]/t[1]]}function kde(e,t,r){for(var n=t.xMin,o=t.xMax,i=t.yMin,a=t.yMax,s=Array(r).fill().map(function(){return Array(r).fill()}),l=(o-n)/(r-1),u=(a-i)/(r-1),c=[],h=[],f=0;f<r;++f)c.push(n+f*l),h.push(i+f*u);for(var p=getBandwidth(e),d=function(t){for(var n=function(r){s[t][r]=e.reduce(function(e,n){return e+gaussKernel(applyBandwidth(diff([c[r],h[t]],n),p))},0)/(e.length*p[0]*p[1])},o=0;o<r;++o)n(o)},v=0;v<r;++v)d(v);return s}function linear(e,t,r){return e<t?(r-e)/(t-e):(e-r)/(e-t)}function Options(){this.successCallback=null,this.verbose=!1,this.polygons=!1,this.polygons_full=!1,this.linearRing=!0,this.noQuadTree=!1,this.noFrame=!1}function isoLineOptions(e){var t,r,n,o,i;for(o=new Options,e=e||{},i=Object.keys(o),t=0;t<i.length;t++)null!=(n=e[r=i[t]])&&(o[r]=n);return o.polygons_full=!o.polygons,o.interpolate=linear,o}function cell2Polygons(e,t,r,n){var o=[];return e.polygons.forEach(function(e){e.forEach(function(e){e[0]+=t,e[1]+=r}),n.linearRing&&e.push(e[0]),o.push(e)}),o}function entry_coordinate(e,t,r,n){return 0===r?(e+=1,t+=n[0][1]):1===r?e+=n[0][0]:2===r?t+=n[0][1]:3===r&&(e+=n[0][0],t+=1),[e,t]}function skip_coordinate(e,t,r){return 0===r?e++:1===r||(2===r?t++:3===r&&(e++,t++)),[e,t]}function requireLineFrame(e,t){var r,n,o,i,a;for(r=!0,n=e[0].length,o=e.length,a=0;a<o;a++)if(e[a][0]>=t||e[a][n-1]>=t){r=!1;break}if(r&&(e[o-1][0]>=t||e[o-1][n-1]>=t)&&(r=!1),r)for(i=0;i<n-1;i++)if(e[0][i]>=t||e[o-1][i]>t){r=!1;break}return r}function traceLinePaths(e,t,r){var n,o,i,a,s,l,u,c,h,f,p,d,v,g,y,m=[],b=e.length-1,_=e[0].length-1,A=["right","bottom","left","top"],T=[0,-1,0,1],w=[-1,0,1,0],E={bottom:1,left:2,top:3,right:0};return r.noFrame||requireLineFrame(e,r.threshold)&&(r.linearRing?m.push([[0,0],[0,b],[_,b],[_,0],[0,0]]):m.push([[0,0],[0,b],[_,b],[_,0]])),t.forEach(function(e,S){e.forEach(function(e,L){for(n=null,o=0;o<4;o++)if(n=A[o],"object"==typeof e.edges[n]){for(s=[],i=e.edges[n],l=n,u=S,c=L,h=!1,f=[S+i.path[0][0],L+i.path[0][1]],s.push(f);!h&&"object"==typeof(a=t[u][c]).edges[l];)if(i=a.edges[l],delete a.edges[l],(p=i.path[1])[0]+=u,p[1]+=c,s.push(p),l=i.move.enter,u+=i.move.x,c+=i.move.y,void 0===t[u]||void 0===t[u][c]){if(!r.linearRing)break;if(d=0,v=0,u===_?(u--,d=0):u<0?(u++,d=2):c===b?(c--,d=3):c<0&&(c++,d=1),u===S&&c===L&&d===E[n]){h=!0,l=n;break}for(;;){if(g=!1,v>4)throw new Error("Direction change counter overflow! This should never happen!");if(void 0!==t[u]&&void 0!==t[u][c]&&(a=t[u][c],y=A[d],"object"==typeof a.edges[y])){i=a.edges[y],s.push(entry_coordinate(u,c,d,i.path)),l=y,g=!0;break}if(g)break;if(s.push(skip_coordinate(u,c,d)),c+=w[d],void 0!==t[u+=T[d]]&&void 0!==t[u][c]||(0===d&&c<0||1===d&&u<0||2===d&&c===b||3===d&&u===_)&&(u-=T[d],c-=w[d],d=(d+1)%4,v++),u===S&&c===L&&d===E[n]){h=!0,l=n;break}}}!r.linearRing||s[s.length-1][0]===f[0]&&s[s.length-1][1]===f[1]||s.push(f),m.push(s)}})}),m}function TreeNode(e,t,r,n,o){var i=n,a=o,s=0,l=0;if(this.x=t,this.y=r,this.lowerBound=null,this.upperBound=null,this.childA=null,this.childB=null,this.childC=null,this.childD=null,1===n&&1===o)this.lowerBound=Math.min(e[r][t],e[r][t+1],e[r+1][t+1],e[r+1][t]),this.upperBound=Math.max(e[r][t],e[r][t+1],e[r+1][t+1],e[r+1][t]);else{if(n>1){for(;0!==i;)i>>=1,s++;n===1<<s-1&&s--,i=1<<s-1}if(o>1){for(;0!==a;)a>>=1,l++;o===1<<l-1&&l--,a=1<<l-1}this.childA=new TreeNode(e,t,r,i,a),this.lowerBound=this.childA.lowerBound,this.upperBound=this.childA.upperBound,n-i>0&&(this.childB=new TreeNode(e,t+i,r,n-i,a),this.lowerBound=Math.min(this.lowerBound,this.childB.lowerBound),this.upperBound=Math.max(this.upperBound,this.childB.upperBound),o-a>0&&(this.childC=new TreeNode(e,t+i,r+a,n-i,o-a),this.lowerBound=Math.min(this.lowerBound,this.childC.lowerBound),this.upperBound=Math.max(this.upperBound,this.childC.upperBound))),o-a>0&&(this.childD=new TreeNode(e,t,r+a,i,o-a),this.lowerBound=Math.min(this.lowerBound,this.childD.lowerBound),this.upperBound=Math.max(this.upperBound,this.childD.upperBound))}}function QuadTree(e){var t,r;if(!e)throw new Error("data is required");if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Error("data must be scalar field, i.e. array of arrays");if(e.length<2)throw new Error("data must contain at least two rows");if((r=e[0].length)<2)throw new Error("data must contain at least two columns");for(t=1;t<e.length;t++){if(!Array.isArray(e[t]))throw new Error("Row "+t+" is not an array");if(e[t].length!=r)throw new Error("unequal row lengths detected, please provide a regular grid")}this.data=e,this.root=new TreeNode(e,0,0,e[0].length-1,e.length-1)}function isoLines(e,t,r){var n,o,i,a=!1,s=!1,l=null,u=null,c=null,h=null,f=null,p=[];if(!e)throw new Error("data is required");if(null==t)throw new Error("threshold is required");if(r&&"object"!=typeof r)throw new Error("options must be an object");if(n=isoLineOptions(r),e instanceof QuadTree)l=e,u=e.root,c=e.data,n.noQuadTree||(a=!0);else{if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Error("input is neither array of arrays nor object retrieved from 'QuadTree()'");c=e}if(Array.isArray(t)){for(s=!0,n.noQuadTree||(a=!0),o=0;o<t.length;o++)if(isNaN(+t[o]))throw new Error("threshold["+o+"] is not a number")}else{if(isNaN(+t))throw new Error("threshold must be a number or array of numbers");t=[t]}return a&&!u&&(l=new QuadTree(c),u=l.root,c=l.data),n.verbose&&(n.polygons?console.log("MarchingSquaresJS-isoLines: returning single lines (polygons) for each grid cell"):console.log("MarchingSquaresJS-isoLines: returning line paths (polygons) for entire data grid"),s&&console.log("MarchingSquaresJS-isoLines: multiple lines requested, returning array of line paths instead of lines for a single threshold")),t.forEach(function(e,t){if(f=[],n.threshold=e,n.verbose&&console.log("MarchingSquaresJS-isoLines: computing iso lines for threshold "+e),n.polygons)if(a)u.cellsBelowThreshold(n.threshold,!0).forEach(function(e){f=f.concat(cell2Polygons(prepareCell(c,e.x,e.y,n),e.x,e.y,n))});else for(i=0;i<c.length-1;++i)for(t=0;t<c[0].length-1;++t)f=f.concat(cell2Polygons(prepareCell(c,t,i,n),t,i,n));else{for(h=[],t=0;t<c[0].length-1;++t)h[t]=[];if(a)u.cellsBelowThreshold(n.threshold,!1).forEach(function(e){h[e.x][e.y]=prepareCell(c,e.x,e.y,n)});else for(t=0;t<c[0].length-1;++t)for(i=0;i<c.length-1;++i)h[t][i]=prepareCell(c,t,i,n);f=traceLinePaths(c,h,n)}s?p.push(f):p=f,"function"==typeof n.successCallback&&n.successCallback(p,e)}),p}function prepareCell(e,t,r,n){var o,i,a,s,l,u,c=0,h=e[r+1][t],f=e[r+1][t+1],p=e[r][t+1],d=e[r][t],v=n.threshold;if(!(isNaN(d)||isNaN(p)||isNaN(f)||isNaN(h))){switch(c|=h>=v?8:0,c|=f>=v?4:0,c|=p>=v?2:0,u={cval:c=+(c|=d>=v?1:0),polygons:[],edges:{},x0:d,x1:p,x2:f,x3:h},c){case 0:n.polygons&&u.polygons.push([[0,0],[0,1],[1,1],[1,0]]);break;case 15:break;case 14:o=n.interpolate(d,h,v),s=n.interpolate(d,p,v),n.polygons_full&&(u.edges.left={path:[[0,o],[s,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&u.polygons.push([[0,0],[0,o],[s,0]]);break;case 13:s=n.interpolate(d,p,v),i=n.interpolate(p,f,v),n.polygons_full&&(u.edges.bottom={path:[[s,0],[1,i]],move:{x:1,y:0,enter:"left"}}),n.polygons&&u.polygons.push([[s,0],[1,i],[1,0]]);break;case 11:i=n.interpolate(p,f,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.right={path:[[1,i],[a,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&u.polygons.push([[1,i],[a,1],[1,1]]);break;case 7:o=n.interpolate(d,h,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.top={path:[[a,1],[0,o]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&u.polygons.push([[a,1],[0,o],[0,1]]);break;case 1:o=n.interpolate(d,h,v),s=n.interpolate(d,p,v),n.polygons_full&&(u.edges.bottom={path:[[s,0],[0,o]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&u.polygons.push([[s,0],[0,o],[0,1],[1,1],[1,0]]);break;case 2:s=n.interpolate(d,p,v),i=n.interpolate(p,f,v),n.polygons_full&&(u.edges.right={path:[[1,i],[s,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&u.polygons.push([[0,0],[0,1],[1,1],[1,i],[s,0]]);break;case 4:i=n.interpolate(p,f,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.top={path:[[a,1],[1,i]],move:{x:1,y:0,enter:"left"}}),n.polygons&&u.polygons.push([[0,0],[0,1],[a,1],[1,i],[1,0]]);break;case 8:o=n.interpolate(d,h,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.left={path:[[0,o],[a,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&u.polygons.push([[0,0],[0,o],[a,1],[1,1],[1,0]]);break;case 12:o=n.interpolate(d,h,v),i=n.interpolate(p,f,v),n.polygons_full&&(u.edges.left={path:[[0,o],[1,i]],move:{x:1,y:0,enter:"left"}}),n.polygons&&u.polygons.push([[0,0],[0,o],[1,i],[1,0]]);break;case 9:s=n.interpolate(d,p,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.bottom={path:[[s,0],[a,1]],move:{x:0,y:1,enter:"bottom"}}),n.polygons&&u.polygons.push([[s,0],[a,1],[1,1],[1,0]]);break;case 3:o=n.interpolate(d,h,v),i=n.interpolate(p,f,v),n.polygons_full&&(u.edges.right={path:[[1,i],[0,o]],move:{x:-1,y:0,enter:"right"}}),n.polygons&&u.polygons.push([[0,o],[0,1],[1,1],[1,i]]);break;case 6:s=n.interpolate(d,p,v),a=n.interpolate(h,f,v),n.polygons_full&&(u.edges.top={path:[[a,1],[s,0]],move:{x:0,y:-1,enter:"top"}}),n.polygons&&u.polygons.push([[0,0],[0,1],[a,1],[s,0]]);break;case 10:o=n.interpolate(d,h,v),i=n.interpolate(p,f,v),s=n.interpolate(d,p,v),a=n.interpolate(h,f,v),l=(d+p+f+h)/4,n.polygons_full&&(l<v?(u.edges.left={path:[[0,o],[a,1]],move:{x:0,y:1,enter:"bottom"}},u.edges.right={path:[[1,i],[s,0]],move:{x:0,y:-1,enter:"top"}}):(u.edges.right={path:[[1,i],[a,1]],move:{x:0,y:1,enter:"bottom"}},u.edges.left={path:[[0,o],[s,0]],move:{x:0,y:-1,enter:"top"}})),n.polygons&&(l<v?u.polygons.push([[0,0],[0,o],[a,1],[1,1],[1,i],[s,0]]):(u.polygons.push([[0,0],[0,o],[s,0]]),u.polygons.push([[a,1],[1,1],[1,i]])));break;case 5:o=n.interpolate(d,h,v),i=n.interpolate(p,f,v),s=n.interpolate(d,p,v),a=n.interpolate(h,f,v),l=(d+p+f+h)/4,n.polygons_full&&(l<v?(u.edges.bottom={path:[[s,0],[0,o]],move:{x:-1,y:0,enter:"right"}},u.edges.top={path:[[a,1],[1,i]],move:{x:1,y:0,enter:"left"}}):(u.edges.top={path:[[a,1],[0,o]],move:{x:-1,y:0,enter:"right"}},u.edges.bottom={path:[[s,0],[1,i]],move:{x:1,y:0,enter:"left"}})),n.polygons&&(l<v?u.polygons.push([[0,o],[0,1],[a,1],[1,i],[1,0],[s,0]]):(u.polygons.push([[0,o],[0,1],[a,1]]),u.polygons.push([[s,0],[1,i],[1,0]])))}return u}}function bilinearInterpolation(e,t,r,n,o,i,a,s,l,u){return(o*(t-l)*(n-u)+i*(l-e)*(n-u)+a*(t-l)*(u-r)+s*(l-e)*(u-r))/((t-e)*(n-r))}function findClosestIndices(e,t,r){var n=_slicedToArray(e,2),o=n[0],i=n[1],a=t.xMin,s=t.xMax,l=t.yMin,u=(o-a)/(s-a)*(r-1),c=(i-l)/(t.yMax-l)*(r-1);return[Math.floor(u),Math.ceil(u),Math.floor(c),Math.ceil(c)]}function computePointValue(e,t,r,n,o){var i=_slicedToArray(findClosestIndices(t,o,e.length),4),a=i[0],s=i[1],l=i[2],u=i[3];return bilinearInterpolation(r[a],r[s],n[l],n[u],e[l][a],e[l][s],e[u][a],e[u][s],t[0],t[1])}function computePointValues(e,t,r){for(var n=t.xMin,o=t.xMax,i=t.yMin,a=t.yMax,s=e.length,l=(o-n)/(s-1),u=(a-i)/(s-1),c=[],h=[],f=0;f<s;++f)c.push(n+f*l),h.push(i+f*u);return r.map(function(r){return computePointValue(e,r,c,h,t)})}function nPointsGreaterThanIsoValue(e,t){for(var r=0,n=e.length-1;r!==n;){var o=Math.ceil((r+n)/2);e[o]>t?n=o-1:r=o}return e.length-r+(e[r]<t?-1:0)}function findContour(e,t,r,n){for(var o=t.xMin,i=t.xMax,a=t.yMin,s=t.yMax,l=computePointValues(e,t,r).sort(function(e,t){return e-t}),u=l[Math.floor(.1*l.length)],c=(l[Math.floor(.9*l.length)]-u)/20,h=new Array(20).fill().map(function(e,t){return u+t*c}),f=new QuadTree(e),p=null,d=null,v=nPointsGreaterThanIsoValue(l,h[0]),g=isoLines(f,h[0],{noFrame:!0}),y=1;y<20;++y){var m=nPointsGreaterThanIsoValue(l,h[y]),b=1-m/v;if(1===g.length&&(p=g[0]),d=g[0],b>=n.contourDropoff)break;v=m,g=isoLines(f,h[y],{noFrame:!0})}null===p&&(p=d,console.error("Can't find contour. Using best available one, (may look bad)."));for(var _=(i-o)/(e.length-1),A=(s-a)/(e.length-1),T=0;T<p.length;++T)p[T][0]=o+p[T][0]*_,p[T][1]=a+p[T][1]*A;return p}TreeNode.prototype.cellsInBand=function(e,t,r){var n=[];return r=void 0===r||r,this.lowerBound>t||this.upperBound<e?n:(this.childA||this.childB||this.childC||this.childD?(this.childA&&(n=n.concat(this.childA.cellsInBand(e,t,r))),this.childB&&(n=n.concat(this.childB.cellsInBand(e,t,r))),this.childD&&(n=n.concat(this.childD.cellsInBand(e,t,r))),this.childC&&(n=n.concat(this.childC.cellsInBand(e,t,r)))):(r||this.lowerBound<=e||this.upperBound>=t)&&n.push({x:this.x,y:this.y}),n)},TreeNode.prototype.cellsBelowThreshold=function(e,t){var r=[];return t=void 0===t||t,this.lowerBound>e?r:(this.childA||this.childB||this.childC||this.childD?(this.childA&&(r=r.concat(this.childA.cellsBelowThreshold(e,t))),this.childB&&(r=r.concat(this.childB.cellsBelowThreshold(e,t))),this.childD&&(r=r.concat(this.childD.cellsBelowThreshold(e,t))),this.childC&&(r=r.concat(this.childC.cellsBelowThreshold(e,t)))):(t||this.upperBound>=e)&&r.push({x:this.x,y:this.y}),r)};var iterator=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}},yallist=Yallist;function Yallist(e){var t=this;if(t instanceof Yallist||(t=new Yallist),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,n=arguments.length;r<n;r++)t.push(arguments[r]);return t}function insert(e,t,r){var n=t===e.head?new Node(r,null,t,e):new Node(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function push$1(e,t){e.tail=new Node(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function unshift$1(e,t){e.head=new Node(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Node(e,t,r,n){if(!(this instanceof Node))return new Node(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}Yallist.Node=Node,Yallist.create=Yallist,Yallist.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Yallist.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Yallist.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Yallist.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)push$1(this,arguments[e]);return this.length},Yallist.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)unshift$1(this,arguments[e]);return this.length},Yallist.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},Yallist.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},Yallist.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},Yallist.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},Yallist.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},Yallist.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},Yallist.prototype.map=function(e,t){t=t||this;for(var r=new Yallist,n=this.head;null!==n;)r.push(e.call(t,n.value,this)),n=n.next;return r},Yallist.prototype.mapReverse=function(e,t){t=t||this;for(var r=new Yallist,n=this.tail;null!==n;)r.push(e.call(t,n.value,this)),n=n.prev;return r},Yallist.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var o=0;null!==n;o++)r=e(r,n.value,o),n=n.next;return r},Yallist.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var o=this.length-1;null!==n;o--)r=e(r,n.value,o),n=n.prev;return r},Yallist.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},Yallist.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},Yallist.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;for(;null!==o&&n<t;n++,o=o.next)r.push(o.value);return r},Yallist.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new Yallist;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var n=this.length,o=this.tail;null!==o&&n>t;n--)o=o.prev;for(;null!==o&&n>e;n--,o=o.prev)r.push(o.value);return r},Yallist.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;var i=[];for(n=0;o&&n<t;n++)i.push(o.value),o=this.removeNode(o);null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev);for(n=0;n<r.length;n++)o=insert(this,o,r[n]);return i},Yallist.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{iterator(Yallist)}catch(e){}function sqDist$1(e,t,r,n){var o=e-r,i=t-n;return o*o+i*i}function nearestNeighbor(e,t){for(var r=_slicedToArray(t,2),n=r[0],o=r[1],i=[0,e.ids.length-1,0],a=Number.MAX_VALUE,s=Number.MAX_VALUE,l=null;i.length;){var u=i.pop(),c=i.pop(),h=i.pop();if(c-h<=e.nodeSize)for(var f=h;f<=c;f++){var p=sqDist$1(e.coords[2*f],e.coords[2*f+1],n,o);p<=a&&(l=e.ids[f],a=p,s=Math.sqrt(a))}else{var d=h+c>>1,v=e.coords[2*d],g=e.coords[2*d+1],y=sqDist$1(v,g,n,o);y<=a&&(l=e.ids[d],a=y,s=Math.sqrt(a)),(0===u?n-s<=v:o-s<=g)&&(i.push(h),i.push(d-1),i.push(1-u)),(0===u?n+s>=v:o+s>=g)&&(i.push(d+1),i.push(c),i.push(1-u))}}return e.points[l]}function mod(e,t){return(e%t+t)%t}function distance$3(e,t){var r=_slicedToArray(e,2),n=r[0],o=r[1],i=_slicedToArray(t,2),a=n-i[0],s=o-i[1];return Math.sqrt(a*a+s*s)}function buildLeftSide(e,t,r,n,o){for(var i,a,s,l=r/2,u=e[t],c=t;l>.001;){if(l-(s=distance$3(i=e[a=mod(c-1,e.length)],u))>=0)l-=s,u=i,c=a;else{var h=(i[0]-u[0])/s,f=(i[1]-u[1])/s;i[0]=u[0]+h*l,i[1]=u[1]+f*l,l=0}o.unshift(i[1]+n[1]),o.unshift(i[0]+n[0])}}function buildRightSide(e,t,r,n,o){for(var i,a,s,l=r/2,u=e[t],c=t;l>.001;){if(l-(s=distance$3(i=e[a=(c+1)%e.length],u))>=0)l-=s,u=i,c=a;else{var h=(i[0]-u[0])/s,f=(i[1]-u[1])/s;i[0]=u[0]+h*l,i[1]=u[1]+f*l,l=0}o.push(i[0]+n[0]),o.push(i[1]+n[1])}}function makeConnections(e,t){for(var r,n=[],o=0;o<e.length;o+=2){n.push(0),r=(e[o+1]-e[o]-2)/2;for(var i=0;i<r;++i)n.push(t);n.push(0)}return n}function makeWinglet(e,t,r,n,o,i){var a=new yallist,s=[r[0]-e[t][0],r[1]-e[t][1]],l=e[t];a.push(l[0]+s[0]),a.push(l[1]+s[1]),buildLeftSide(e,t,n,s,a),buildRightSide(e,t,n,s,a);var u=a.shift(),c=a.shift();a.unshift(c,u,c,u);var h=a.pop(),f=a.pop();a.push(f,h,f,h);var p=o.length;o.push.apply(o,_toConsumableArray(a));var d=o.length-2;i.push(p,d)}function wingletLength(e,t,r,n){return t+Math.pow(e[3],n)*r}function createWinglets(e,t,r,n){for(var o=new Array(t.length*t[0].length),i=t[0].length,a=0;a<t.length;++a)for(var s=0;s<t[a].length;++s)o[a*i+s]={position:t[a][s],contour:t[a],index:s};for(var l=new KDBush(o,function(e){return e.position[0]},function(e){return e.position[1]},64),u=r.map(function(e){return nearestNeighbor(l,e)}),c=[],h=[],f=0;f<r.length;++f)makeWinglet(u[f].contour,u[f].index,r[f],wingletLength(r[f],n.a,n.b,n.n),c,h);var p=makeConnections(h,n.lineWidth);return createLine(e,{widths:p,is2d:!0,points:c})}function distance$4(e,t){var r=_slicedToArray(e,2),n=r[0],o=r[1],i=_slicedToArray(t,2),a=n-i[0],s=o-i[1];return Math.sqrt(a*a+s*s)}function getNPointsInCategory(e){for(var t={},r=0;r<e.length;++r)t[e[r][2]]=(t[e[r][2]]||0)+1;return t}function silhouetteIndex(e){var t,r,n,o,i=getNPointsInCategory(e),a=Object.keys(i),s={};a.forEach(function(t){s[t]=new Array(e.length).fill(0)});for(var l=0;l<e.length;++l)for(var u=l+1;u<e.length;++u)t=distance$4(e[l],e[u]),s[e[u][2]][l]+=t,s[e[l][2]][u]+=t;for(var c=0;c<e.length;++c){r=s[e[c][2]][c]/(i[e[c][2]]-1);for(var h=[],f=0;f<a.length;++f)a[f]!==String(e[c][2])&&h.push(s[a[f]][c]/i[a[f]]);n=Math.min.apply(Math,h),o=((o=i[e[c][2]]>1?(n-r)/Math.max(r,n):0)+1)/2,e[c][3]=o}}var contourScales=[.1,.19,.31,.47,.65,.86,1.1,1.37,1.67,2],defaultColors=[[255,255,255,1],[240,240,240,1],[217,217,217,1],[189,189,189,1],[150,150,150,1],[115,115,115,1],[82,82,82,1],[37,37,37,1],[0,0,0,1]];function computeCentroid(e){var t=[0,0];return e.forEach(function(e){t[0]+=e[0],t[1]+=e[1]}),t[0]/=e.length,t[1]/=e.length,t}function interpolateContour(e,t,r){for(var n=_slicedToArray(t,2),o=n[0],i=n[1],a=new Array(e.length),s=0;s<e.length;++s)a[s]=[r*(e[s][0]-o)+o,r*(e[s][1]-i)+i];return a}function darkenColor(e,t){var r=_slicedToArray(e,4),n=r[0],o=r[1],i=r[2],a=r[3];if(t>1)throw new Error("k must be < 1");return[n*t,o*t,i*t,a]}function getBBox(e,t){for(var r=Number.MAX_VALUE,n=Number.MIN_VALUE,o=Number.MAX_VALUE,i=Number.MIN_VALUE,a=0;a<e.length;++a)e[a][0]<r&&(r=e[a][0]),e[a][0]>n&&(n=e[a][0]),e[a][1]<o&&(o=e[a][1]),e[a][1]>i&&(i=e[a][1]);return{xMin:r-t,xMax:n+t,yMin:o-t,yMax:i+t}}var defaultOptions={showWinglets:!0,showContours:!1,lineWidth:1,a:.01,b:.08,n:1,contourDropoff:.05},optionActions={showWinglets:"draw",showContours:"draw",lineWidth:"draw",a:"process",b:"process",n:"process",contourDropoff:"process"},Winglets=function(){function e(t,r){_classCallCheck(this,e),this.regl=t,this.categories=[],this.pointsByCategory={},this.kdeGridsByCategory={},this.contourLines={},this.wingletLines={},this.colors=defaultColors,this.appliedColors=null,this.bbox=null,this.mvp=null,this.options=_objectSpread({},defaultOptions,r)}return _createClass(e,[{key:"draw",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=t;t||this.mvp?(t||(r=this.mvp),this.categories.forEach(function(t){if(e.options.showContours)for(var n=0;n<e.contourLines[t].length;++n)e.contourLines[t][n].draw(r);e.options.showWinglets&&e.wingletLines[t].draw(r)})):console.error("winglets.draw() missing mvp")}},{key:"processPoints",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.contourLines={},this.wingletLines={},this.categories.forEach(function(r){var n=e.pointsByCategory[r];!t&&e.kdeGridsByCategory[r]||(e.kdeGridsByCategory[r]=kde(n,e.bbox,100));var o=findContour(e.kdeGridsByCategory[r],e.bbox,n,e.options),i=computeCentroid(n),a=[];e.contourLines[r]=new Array(contourScales.length).fill().map(function(){return createLine(e.regl,{width:1,is2d:!0})}),contourScales.forEach(function(t,n){var s=interpolateContour(o,i,t);a.push(s),e.contourLines[r][n].setPoints(flatten(s))}),e.wingletLines[r]=createWinglets(e.regl,a,n,e.options)})}},{key:"setPoints",value:function(e){silhouetteIndex(e),this.bbox=getBBox(e,.1),this.pointsByCategory=groupBy(e,2),this.categories=Object.keys(this.pointsByCategory),this.kdeGridsByCategory={},this.processPoints(!0),this.applyColors(!0)}},{key:"setColors",value:function(e){this.colors=e,this.applyColors()}},{key:"applyColors",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.appliedColors!==this.colors&&0!==this.categories.length)&&(this.categories.forEach(function(t,r){for(var n=0;n<e.contourLines[t].length;++n)e.contourLines[t][n].setStyle({color:darkenColor(e.colors[4*r],.5)||darkenColor(defaultColors[r],.5)||[255,255,255,1]});e.wingletLines[t].setStyle({color:e.colors[4*r]||defaultColors[r]||[255,255,255,1]})}),this.appliedColors=this.colors)}},{key:"setOptions",value:function(e){this.options=_objectSpread({},this.options,e);var t={draw:!1,process:!1};Object.keys(e).forEach(function(e){t[optionActions[e]]=!0}),t.process&&this.processPoints(!1),this.draw()}},{key:"destroy",value:function(){var e=this;this.categories.forEach(function(t){for(var r=0;r<e.contourLines[t].length;++r)e.contourLines[t][r].destroy();e.wingletLines[t].destroy()})}}]),e}(),COLOR_ACTIVE_IDX=1,COLOR_BG_IDX=3,COLOR_HOVER_IDX=2,COLOR_NORMAL_IDX=0,COLOR_NUM_STATES=4,FLOAT_BYTES$1=Float32Array.BYTES_PER_ELEMENT,GL_EXTENSIONS=["OES_standard_derivatives","OES_texture_float"],LASSO_MIN_DELAY=15,LASSO_MIN_DIST=4,DEFAULT_DATA_ASPECT_RATIO=1,DEFAULT_WIDTH=100,DEFAULT_HEIGHT=100,DEFAULT_POINT_SIZE=6,DEFAULT_POINT_SIZE_SELECTED=2,DEFAULT_POINT_OUTLINE_WIDTH=2,DEFAULT_COLOR_BY=null,DEFAULT_COLOR_NORMAL=[.66,.66,.66,1],DEFAULT_COLOR_ACTIVE=[0,.55,1,1],DEFAULT_COLOR_HOVER=[1,1,1,1],DEFAULT_COLOR_BG=[0,0,0,1],DEFAULT_COLORS=[DEFAULT_COLOR_NORMAL,DEFAULT_COLOR_ACTIVE,DEFAULT_COLOR_HOVER,DEFAULT_COLOR_BG],DEFAULT_TARGET=[0,0],DEFAULT_DISTANCE=1,DEFAULT_ROTATION=0,DEFAULT_VIEW=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),DEFAULT_BACKGROUND_IMAGE=null,DEFAULT_LASSO_COLOR=[0,.666666667,1,1],DEFAULT_SHOW_RECTICLE=!1,DEFAULT_RECTICLE_COLOR=[1,1,1,.5],arrayMax=function(e,t){return e>t?e:t},checkReglExtensions=function(e){return!!e&&GL_EXTENSIONS.reduce(function(t,r){return e.hasExtension(r)?t:(console.warn("WebGL: ".concat(r," extension not supported. Scatterplot might not render properly")),!1)},!0)},createRegl=function(e){var t=e.getContext("webgl"),r=[];return GL_EXTENSIONS.forEach(function(e){t.getExtension(e)?r.push(e):console.warn("WebGL: ".concat(e," extension not supported. Scatterplot might not render properly"))}),createOriginalRegl({gl:t,extensions:r})},dist$3=function(e,t,r,n){return Math.sqrt(Math.pow(e-r,2)+Math.pow(t-n,2))},getBBox$1=function(e){for(var t=1/0,r=-1/0,n=1/0,o=-1/0,i=0;i<e.length;i+=2)t=e[i]<t?e[i]:t,r=e[i]>r?e[i]:r,n=e[i+1]<n?e[i+1]:n,o=e[i+1]>o?e[i+1]:o;return[t,n,r,o]},hexToRgb=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,n){return"#".concat(t).concat(t).concat(r).concat(r).concat(n).concat(n)}).substring(1).match(/.{2}/g).map(function(e){return parseInt(e,16)/Math.pow(255,t)})},loadImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(r,n){var o=new Image;t&&(o.crossOrigin="anonymous"),o.src=e,o.onload=function(){r(o)},o.onerror=function(e){n(e)}})},createTextureFromUrl=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(n,o){loadImage(t,r).then(function(t){n(e.texture(t))}).catch(function(e){o(e)})})},hexToRgba=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _toConsumableArray(hexToRgb(e,t)).concat([Math.pow(255,!t)])},isHex=function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},isNormFloat=function(e){return e>=0&&e<=1},isNormFloatArray=function(e){return Array.isArray(e)&&e.every(isNormFloat)},isPointInPolygon=function(){for(var e,t,r,n,o=_slicedToArray(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],2),i=o[0],a=o[1],s=arguments.length>1?arguments[1]:void 0,l=!1,u=0,c=s.length-2;u<s.length;u+=2)e=s[u],t=s[u+1],r=s[c],t>a!=(n=s[c+1])>a&&i<(r-e)*(a-t)/(n-t)+e&&(l=!l),c=u;return l},isUint8=function(e){return Number.isInteger(e)&&e>=0&&e<=255},isUint8Array=function(e){return Array.isArray(e)&&e.every(isUint8)},isRgb=function(e){return 3===e.length&&(isNormFloatArray(e)||isUint8Array(e))},isRgba=function(e){return 4===e.length&&(isNormFloatArray(e)||isUint8Array(e))},max$3=function(e,t){return e>t?e:t},min$3=function(e,t){return e<t?e:t},normNumArray=function(e){return e.map(function(t){return t/e.reduce(arrayMax,-1/0)})},toRgba=function(e,t){return isRgba(e)?t&&!isNormFloatArray(e)?normNumArray(e):e:isRgb(e)?_toConsumableArray(t?normNumArray(e):e).concat([Math.pow(255,!t)]):isHex(e)?hexToRgba(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},createScatterplot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.regl,r=e.background,n=void 0===r?DEFAULT_COLOR_BG:r,o=e.backgroundImage,i=void 0===o?DEFAULT_BACKGROUND_IMAGE:o,a=e.canvas,s=void 0===a?document.createElement("canvas"):a,l=e.colorBy,u=void 0===l?DEFAULT_COLOR_BY:l,c=e.colors,h=void 0===c?DEFAULT_COLORS:c,f=e.lassoColor,p=void 0===f?DEFAULT_LASSO_COLOR:f,d=e.lassoMinDelay,v=void 0===d?LASSO_MIN_DELAY:d,g=e.lassoMinDist,y=void 0===g?LASSO_MIN_DIST:g,m=e.showRecticle,b=void 0===m?DEFAULT_SHOW_RECTICLE:m,_=e.recticleColor,A=void 0===_?DEFAULT_RECTICLE_COLOR:_,T=e.pointSize,w=void 0===T?DEFAULT_POINT_SIZE:T,E=e.pointSizeSelected,S=void 0===E?DEFAULT_POINT_SIZE_SELECTED:E,L=e.pointOutlineWidth,x=void 0===L?DEFAULT_POINT_OUTLINE_WIDTH:L,O=e.width,$=void 0===O?DEFAULT_WIDTH:O,C=e.height,R=void 0===C?DEFAULT_HEIGHT:C,P=e.target,M=void 0===P?DEFAULT_TARGET:P,I=e.distance,j=void 0===I?DEFAULT_DISTANCE:I,D=e.rotation,F=void 0===D?DEFAULT_ROTATION:D,N=e.view,k=void 0===N?DEFAULT_VIEW:N,B=createPubSub(),U=new Float32Array(16),G=[0,0];checkReglExtensions(t);var Y,V,W,H,z,q,X,K,Z,J,Q,ee,te,re,ne,oe,ie=toRgba(n,!0),ae=i,se=s,le=h,ue=$,ce=R,he=w,fe=S,pe=x,de=t||createRegl(s),ve=!1,ge=!1,ye=[0,0],me=0,be=[],_e=toRgba(p,!0),Ae=+v,Te=+y,we=[],Ee=[],Se=DEFAULT_DATA_ASPECT_RATIO,Le=b,xe=toRgba(A,!0),Oe=0,$e=0,Ce=u,Re=!1,Pe=!1,Me=1,Ie=!1,je=null,De=function(){return[(t=G[0],t/ue*2-1),(e=G[1],1+e/ce*-2)];var e,t},Fe=function(){var e=_slicedToArray(De(),2),t=[e[0],e[1],1,1];return transformMat4$1(t,t,invert$3(U,multiply$3(U,q,multiply$3(U,Y.view,X)))),t.slice(0,2)},Ne=function(){var e,t=_slicedToArray(Fe(),2),r=t[0],n=t[1],o=Y.scaling,i=2*he*(min$3(1,o)+Math.log2(max$3(1,o)))*window.devicePixelRatio,a=i/ue,s=i/ce,l=z.range(r-a,n-s,r+a,n+s),u=i;return l.forEach(function(t){var o=_slicedToArray(z.points[t],2),i=o[0],a=o[1],s=dist$3(i,a,r,n);s<u&&(u=s,e=t)}),u<he/ue*2?e:-1},ke=function(){var e,t,r,n,o=G.slice();H?dist$3.apply(void 0,_toConsumableArray(o).concat(_toConsumableArray(H)))>Te&&((e=we).push.apply(e,_toConsumableArray(De())),(t=Ee).push.apply(t,_toConsumableArray(Fe())),H=o,we.length>2&&V.setPoints(we)):((r=we).push.apply(r,_toConsumableArray(De())),(n=Ee).push.apply(n,_toConsumableArray(Fe())),H=o)},Be=throttle(ke,Ae,!0),Ue=function(){be.length&&(B.publish("deselect"),be=[],bt())},Ge=function(e){be=e,ee({usage:"dynamic",type:"float",data:new Float32Array(be)}),B.publish("select",{points:be}),bt()},Ye=function(e){var t=se.getBoundingClientRect();return G[0]=e.clientX-t.left,G[1]=e.clientY-t.top,G.concat()},Ve=function(){var e,t,r,n,o,i=(r=getBBox$1(e=Ee),n=(t=z).range.apply(t,_toConsumableArray(r)),o=[],n.forEach(function(t){isPointInPolygon(z.points[t],e)&&o.push(t)}),o);Ge(i),we=[],Ee=[],H=void 0,V.clear()},We=function(e){Pe&&(ve=!0,ye=Ye(e),(ge=e.shiftKey)&&Y.config({isFixed:!0}))},He=function(){Pe&&(ve=!1,ge&&(ge=!1,Y.config({isFixed:!1}),Ve()))},ze=function(e){if(Pe){var t=Ye(e);if(!(dist$3.apply(void 0,_toConsumableArray(t).concat(_toConsumableArray(ye)))>=LASSO_MIN_DIST)){var r=Ne();r>=0&&Ge([r])}}},qe=function(){Ue()},Xe=function(e){if(Pe){if(Ye(e),Ie&&!ge){var t=Ne();Tt(t)}ge&&Be(),ve&&bt()}},Ke=function(){Pe&&(ne=void 0,Ie=!1,He(),bt())},Ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=e.length;$e=Math.max(2,Math.ceil(Math.sqrt(t)));var r=new Float32Array(4*Math.pow($e,2));return e.forEach(function(e,t){r[4*t]=e[0],r[4*t+1]=e[1],r[4*t+2]=e[2],r[4*t+3]=t%COLOR_NUM_STATES>0||1===Me?e[3]:Me}),de.texture({data:r,shape:[$e,$e,4],type:"float"})},Je=function(){q=fromScaling$3([],[1/(ue/ce),1,1]),X=fromScaling$3([],[Se,1,1])},Qe=function(){return re},et=function(){return $e},tt=function(){return ee},rt=function(){return he*window.devicePixelRatio},nt=function(){return 0},ot=function(){return J},it=function(){return Oe},at=function(){return q},st=function(){return Y.view},lt=function(){return X},ut=function(){return Y.scaling},ct=function(){return 1*("category"===Ce)},ht=function(){return 1*("value"===Ce)},ft=function(){return le.length/COLOR_NUM_STATES-1},pt=function(){return COLOR_NUM_STATES},dt=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:COLOR_NORMAL_IDX;return de({frag:FRAGMENT_SHADER$2,vert:VERTEX_SHADER$2,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:r,size:1}},uniforms:{projection:at,model:lt,view:st,scaling:ut,pointSize:rt,pointSizeExtra:e,globalState:n,colorTex:Qe,colorTexRes:et,stateTex:ot,stateTexRes:it,isColoredByCategory:ct,isColoredByValue:ht,maxColor:ft,numColorStates:pt},count:t,primitive:"points"})},vt=dt(nt,function(){return me},function(){return Q}),gt=dt(nt,function(){return 1},function(){return te},COLOR_HOVER_IDX),yt=de({frag:FRAGMENT_SHADER$1,vert:VERTEX_SHADER$1,attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{projection:at,model:lt,view:st,texture:function(){return ae}},count:6}),mt=function(e){Pe=!1,me=e.length,J=function(e){var t=e.length;Oe=Math.max(2,Math.ceil(Math.sqrt(t)));for(var r=new Float32Array(4*Math.pow(Oe,2)),n=0;n<t;++n)r[4*n]=e[n][0],r[4*n+1]=e[n][1],r[4*n+2]=e[n][2]||0,r[4*n+3]=e[n][3]||0;return de.texture({data:r,shape:[Oe,Oe,4],type:"float"})}(e),Q({usage:"static",type:"float",data:function(e){for(var t=new Float32Array(e),r=0;r<e;++r)t[r]=r;return t}(me)}),z=new KDBush(e,function(e){return e[0]},function(e){return e[1]},16),Pe=!0,je.setPoints(e)},bt=withRaf(function(e,t){var r;e&&mt(e),Pe&&(de.clear({color:[0,0,0,0],depth:1}),Re=Y.tick(),ae&&yt(),vt(),ve||!Le&&!t||function(){if(ne>=0){var e=_slicedToArray(z.points[ne].slice(0,2),2),t=[e[0],e[1],0,1];multiply$3(U,q,multiply$3(U,Y.view,X)),transformMat4$1(t,t,U),K.setPoints([-1,t[1],1,t[1]]),Z.setPoints([t[0],1,t[0],-1]),K.draw(),Z.draw(),dt(function(){return(fe+2*pe)*window.devicePixelRatio},function(){return 1},te,COLOR_ACTIVE_IDX)(),dt(function(){return(fe+pe)*window.devicePixelRatio},function(){return 1},te,COLOR_BG_IDX)()}}(),ne>=0&&gt(),be.length&&(r=be.length,dt(function(){return(fe+2*pe)*window.devicePixelRatio},function(){return r},tt,COLOR_ACTIVE_IDX)(),dt(function(){return(fe+pe)*window.devicePixelRatio},function(){return r},tt,COLOR_BG_IDX)(),dt(function(){return fe},function(){return r},tt,COLOR_ACTIVE_IDX)()),V.draw(),je.draw({model:X,view:Y.view,projection:q}),Re&&B.publish("view",Y.view))}),_t=function(){de.poll()},At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.background,r=void 0===t?null:t,n=e.backgroundImage,o=void 0===n?ae:n,i=e.colorBy,a=void 0===i?Ce:i,s=e.colors,l=void 0===s?null:s,u=e.opacity,c=void 0===u?null:u,h=e.lassoColor,f=void 0===h?null:h,p=e.lassoMinDelay,d=void 0===p?null:p,v=e.lassoMinDist,g=void 0===v?null:v,y=e.showRecticle,m=void 0===y?null:y,b=e.recticleColor,_=void 0===b?null:b,A=e.pointOutlineWidth,T=void 0===A?null:A,w=e.pointSize,E=void 0===w?null:w,S=e.pointSizeSelected,L=void 0===S?null:S,x=e.height,O=void 0===x?null:x,$=e.width,C=void 0===$?null:$,R=e.aspectRatio,P=void 0===R?null:R;!function(e){e&&(ie=toRgba(e,!0))}(r),function(e){ae=e||null}(o),function(e){switch(e){case"category":Ce="category";break;case"value":Ce="value";break;default:Ce=DEFAULT_COLOR_BY}}(a),function(e){if(e&&e.length){var t=[];try{e.forEach(function(e){if(!Array.isArray(e)||isRgb(e)||isRgba(e)){var r=toRgba(e,!0),n=_toConsumableArray(r.slice(0,3)).concat([1]);t.push(r,n,n)}else for(var o=0;o<3;o++)t.push(toRgba(e[o],!0));t.push(ie)})}catch(e){console.error(e,"Invalid format. Please specify an array of colors or a nested array of accents per colors.")}le=t,je.setColors(le);try{re=Ze()}catch(e){le=DEFAULT_COLORS,re=Ze(),console.error("Invalid colors. Switching back to default colors.")}}}(l),function(e){!+e||+e<=0||(Me=+e,re=Ze())}(c),function(e){e&&(_e=toRgba(e,!0),V.setStyle({color:_e}))}(f),function(e){+e&&(Be=throttle(ke,Ae=+e,!0))}(d),function(e){+e&&(Te=+e)}(g),function(e){null!==e&&(Le=e)}(m),function(e){e&&(xe=toRgba(e,!0),K.setStyle({color:xe}),Z.setStyle({color:xe}))}(_),function(e){!+e||+e<0||(pe=+e)}(T),function(e){!+e||+e<=0||(he=+e)}(E),function(e){!+e||+e<0||(fe=+e)}(L),function(e){!+e||+e<=0||(ce=+e,se.height=ce*window.devicePixelRatio)}(O),function(e){!+e||+e<=0||(ue=+e,se.width=ue*window.devicePixelRatio)}(C),function(e){+e<=0||(Se=e)}(P),Je(),Y.refresh(),_t(),bt()},Tt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1;if(e>=0){r=!0;var n=e!==ne;ne=e,te.subdata([e]),n&&B.publish("pointover",ne)}else r=ne,ne=void 0,+r>=0&&B.publish("pointout",r);r&&bt(null,t)},wt=function(e){switch(e.key){case"Escape":Ue()}},Et=function(){Ie=!0},St=function(){Tt(),Ie=!1,bt()};return Je(),Y=canvas2dCamera(se),k?Y.set(clone$3(k)):Y.lookAt(_toConsumableArray(M),j,F),V=createLine(de,{color:_e,width:3,is2d:!0}),K=createLine(de,{color:xe,width:1,is2d:!0}),Z=createLine(de,{color:xe,width:1,is2d:!0}),W=scrollSpeed$1(se),je=new Winglets(de),W.on("scroll",function(){bt()}),Q=de.buffer(),ee=de.buffer(),te=de.buffer({usage:"dynamic",type:"float",length:FLOAT_BYTES$1}),re=Ze(),At({width:ue,height:ce}),window.addEventListener("keyup",wt,!1),window.addEventListener("blur",Ke,!1),window.addEventListener("mousedown",We,!1),window.addEventListener("mouseup",He,!1),window.addEventListener("mousemove",Xe,!1),se.addEventListener("mouseenter",Et,!1),se.addEventListener("mouseleave",St,!1),se.addEventListener("click",ze,!1),se.addEventListener("dblclick",qe,!1),{deselect:Ue,destroy:function(){window.removeEventListener("keyup",wt,!1),window.removeEventListener("blur",Ke,!1),window.removeEventListener("mousedown",We,!1),window.removeEventListener("mouseup",He,!1),window.removeEventListener("mousemove",Xe,!1),se.removeEventListener("mouseenter",Et,!1),se.removeEventListener("mouseleave",St,!1),se.removeEventListener("click",ze,!1),se.removeEventListener("dblclick",qe,!1),se=void 0,Y=void 0,de=void 0,V.destroy(),W.dispose(),B.clear(),je.destroy()},draw:bt,get:function(e){return"background"===e?ie:"backgroundImage"===e?ae:"colorBy"===e?Ce:"colors"===e?le:"lassoColor"===e?_e:"showRecticle"===e?Le:"recticleColor"===e?xe:"opacity"===e?Me:"pointOutlineWidth"===e?pe:"pointSize"===e?he:"pointSizeSelected"===e?fe:"width"===e?ue:"height"===e?ce:"aspectRatio"===e?Se:"canvas"===e?se:"regl"===e?de:"version"===e?"0.0.1":void 0},hover:Tt,refresh:_t,reset:(oe=function(){k?Y.set(clone$3(k)):Y.lookAt(_toConsumableArray(M),j,F),B.publish("view",Y.view)},function(){var e=oe.apply(void 0,arguments);return bt(),e}),select:Ge,set:At,subscribe:B.subscribe,unsubscribe:B.unsubscribe}};export default createScatterplot;export{createRegl,createTextureFromUrl};
