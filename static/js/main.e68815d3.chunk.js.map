{"version":3,"sources":["scatterplot/camera.js","scatterplot/bg.frag","scatterplot/bg.vert","scatterplot/point.frag","scatterplot/point.vert","scatterplot/patterns/pattern.vert","scatterplot/patterns/pulse/pulse.frag","scatterplot/patterns/pulse/index.js","scatterplot/patterns/radar/radar.frag","scatterplot/patterns/radar/index.js","scatterplot/patterns/PatternManager.js","scatterplot/patterns/plain/index.js","scatterplot/patterns/plain/plain.frag","scatterplot/constants.js","scatterplot/utils.js","scatterplot/index.js","constants.js","actions/index.js","useSlider.js","ScatterplotOptions.js","dataGen.js","ClusterHeader.js","ClusterOptions.js","data/Diamonds/index.js","data/Diamonds/diamonds.csv","data/Abalone/index.js","data/Abalone/abalone.csv","data/Beautiful/index.js","data/Beautiful/BeautifulClusters.csv","loadData.js","parseData.js","DataLoader.js","DataOptions.js","PatternHeader.js","reducers/categoryColors.js","useColorPicker.js","PulseOptions.js","RadarOptions.js","PatternOptions.js","PatternsOptions.js","Sidebar.js","Meta.js","LoadingOverlay.js","App.js","serviceWorker.js","reducers/index.js","reducers/isDarkTheme.js","reducers/isLoading.js","reducers/maxCategories.js","index.js"],"names":["dom2dCamera","element","distance","target","rotation","isNdc","isFixed","isPan","panSpeed","isRotate","rotateSpeed","isZoom","zoomSpeed","onKeyDown","onKeyUp","onMouseDown","onMouseUp","onMouseMove","onWheel","camera","createCamera","isChanged","mouseX","mouseY","prevMouseX","prevMouseY","isLeftMousePressed","yScroll","top","left","width","height","aspectRatio","isAlt","transformPanX","dX","transformPanY","dY","transformScaleX","x","transformScaleY","y","tick","pan","dZ","Math","exp","transformedX","transformedY","scale","wh","hh","x1","y1","x2","y2","radians","vec2","angle","cross","rotate","sign","config","newIsFixed","newIsPan","newIsRotate","newIsZoom","newPanSpeed","newRotateSpeed","newZoomSpeed","refresh","bBox","getBoundingClientRect","keyUpHandler","event","keyDownHandler","altKey","mouseUpHandler","mouseDownHandler","buttons","mouseMoveHandler","clientX","clientY","wheelHandler","preventDefault","deltaMode","deltaY","dispose","undefined","window","removeEventListener","addEventListener","passive","defaultOptions","a","c1","c2","minValue","phaseShift","cyclesPerSecond","wavesPerCycle","direction","invert","curve","hueVariation","hueVariationPeriod","gamma1","gamma2","maxValue","nSpokes","PATTERN_TYPES","defaultPulseOptions","defaultRadarOptions","PATTERN_RESOLUTION","PatternManager","regl","Error","this","fbo","framebuffer","patternDraws","drawFn","frag","vert","attributes","position","buffer","uniforms","resolution","prop","texAtlasIndex","texAtlasSize","time","hsvColor","useColors","count","atlasSize","atlasIndex","createPlainDraw","animationMix","options","createPulseDraw","createRadarDraw","patterns","maxCategories","max","Object","keys","resize","categoriesToRemove","Set","forEach","pattern","delete","category","toString","set","destroy","_has","updateSize","showPatterns","i","type","clear","color","depth","FLOAT_BYTES","Float32Array","BYTES_PER_ELEMENT","GL_EXTENSIONS","DEFAULT_COLOR_BG","DEFAULT_COLORS","DEFAULT_TARGET","DEFAULT_VIEW","DEFAULT_LASSO_COLOR","DEFAULT_RECTICLE_COLOR","arrayMax","checkReglExtensions","reduce","every","EXTENSION","hasExtension","console","warn","createRegl","canvas","gl","getContext","extensions","getExtension","push","createOriginalRegl","dist","sqrt","getBBox","positions2d","xMin","Infinity","xMax","yMin","yMax","length","hexToRgb","hex","isNormalize","replace","m","r","g","b","substring","match","map","parseInt","isNormFloat","isNormFloatArray","Array","isArray","isPointInPolygon","px","py","polygon","isWithin","j","isUint8","Number","isInteger","isUint8Array","isRgb","rgb","isRgba","rgba","min","normNumArray","toRgba","test","hexToRgba","createScatterplot","initialRegl","background","initialBackground","backgroundImage","initialBackgroundImage","initialCanvas","document","createElement","colorBy","initialColorBy","colors","initialColors","lassoColor","initialLassoColor","lassoMinDelay","initialLassoMinDelay","lassoMinDist","initialLassoMinDist","showRecticle","initialShowRecticle","recticleColor","initialRecticleColor","pointSize","initialPointSize","pointSizeSelected","initialPointSizeSelected","pointOutlineWidth","initialPointOutlineWidth","initialWidth","initialHeight","initialTarget","initialDistance","initialRotation","view","initialView","pubSub","createPubSub","scratch","mousePosition","lasso","lassoPrevMousePos","searchIndex","viewAspectRatio","projection","model","recticleHLine","recticleVLine","stateTex","normalPointsIndexBuffer","selectedPointsIndexBuffer","hoveredPointIndexBuffer","colorTex","hoveredPoint","bboxTex","glBench","mouseDown","mouseDownShift","mouseDownPosition","numPoints","selection","lassoPos","lassoScatterPos","dataAspectRatio","stateTexRes","colorTexRes","isViewChanged","isInit","opacity","isMouseInCanvas","bboxTexRes","animateDepth","patternManager","getMousePos","slice","getNdcX","getNdcY","getMouseGlPos","getScatterGlPos","v","mvp","mat4","multiply","vec4","transformMat4","raycast","clostestPoint","scaling","scaledPointSize","log2","devicePixelRatio","xNormalizedScaledPointSize","yNormalizedScaledPointSize","pointsInBBox","range","minDist","idx","points","ptX","ptY","d","lassoExtend","currMousePos","setPoints","lassoExtendDb","withThrottle","findPointsInLasso","lassoPolygon","pointsInPolygon","pointIdx","deselect","publish","select","usage","data","getRelativeMousePosition","rect","lassoEnd","pointsInLasso","shiftKey","mouseClickHandler","currentMousePosition","mouseDblClickHandler","hover","blurHandler","createColorTexture","newColors","numColors","ceil","texture","shape","updateViewAspectRatio","fromScaling","setDataAspectRatio","newDataAspectRatio","setColors","tmp","rgbaOpaque","e","error","setHeight","newHeight","setPointSize","newPointSize","setPointSizeSelected","newPointSizeSelected","setPointOutlineWidth","newPointOutlineWidth","setWidth","newWidth","setColorBy","setOpacity","newOpacity","getBackgroundImage","getColorTex","getColorTexRes","getNormalPointsIndexBuffer","getSelectedPointsIndexBuffer","getPointSize","getNormalPointSizeExtra","getStateTex","getStateTexRes","getProjection","getView","getModel","getScaling","getNormalNumPoints","getIsColoredByCategory","getIsColoredByValue","getMaxColor","getNumColorStates","getTexture","getAtlasSize","getBBoxTex","getBBoxTexRes","getAnimateDepth","drawPoints","getPointSizeExtra","getNumPoints","getStateIndexBuffer","globalState","POINT_FS","POINT_VS","blend","enable","func","srcRGB","srcAlpha","dstRGB","dstAlpha","stateIndex","size","pointSizeExtra","isColoredByCategory","isColoredByValue","maxColor","numColorStates","textureAtlas","primitive","drawPointBodies","drawHoveredPoint","drawSelectedPoint","numOutlinedPoints","drawBackgroundImage","BG_FS","BG_VS","drawRecticle","draw","createPointIndex","numNewPoints","index","createStateTexture","newPoints","createBBoxTexture","bboxByCategory","numCategories","computeCentroid","sumX","sumY","point","computeBBox","centroid","maxSquaredDist","squaredDist","maxDist","KDBush","p","pointsByCategory","_groupBy","_mapValues","_","showRecticleOnce","stencil","drawRaf","withRaf","publicDraw","withDraw","f","out","setBackground","newBackground","setBackgroundImage","newBackgroundImage","setLassoColor","newLassoColor","setStyle","setLassoMinDelay","newLassoMinDelay","setLassoMinDist","newLassoMinDist","setShowRecticle","newShowRecticle","setRecticleColor","newRecticleColor","setAnimationMix","newAnimationMix","setAnimateDepth","newAnimateDepth","setShowPatterns","newShowPatterns","setUseColors","newUseColors","poll","get","property","newColorBy","needsRedraw","newHoveredPoint","subdata","reset","clone","lookAt","key","mouseEnterCanvasHandler","mouseLeaveCanvasHandler","initCamera","createDom2dCamera","init","createLine","is2d","GLBench","frame","begin","end","nextFrame","floor","subscribe","unsubscribe","defaultValues","defaultPatterns","setLoading","value","setMaxCategories","updateValue","_debounce","optionName","newValue","useSlider","defaultValue","processNewValueFn","useState","setValue","onChange","_isFunction","useEffect","renderPercentage","val","round","ScatterplotOptions","scatterplot","pointSizeChange","animationMixChange","isDarkTheme","useSelector","state","dispatch","useDispatch","defaultChecked","label","innerLabel","innerLabelChecked","alignIndicator","Alignment","RIGHT","checked","inline","stepSize","labelStepSize","labelPrecision","fill","className","labelRenderer","newSat","newVal","newAlpha","disabled","style","textAlign","boxMuller","sigma","k","u1","u2","twoPI","PI","random","EPSILON","radius","log","z0","cos","z1","sin","cosA","sinA","kcossinMcossin","ClusterHeader","clusterKey","setIsOpen","isOpen","categoryColors","shallowEqual","minimal","active","onClick","backgroundColor","updateX","setCluster","updateY","updateSigma","updateAngle","updateAmplitude","amplitude","updateN","n","updateCategory","ClusterOptions","cluster","removeCluster","setX","setY","setSigma","setAngle","setAmplitude","setN","setCategory","intent","Intent","DANGER","csv","dataFields","catFields","loadData","dataOptions","xField","yField","catField","categories","Map","nCategories","POSITIVE_INFINITY","NEGATIVE_INFINITY","res","Promise","resolve","reject","Papa","parse","header","dynamicTyping","skipEmptyLines","download","step","results","has","complete","xLength","yLength","parseData","csvFile","fieldNames","parsedFields","fieldIsCategory","fieldValuesSet","fieldIsData","fieldName","add","dataSources","Diamonds","Abalone","Beautiful","DataOptions","setDataOptions","prevState","xOptions","filter","field","yOptions","newX","newY","newCat","DataLoader","dataSource","setDataSource","inputFile","setInputFile","fileInputRef","useRef","inputFieldsRef","loadClickHandler","inputFileChange","current","files","text","name","hasSelection","inputProps","ref","PRIMARY","defaultCluster","keyGen","1","2","clusters","setClusters","dataGen","acc","curr","concat","createSetCluster","newCluster","oldClusters","renderClusterOptions","usedCategories","unusedCategory","PatternHeader","patternKey","defaultColors","useColorPicker","setPattern","setColor","newColor","hsv","h","s","updateCategoryColor","renderSeconds","toPrecision","PulseOptions","aChange","c1Change","c2Change","minValueChange","phaseShiftChange","cyclesPerSecondChange","wavesPerCycleChange","curveChange","colorChange","hueVariationChange","hueVariationPeriodChange","circleSize","circleSpacing","RadarOptions","gamma1Change","gamma2Change","maxValueChange","nSpokesChange","PatternOptions","typeOptions","importFileRef","onImportClick","textPromise","JSON","patternJSON","patternOptions","jsonFile","Blob","stringify","saveAs","buttonText","accept","toHsvColor","hsvObj","tinycolor","toHsv","setPatterns","setAll","createSetPattern","newPattern","oldPatterns","categoriesToAdd","removePattern","addPattern","renderPatternOptions","Sidebar","elevation","id","title","panel","Meta","LoadingOverlay","isLoading","display","App","setScatterplot","canvasRef","useCallback","initColors","initScatterplot","darkBg","Boolean","location","hostname","combineReducers","action","shallowCopy","store","createStore","rootReducer","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.e68815d3.chunk.js","sourcesContent":["import createCamera from \"camera-2d-simple\";\r\nimport { vec2 } from \"gl-matrix\";\r\n\r\nconst dom2dCamera = (\r\n  element,\r\n  {\r\n    distance = 1.0,\r\n    target = [0, 0],\r\n    rotation = 0,\r\n    isNdc = true,\r\n    isFixed = false,\r\n    isPan = true,\r\n    panSpeed = 1,\r\n    isRotate = true,\r\n    rotateSpeed = 1,\r\n    isZoom = true,\r\n    zoomSpeed = 1,\r\n    onKeyDown = () => {},\r\n    onKeyUp = () => {},\r\n    onMouseDown = () => {},\r\n    onMouseUp = () => {},\r\n    onMouseMove = () => {},\r\n    onWheel = () => {}\r\n  } = {}\r\n) => {\r\n  let camera = createCamera(target, distance, rotation);\r\n  let isChanged = false;\r\n  let mouseX = 0;\r\n  let mouseY = 0;\r\n  let prevMouseX = 0;\r\n  let prevMouseY = 0;\r\n  let isLeftMousePressed = false;\r\n  let yScroll = 0;\r\n\r\n  let top = 0;\r\n  let left = 0;\r\n  let width = 1;\r\n  let height = 1;\r\n  let aspectRatio = 1;\r\n  let isAlt = false;\r\n\r\n  const transformPanX = isNdc\r\n    ? dX => (dX / width) * 2 * aspectRatio // to normalized device coords\r\n    : dX => dX;\r\n  const transformPanY = isNdc\r\n    ? dY => (dY / height) * 2 // to normalized device coords\r\n    : dY => -dY;\r\n\r\n  const transformScaleX = isNdc\r\n    ? x => (-1 + (x / width) * 2) * aspectRatio // to normalized device coords\r\n    : x => x;\r\n  const transformScaleY = isNdc\r\n    ? y => 1 - (y / height) * 2 // to normalized device coords\r\n    : y => y;\r\n\r\n  const tick = () => {\r\n    if (isFixed) return false;\r\n\r\n    isChanged = false;\r\n\r\n    if (isPan && isLeftMousePressed && !isAlt) {\r\n      // To pan 1:1 we need to half the width and height because the uniform\r\n      // coordinate system goes from -1 to 1.\r\n      camera.pan([\r\n        transformPanX(panSpeed * (mouseX - prevMouseX)),\r\n        transformPanY(panSpeed * (prevMouseY - mouseY))\r\n      ]);\r\n      isChanged = true;\r\n    }\r\n\r\n    if (isZoom && yScroll) {\r\n      const dZ = zoomSpeed * Math.exp(yScroll / height);\r\n\r\n      // Get normalized device coordinates (NDC)\r\n      const transformedX = transformScaleX(mouseX);\r\n      const transformedY = transformScaleY(mouseY);\r\n\r\n      camera.scale(1 / dZ, [transformedX, transformedY]);\r\n\r\n      isChanged = true;\r\n    }\r\n\r\n    if (isRotate && isLeftMousePressed && isAlt) {\r\n      const wh = width / 2;\r\n      const hh = height / 2;\r\n      const x1 = prevMouseX - wh;\r\n      const y1 = hh - prevMouseY;\r\n      const x2 = mouseX - wh;\r\n      const y2 = hh - mouseY;\r\n      // Angle between the start and end mouse position with respect to the\r\n      // viewport center\r\n      const radians = vec2.angle([x1, y1], [x2, y2]);\r\n      // Determine the orientation\r\n      const cross = x1 * y2 - x2 * y1;\r\n\r\n      camera.rotate(rotateSpeed * radians * Math.sign(cross));\r\n\r\n      isChanged = true;\r\n    }\r\n\r\n    // Reset scroll delta and mouse position\r\n    yScroll = 0;\r\n    prevMouseX = mouseX;\r\n    prevMouseY = mouseY;\r\n\r\n    return isChanged;\r\n  };\r\n\r\n  const config = ({\r\n    isFixed: newIsFixed = null,\r\n    isPan: newIsPan = null,\r\n    isRotate: newIsRotate = null,\r\n    isZoom: newIsZoom = null,\r\n    panSpeed: newPanSpeed = null,\r\n    rotateSpeed: newRotateSpeed = null,\r\n    zoomSpeed: newZoomSpeed = null\r\n  } = {}) => {\r\n    isFixed = newIsFixed !== null ? newIsFixed : isFixed;\r\n    isPan = newIsPan !== null ? newIsPan : isPan;\r\n    isRotate = newIsRotate !== null ? newIsRotate : isRotate;\r\n    isZoom = newIsZoom !== null ? newIsZoom : isZoom;\r\n    panSpeed = +newPanSpeed > 0 ? newPanSpeed : panSpeed;\r\n    rotateSpeed = +newRotateSpeed > 0 ? newRotateSpeed : rotateSpeed;\r\n    zoomSpeed = +newZoomSpeed > 0 ? newZoomSpeed : zoomSpeed;\r\n  };\r\n\r\n  const refresh = () => {\r\n    const bBox = element.getBoundingClientRect();\r\n    top = bBox.top;\r\n    left = bBox.left;\r\n    width = bBox.width;\r\n    height = bBox.height;\r\n    aspectRatio = width / height;\r\n  };\r\n\r\n  const keyUpHandler = event => {\r\n    isAlt = false;\r\n\r\n    onKeyUp(event);\r\n  };\r\n\r\n  const keyDownHandler = event => {\r\n    isAlt = event.altKey;\r\n\r\n    onKeyDown(event);\r\n  };\r\n\r\n  const mouseUpHandler = event => {\r\n    isLeftMousePressed = false;\r\n\r\n    onMouseUp(event);\r\n  };\r\n\r\n  const mouseDownHandler = event => {\r\n    isLeftMousePressed = event.buttons === 1;\r\n\r\n    onMouseDown(event);\r\n  };\r\n\r\n  const mouseMoveHandler = event => {\r\n    //prevMouseX = mouseX;\r\n    //prevMouseY = mouseY;\r\n    mouseX = event.clientX - left;\r\n    mouseY = event.clientY - top;\r\n\r\n    onMouseMove(event);\r\n  };\r\n\r\n  const wheelHandler = event => {\r\n    event.preventDefault();\r\n\r\n    const scale = event.deltaMode === 1 ? 12 : 1;\r\n\r\n    yScroll += scale * (event.deltaY || 0);\r\n\r\n    onWheel(event);\r\n  };\r\n\r\n  const dispose = () => {\r\n    camera = undefined;\r\n    window.removeEventListener(\"keydown\", keyDownHandler);\r\n    window.removeEventListener(\"keyup\", keyUpHandler);\r\n    element.removeEventListener(\"mousedown\", mouseDownHandler);\r\n    window.removeEventListener(\"mouseup\", mouseUpHandler);\r\n    window.removeEventListener(\"mousemove\", mouseMoveHandler);\r\n    element.removeEventListener(\"wheel\", wheelHandler);\r\n  };\r\n\r\n  window.addEventListener(\"keydown\", keyDownHandler, { passive: true });\r\n  window.addEventListener(\"keyup\", keyUpHandler, { passive: true });\r\n  element.addEventListener(\"mousedown\", mouseDownHandler, { passive: true });\r\n  window.addEventListener(\"mouseup\", mouseUpHandler, { passive: true });\r\n  window.addEventListener(\"mousemove\", mouseMoveHandler, { passive: true });\r\n  element.addEventListener(\"wheel\", wheelHandler, { passive: false });\r\n\r\n  refresh();\r\n\r\n  camera.config = config;\r\n  camera.dispose = dispose;\r\n  camera.refresh = refresh;\r\n  camera.tick = tick;\r\n\r\n  return camera;\r\n};\r\n\r\nexport default dom2dCamera;\r\n","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nuniform sampler2D texture;\\n\\nvarying vec2 uv;\\n\\nvoid main () {\\n  gl_FragColor = texture2D(texture, uv);\\n}\\n\";","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nuniform mat4 projection;\\nuniform mat4 model;\\nuniform mat4 view;\\n\\nattribute vec2 position;\\n\\nvarying vec2 uv;\\n\\nvoid main () {\\n  uv = position;\\n  gl_Position = projection * view * model * vec4(1.0 - 2.0 * position, 0, 1);\\n}\\n\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision mediump float;\\n#define GLSLIFY 1\\n\\nvarying vec4 color;\\nvarying vec2 uv;\\nuniform bool animateDepth;\\n\\nvoid main() {\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\n  r = dot(cxy, cxy);\\n\\n  if (animateDepth) {\\n    alpha = 1.0 - step(1.0, r);\\n    if (alpha < 1.0) discard;\\n    gl_FragColor = vec4(color.rgb, alpha);\\n  } else {\\n    #ifdef GL_OES_standard_derivatives\\n      delta = fwidth(r);\\n      alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\n    #endif\\n\\n    gl_FragColor = vec4(color.rgb, alpha * color.a);\\n  }\\n  //if (alpha < 0.33) discard;\\n  //gl_FragColor = vec4(color.rgb, alpha);\\n}\\n\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nuniform sampler2D colorTex;\\nuniform float colorTexRes;\\nuniform sampler2D stateTex;\\nuniform float stateTexRes;\\nuniform float pointSize;\\nuniform float pointSizeExtra;\\nuniform float numPoints;\\nuniform float globalState;\\nuniform float isColoredByCategory;\\nuniform float isColoredByValue;\\nuniform float maxColor;\\nuniform float numColorStates;\\nuniform float scaling;\\nuniform mat4 projection;\\nuniform mat4 model;\\nuniform mat4 view;\\n\\nattribute float stateIndex;\\n\\nuniform sampler2D textureAtlas;\\nuniform vec2 atlasSize;\\n\\nuniform sampler2D bboxTex;\\nuniform float bboxTexRes;\\n\\n// variables to send to the fragment shader\\nvarying vec4 color;\\nvarying vec2 uv;\\n\\nfloat modI(float a, float b) {\\n  float m = a - floor((a + 0.5) / b) * b;\\n   return floor(m + 0.5);\\n}\\n\\nvec4 getFromTexture(in sampler2D texture, in float textureRes, in float index) {\\n  float eps = 0.5 / textureRes;\\n  float rowIndex = floor((index + eps) / textureRes);\\n  vec2 texIndex = vec2(\\n    (index / textureRes) - rowIndex + eps,\\n    rowIndex / textureRes + eps\\n  );\\n  return texture2D(texture, texIndex);\\n}\\n\\nvec2 texAtlasIndex(in float index, in vec2 position) {\\n  float maxLength = atlasSize.x * atlasSize.y;\\n  float modIndex = modI(index, maxLength);\\n\\n  float yIndex = floor((modIndex + 0.5) / atlasSize.x);\\n  float xIndex = modI(modIndex, atlasSize.x);\\n\\n  float yStep = 1.0 / atlasSize.y;\\n  float xStep = 1.0 / atlasSize.x;\\n\\n  vec2 min = vec2(xIndex * xStep, yIndex * yStep);\\n  vec2 max = vec2((xIndex + 1.0) * xStep, (yIndex + 1.0) * yStep);\\n\\n  return position * (max - min) + min;\\n}\\n\\nvec4 findColor(in float category) {\\n  // this should be generalizable\\n  vec4 bbox = getFromTexture(bboxTex, bboxTexRes, category);\\n\\n  vec2 min = bbox.xy;\\n  vec2 max = bbox.zw;\\n  vec2 normalizedPosition = (uv - min) / (max - min);\\n\\n  return texture2D(textureAtlas, texAtlasIndex(category, normalizedPosition));\\n}\\n\\nvoid main() {\\n  // First get the state\\n  vec4 state = getFromTexture(stateTex, stateTexRes, stateIndex);\\n\\n  uv = state.xy;\\n\\n  // Determine color index\\n  float colorIndexCat = state.z * isColoredByCategory;\\n  float colorIndexVal = floor(state.w * maxColor) * isColoredByValue;\\n  float colorIndex = colorIndexCat + colorIndexVal;\\n  // Multiply by the number of color states per color\\n  // I.e., normal, active, hover, background, etc.\\n  colorIndex *= numColorStates;\\n  // Half a \\\"pixel\\\" or \\\"texel\\\" in texture coordinates\\n  float eps = 0.5 / colorTexRes;\\n  float colorLinearIndex = colorIndex + globalState;\\n  // Need to add cEps here to avoid floating point issue that can lead to\\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\\n  // floor(3/3.0001) = 0!\\n  float colorRowIndex = floor((colorLinearIndex + eps) / colorTexRes);\\n\\n  vec2 colorTexIndex = vec2(\\n    (colorLinearIndex / colorTexRes) - colorRowIndex + eps,\\n    colorRowIndex / colorTexRes + eps\\n  );\\n\\n  //color = texture2D(colorTex, colorTexIndex);\\n  color = findColor(state.z);\\n\\n  gl_Position = projection * view * model * vec4(state.x, state.y, color.a * 0.99, 1); // depth gets clipped when z = 1.00, so * 0.99!\\n\\n  // The final scaling consists of linear scaling in [0, 1] and log scaling\\n  // in [1, [\\n  float finalScaling = min(1.0, scaling) + log2(max(1.0, scaling));\\n\\n  gl_PointSize = pointSize * finalScaling + pointSizeExtra;\\n}\\n\";","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nattribute vec2 position;\\n\\nuniform float texAtlasIndex;\\nuniform vec2 texAtlasSize;\\nuniform float time;\\n\\nvarying vec2 posMin;\\nvarying vec2 posMax;\\n\\nfloat modI(float a, float b) {\\n  float m = a - floor((a + 0.5) / b) * b;\\n  return floor(m + 0.5);\\n}\\n\\nvoid main () {\\n  float maxLength = texAtlasSize.x * texAtlasSize.y;\\n  float modIndex = modI(texAtlasIndex, maxLength);\\n\\n  float yIndex = floor((modIndex + 0.5) / texAtlasSize.x);\\n  float xIndex = modI(modIndex, texAtlasSize.x);\\n\\n  float yStep = 1.0 / float(texAtlasSize.y);\\n  float xStep = 1.0 / float(texAtlasSize.x);\\n\\n  posMin = vec2(xIndex * xStep, yIndex * yStep);\\n  posMax = vec2((xIndex + 1.0) * xStep, (yIndex + 1.0) * yStep);\\n\\n  vec2 texPos = (position + 1.0) * 0.5;\\n  texPos = texPos * (posMax - posMin) + posMin;\\n  texPos = texPos * 2.0 - 1.0; \\n\\n  gl_Position = vec4(texPos, 0, 1);\\n}\\n\";","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nfloat when_gt_2281831123(float x, float y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec2 when_gt_2281831123(vec2 x, vec2 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec3 when_gt_2281831123(vec3 x, vec3 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec4 when_gt_2281831123(vec4 x, vec4 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nfloat when_le_1062606552(float x, float y) {\\n  return 1.0 - when_gt_2281831123(x, y);\\n}\\n\\nvec2 when_le_1062606552(vec2 x, vec2 y) {\\n  return 1.0 - when_gt_2281831123(x, y);\\n}\\n\\nvec3 when_le_1062606552(vec3 x, vec3 y) {\\n  return 1.0 - when_gt_2281831123(x, y);\\n}\\n\\nvec4 when_le_1062606552(vec4 x, vec4 y) {\\n  return 1.0 - when_gt_2281831123(x, y);\\n}\\n\\nfloat when_eq_529295689(float x, float y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec2 when_eq_529295689(vec2 x, vec2 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec3 when_eq_529295689(vec3 x, vec3 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec4 when_eq_529295689(vec4 x, vec4 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\n//  Function from Iigo Quiles\\n//  https://www.shadertoy.com/view/MsS3Wc\\nvec3 hsv2rgb_smooth_1540259130( in vec3 c ) {\\n  vec3 rgb = clamp( abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\\n  rgb = rgb*rgb*(3.0-2.0*rgb); // cubic smoothing \\n  return c.z * mix( vec3(1.0), rgb, c.y);\\n}\\n\\nvec2 normalizeFragCoords(in vec2 resolution, in vec2 posMin, in vec2 posMax) {\\n  return (gl_FragCoord.xy / (resolution) - posMin) / (posMax - posMin); \\n}\\n\\nfloat hueWave(in float hue, in float time, in float period, in float variation) {\\n  // https://stackoverflow.com/a/22400799\\n  float amplitude = 1.0;\\n  float halfPeriod = period / 2.0;\\n  float triangleWave = (amplitude / halfPeriod) * (halfPeriod - abs(mod(time, period) - halfPeriod));\\n\\n  return mod(hue + (triangleWave * 2.0 - 1.0) * variation, 1.0);\\n}\\n\\nuniform vec3 hsvColor;\\nuniform float hueVariation;\\nuniform float hueVariationPeriod;\\nuniform vec2 resolution;\\nuniform float time;\\nuniform bool useColors;\\n\\nuniform float cyclesPerSecond;\\nuniform float wavesPerCycle;\\nuniform float direction;\\nuniform float invert;\\nuniform vec3 animationMix;\\n\\nuniform float a;\\nuniform float c1;\\nuniform float c2;\\nuniform float minValue;\\nuniform float phaseShift;\\nuniform float curve;\\n\\nvarying vec2 posMin;\\nvarying vec2 posMax;\\n\\nconst float PI = 3.1415926535897932384626433832795;\\n\\nfloat gauss(in float diff) {\\n  float c = c1 * when_gt_2281831123(diff, 0.0) + c2 * when_le_1062606552(diff, 0.0);\\n  return a * exp(-pow(diff, 2.0)/(2.0 * c * c));\\n}\\n\\nvoid main() {\\n  vec2 normalizedFragCoord = normalizeFragCoords(resolution, posMin, posMax);\\n\\n  vec2 centerDiff = normalizedFragCoord - vec2(0.5, 0.5);\\n  float fragAngle = atan(centerDiff.x, centerDiff.y);\\n\\n  float dist = distance(normalizedFragCoord, vec2(0.5, 0.5)) * 2.0 + fragAngle * curve * PI;\\n\\n  float scaledTime = direction * (cyclesPerSecond * time + phaseShift);\\n\\n  float diff = mod(dist - scaledTime, 1.0 / wavesPerCycle);\\n  float leftDiff = gauss(diff - 1.0 / wavesPerCycle);\\n  float middleDiff = gauss(diff);\\n  float rightDiff = gauss(diff + 1.0 / wavesPerCycle);\\n\\n  float value = max(leftDiff, max(middleDiff, rightDiff));\\n\\n  value = when_eq_529295689(invert, 1.0) * (value * -1.0 + 1.0) + when_eq_529295689(invert, 0.0) * value; \\n  value = value * (1.0 - minValue) + minValue;\\n  \\n  float hue = hueWave(hsvColor.x, time, hueVariationPeriod, hueVariation);\\n  float animateSaturation = mix(1.0, value, animationMix[0]) * float(useColors);\\n  float animateValue = mix(1.0, value, animationMix[1]);\\n  float animateAlpha = mix(1.0, value, animationMix[2]);\\n\\n  gl_FragColor = vec4(hsv2rgb_smooth_1540259130(vec3(hue, animateSaturation * hsvColor.y, animateValue * hsvColor.z)), animateAlpha);\\n}\\n\";","import vert from '../pattern.vert';\r\nimport frag from './pulse.frag';\r\n\r\nexport const defaultOptions = {\r\n  a: 1,\r\n  c1: 0.1,\r\n  c2: 0.1,\r\n  minValue: 0.5,\r\n  phaseShift: 0,\r\n  cyclesPerSecond: 1,\r\n  wavesPerCycle: 1,\r\n  direction: 1,\r\n  invert: 0,\r\n  curve: 0,\r\n  hueVariation: 0.05,\r\n  hueVariationPeriod: 2,\r\n};\r\n\r\nexport default function createPulseDraw(regl, fbo) { \r\n  const drawFn = regl({\r\n    frag: frag,\r\n    vert: vert,\r\n    attributes: {\r\n      position: regl.buffer([\r\n        [-1, -1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, 1],\r\n      ]),\r\n    },\r\n    uniforms: {\r\n      resolution: regl.prop('resolution'),\r\n      texAtlasIndex: regl.prop('texAtlasIndex'),\r\n      texAtlasSize: regl.prop('texAtlasSize'),\r\n      time: regl.prop('time'),\r\n      animationMix: regl.prop('animationMix'),\r\n      useColors: regl.prop('useColors'),\r\n\r\n      hsvColor: regl.prop('hsvColor'),\r\n      a: regl.prop('a'),\r\n      c1: regl.prop('c1'),\r\n      c2: regl.prop('c2'),\r\n      minValue: regl.prop('minValue'),\r\n      phaseShift: regl.prop('phaseShift'),\r\n      cyclesPerSecond: regl.prop('cyclesPerSecond'),\r\n      wavesPerCycle: regl.prop('wavesPerCycle'),\r\n      direction: regl.prop('direction'),\r\n      invert: regl.prop('invert'),\r\n      curve: regl.prop('curve'),\r\n      hueVariation: regl.prop('hueVariation'),\r\n      hueVariationPeriod: regl.prop('hueVariationPeriod'),\r\n    },\r\n    count: 6,\r\n    framebuffer: fbo,\r\n  });\r\n\r\n  return (fbo, texAtlasSize, texAtlasIndex, time, animationMix, useColors, options) => {\r\n    const {\r\n      hsvColor, a, c1, c2, minValue, phaseShift, cyclesPerSecond, wavesPerCycle,\r\n      direction, invert, curve, hueVariation, hueVariationPeriod\r\n    } = { ...defaultOptions, ...options};\r\n    \r\n    drawFn({\r\n      resolution: [fbo.width, fbo.height],\r\n      texAtlasSize,\r\n      texAtlasIndex,\r\n      time,\r\n      animationMix,\r\n      useColors,\r\n      hsvColor,\r\n      a,\r\n      c1,\r\n      c2,\r\n      minValue,\r\n      phaseShift,\r\n      cyclesPerSecond,\r\n      wavesPerCycle,\r\n      direction,\r\n      invert,\r\n      curve,\r\n      hueVariation,\r\n      hueVariationPeriod,\r\n    });\r\n  };\r\n}\r\n","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nfloat when_gt_529295689(float x, float y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec2 when_gt_529295689(vec2 x, vec2 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec3 when_gt_529295689(vec3 x, vec3 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nvec4 when_gt_529295689(vec4 x, vec4 y) {\\n  return max(sign(x - y), 0.0);\\n}\\n\\nfloat when_le_1062606552(float x, float y) {\\n  return 1.0 - when_gt_529295689(x, y);\\n}\\n\\nvec2 when_le_1062606552(vec2 x, vec2 y) {\\n  return 1.0 - when_gt_529295689(x, y);\\n}\\n\\nvec3 when_le_1062606552(vec3 x, vec3 y) {\\n  return 1.0 - when_gt_529295689(x, y);\\n}\\n\\nvec4 when_le_1062606552(vec4 x, vec4 y) {\\n  return 1.0 - when_gt_529295689(x, y);\\n}\\n\\nfloat when_eq_2281831123(float x, float y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec2 when_eq_2281831123(vec2 x, vec2 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec3 when_eq_2281831123(vec3 x, vec3 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\nvec4 when_eq_2281831123(vec4 x, vec4 y) {\\n  return 1.0 - abs(sign(x - y));\\n}\\n\\n//  Function from Iigo Quiles\\n//  https://www.shadertoy.com/view/MsS3Wc\\nvec3 hsv2rgb_smooth_1540259130( in vec3 c ) {\\n  vec3 rgb = clamp( abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\\n  rgb = rgb*rgb*(3.0-2.0*rgb); // cubic smoothing \\n  return c.z * mix( vec3(1.0), rgb, c.y);\\n}\\n\\nvec2 normalizeFragCoords(in vec2 resolution, in vec2 posMin, in vec2 posMax) {\\n  return (gl_FragCoord.xy / (resolution) - posMin) / (posMax - posMin); \\n}\\n\\nfloat hueWave(in float hue, in float time, in float period, in float variation) {\\n  // https://stackoverflow.com/a/22400799\\n  float amplitude = 1.0;\\n  float halfPeriod = period / 2.0;\\n  float triangleWave = (amplitude / halfPeriod) * (halfPeriod - abs(mod(time, period) - halfPeriod));\\n\\n  return mod(hue + (triangleWave * 2.0 - 1.0) * variation, 1.0);\\n}\\n\\nuniform vec3 hsvColor;\\nuniform float hueVariation;\\nuniform float hueVariationPeriod;\\nuniform vec2 resolution;\\nuniform float time;\\nuniform bool useColors;\\n\\nuniform float gamma1;\\nuniform float gamma2;\\nuniform float maxValue;\\nuniform float minValue;\\nuniform float phaseShift;\\nuniform float cyclesPerSecond;\\nuniform float nSpokes;\\nuniform float direction;\\nuniform float invert;\\nuniform float curve;\\n\\nuniform vec3 animationMix;\\n\\nvarying vec2 posMin;\\nvarying vec2 posMax;\\n\\nconst float PI = 3.1415926535897932384626433832795;\\nconst float TAU = 6.2831853071795864769252867665590;\\n\\nfloat angleDifference(in float a, in float b, out float gamma) {\\n  float diff1 = mod((a - b), TAU / nSpokes);\\n  float diff2 = mod((b - a), TAU / nSpokes);\\n\\n  float d1_less_equal_d2 = when_le_1062606552(diff1, diff2);\\n  float d1_greater_than_d2 = when_gt_529295689(diff1, diff2);\\n\\n  gamma = d1_less_equal_d2 * gamma2 + d1_greater_than_d2 * gamma1;\\n  return d1_less_equal_d2 * diff1 + d1_greater_than_d2 * diff2;\\n}\\n\\nvoid main() {\\n  vec2 normalizedFragCoord = normalizeFragCoords(resolution, posMin, posMax);\\n\\n  float centerDist = distance(normalizedFragCoord, vec2(0.5, 0.5)) * 2.0;\\n  //float scaledTime = direction * ((1.0 + centerDist * 1.0) * cyclesPerSecond * time + phaseShift);\\n  float scaledTime = direction * (cyclesPerSecond * time + phaseShift);\\n\\n  float timeAngle = scaledTime * TAU;\\n\\n  vec2 centerDiff = normalizedFragCoord - vec2(0.5, 0.5);\\n  float fragAngle = atan(centerDiff.x, centerDiff.y) + PI; // from [-pi, pi] to [0, 2pi]\\n\\n  fragAngle = mod(fragAngle + centerDist * PI * curve, TAU);\\n\\n  float gamma;\\n  float angleDist = angleDifference(fragAngle, timeAngle, gamma) * nSpokes / PI;\\n\\n  float value = pow(1.0 - angleDist, gamma); // gamma\\n\\n  value = when_eq_2281831123(invert, 1.0) * (value * -1.0 + 1.0) + when_eq_2281831123(invert, 0.0) * value; \\n  value = value * (maxValue - minValue) + minValue;\\n\\n  float hue = hueWave(hsvColor.x, time, hueVariationPeriod, hueVariation);\\n  float animateSaturation = mix(1.0, value, animationMix[0]) * float(useColors);\\n  float animateValue = mix(1.0, value, animationMix[1]);\\n  float animateAlpha = mix(1.0, value, animationMix[2]);\\n\\n  gl_FragColor = vec4(hsv2rgb_smooth_1540259130(vec3(hue, animateSaturation * hsvColor.y, animateValue * hsvColor.z)), animateAlpha);\\n}\\n\";","import vert from '../pattern.vert';\r\nimport frag from './radar.frag';\r\n\r\nexport const defaultOptions = {\r\n  gamma1: 2.0,\r\n  gamma2: 2.0,\r\n  maxValue: 1,\r\n  minValue: 0.5,\r\n  phaseShift: 0,\r\n  cyclesPerSecond: 1,\r\n  nSpokes: 2,\r\n  direction: 1,\r\n  invert: 0,\r\n  curve: 0,\r\n  hueVariation: 0.05,\r\n  hueVariationPeriod: 2,\r\n}\r\n\r\nexport default function createRadarDraw(regl, fbo) { \r\n  const drawFn = regl({\r\n    frag: frag,\r\n    vert: vert,\r\n    attributes: {\r\n      position: regl.buffer([\r\n        [-1, -1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, 1],\r\n      ]),\r\n    },\r\n    uniforms: {\r\n      resolution: regl.prop('resolution'),\r\n      texAtlasIndex: regl.prop('texAtlasIndex'),\r\n      texAtlasSize: regl.prop('texAtlasSize'),\r\n      time: regl.prop('time'),\r\n      animationMix: regl.prop('animationMix'),\r\n      useColors: regl.prop('useColors'),\r\n      \r\n      hsvColor: regl.prop('hsvColor'),\r\n      gamma1: regl.prop('gamma1'),\r\n      gamma2: regl.prop('gamma2'),\r\n      maxValue: regl.prop('maxValue'),\r\n      minValue: regl.prop('minValue'),\r\n      phaseShift: regl.prop('phaseShift'),\r\n      cyclesPerSecond: regl.prop('cyclesPerSecond'),\r\n      nSpokes: regl.prop('nSpokes'),\r\n      direction: regl.prop('direction'),\r\n      invert: regl.prop('invert'),\r\n      curve: regl.prop('curve'),\r\n      hueVariation: regl.prop('hueVariation'),\r\n      hueVariationPeriod: regl.prop('hueVariationPeriod'),\r\n    },\r\n    count: 6,\r\n    framebuffer: fbo,\r\n  });\r\n\r\n  return (fbo, texAtlasSize, texAtlasIndex, time, animationMix, useColors, options) => {\r\n    const { \r\n      hsvColor, gamma1, gamma2, maxValue, minValue, phaseShift, cyclesPerSecond,\r\n      nSpokes, direction, invert, curve, hueVariation, hueVariationPeriod,\r\n    } = { ...defaultOptions, ...options };\r\n\r\n    drawFn({\r\n      resolution: [fbo.width, fbo.height],\r\n      texAtlasSize,\r\n      texAtlasIndex,\r\n      time,\r\n      animationMix,\r\n      useColors,\r\n      hsvColor,\r\n      gamma1,\r\n      gamma2,\r\n      maxValue,\r\n      minValue,\r\n      phaseShift,\r\n      cyclesPerSecond,\r\n      nSpokes,\r\n      direction,\r\n      invert,\r\n      curve,\r\n      hueVariation,\r\n      hueVariationPeriod,\r\n    });\r\n  };\r\n}\r\n","import _has from 'lodash-es/has';\r\nimport createPlainDraw from './plain';\r\nimport createPulseDraw from './pulse';\r\nimport createRadarDraw from './radar';\r\nimport { defaultOptions as defaultPulseOptions } from './pulse';\r\nimport { defaultOptions as defaultRadarOptions } from './radar';\r\n\r\nexport const PATTERN_TYPES = {\r\n  PLAIN: 0,\r\n  PULSE: 1,\r\n  RADAR: 2,\r\n};\r\n\r\nexport const defaultOptions = {\r\n  [PATTERN_TYPES.PULSE]: defaultPulseOptions,\r\n  [PATTERN_TYPES.RADAR]: defaultRadarOptions,\r\n};\r\n\r\nexport const PATTERN_RESOLUTION = [100, 100];\r\n\r\nexport default class PatternManager {\r\n  #patternDraws;\r\n  #patterns;\r\n  #fbo;\r\n  #regl;\r\n  #maxCategories;\r\n  #atlasSize;\r\n\r\n  constructor(regl) {\r\n    if (!regl) throw new Error('PatternManager must have reference to regl object.');\r\n\r\n    this.fbo = regl.framebuffer({\r\n      width: PATTERN_RESOLUTION[0], height: PATTERN_RESOLUTION[1],\r\n    });\r\n    this.patternDraws = {\r\n      [PATTERN_TYPES.PLAIN]: createPlainDraw(regl, this.fbo),\r\n      [PATTERN_TYPES.PULSE]: createPulseDraw(regl, this.fbo),\r\n      [PATTERN_TYPES.RADAR]: createRadarDraw(regl, this.fbo),\r\n    };\r\n    this.patterns = {};\r\n    this.regl = regl;\r\n    this.maxCategories = 0;\r\n    this.atlasSize = [0, 0];\r\n  }\r\n\r\n  updateSize() {\r\n    this.maxCategories = Math.max(...Object.keys(this.patterns)) + 1;\r\n    this.atlasSize = [this.maxCategories, 1];\r\n    this.fbo.resize(this.maxCategories * PATTERN_RESOLUTION[0], PATTERN_RESOLUTION[1]);\r\n  }\r\n\r\n  // Input: array of pattern options with the category as a property\r\n  setAll(patterns) {\r\n    const categoriesToRemove = new Set(Object.keys(this.patterns));\r\n\r\n    patterns.forEach((pattern) => {\r\n      categoriesToRemove.delete(pattern.category.toString());\r\n      this.set(pattern.category, pattern);\r\n    });\r\n\r\n    categoriesToRemove.forEach((category) => {\r\n      this.destroy(category);\r\n    });\r\n\r\n  }\r\n\r\n  set(category, options) {\r\n    if (_has(this.patterns, category))\r\n      this.patterns[category] = { ...this.patterns[category], ...options };\r\n    else\r\n      this.patterns[category] = options;\r\n\r\n    this.updateSize();\r\n  }\r\n\r\n  destroy(category) {\r\n    delete this.patterns[category];\r\n    this.updateSize();\r\n  }\r\n\r\n  draw(time, animationMix, useColors, showPatterns) {\r\n    for (let i = 0; i < this.maxCategories; i += 1) {\r\n      if (!_has(this.patterns, i)) continue;\r\n\r\n      if (showPatterns)\r\n        this.patternDraws[this.patterns[i].type](this.fbo, this.atlasSize, i, time, animationMix, useColors, this.patterns[i]);\r\n      else\r\n        this.patternDraws[PATTERN_TYPES.PLAIN](this.fbo, this.atlasSize, i, time, useColors, this.patterns[i])\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.regl.clear({\r\n      color: [0, 0, 0, 0],\r\n      depth: 1,\r\n      framebuffer: this.fbo,\r\n    });\r\n  }\r\n\r\n  getTexture() {\r\n    return this.fbo.color[0];\r\n  }\r\n\r\n  getAtlasSize() {\r\n    return [...this.atlasSize];\r\n  }\r\n}\r\n","import vert from '../pattern.vert';\r\nimport frag from './plain.frag';\r\n\r\nexport default function createPlainDraw(regl, fbo) { \r\n  const drawFn = regl({\r\n    frag: frag,\r\n    vert: vert,\r\n    attributes: {\r\n      position: regl.buffer([\r\n        [-1, -1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, -1],\r\n        [-1, 1],\r\n        [1, 1],\r\n      ]),\r\n    },\r\n    uniforms: {\r\n      resolution: regl.prop('resolution'),\r\n      texAtlasIndex: regl.prop('texAtlasIndex'),\r\n      texAtlasSize: regl.prop('texAtlasSize'),\r\n      time: regl.prop('time'),\r\n      hsvColor: regl.prop('hsvColor'),\r\n      useColors: regl.prop('useColors'),\r\n    },\r\n    count: 6,\r\n    framebuffer: fbo,\r\n  });\r\n\r\n  return (fbo, atlasSize, atlasIndex, time, useColors, { hsvColor }) => {\r\n    drawFn({\r\n      resolution: [fbo.width, fbo.height],\r\n      texAtlasSize: atlasSize,\r\n      texAtlasIndex: atlasIndex,\r\n      time: (time * 0.5) % 1,\r\n      useColors,\r\n      hsvColor: hsvColor,\r\n    });\r\n  };\r\n}\r\n","export default \"precision mediump float;\\n#define GLSLIFY 1\\n\\nvec2 normalizeFragCoords(in vec2 resolution, in vec2 posMin, in vec2 posMax) {\\n  return (gl_FragCoord.xy / (resolution) - posMin) / (posMax - posMin); \\n}\\n\\n//  Function from Iigo Quiles\\n//  https://www.shadertoy.com/view/MsS3Wc\\nvec3 hsv2rgb_smooth_1540259130( in vec3 c ) {\\n  vec3 rgb = clamp( abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\\n  rgb = rgb*rgb*(3.0-2.0*rgb); // cubic smoothing \\n  return c.z * mix( vec3(1.0), rgb, c.y);\\n}\\n\\nuniform vec2 resolution;\\nuniform vec3 hsvColor;\\nuniform bool useColors;\\n\\nvarying vec2 posMin;\\nvarying vec2 posMax;\\n\\nvoid main () {\\n  vec2 normalizedFragCoord = normalizeFragCoords(resolution, posMin, posMax);\\n\\n  gl_FragColor = vec4(hsv2rgb_smooth_1540259130(vec3(hsvColor.x, hsvColor.y * float(useColors), hsvColor.z)), 1);\\n}\\n\";","export const COLOR_ACTIVE_IDX = 1;\nexport const COLOR_BG_IDX = 3;\nexport const COLOR_HOVER_IDX = 2;\nexport const COLOR_NORMAL_IDX = 0;\nexport const COLOR_NUM_STATES = 4;\nexport const FLOAT_BYTES = Float32Array.BYTES_PER_ELEMENT;\nexport const GL_EXTENSIONS = ['OES_standard_derivatives', 'OES_texture_float'];\nexport const LASSO_MIN_DELAY = 10;\nexport const LASSO_MIN_DIST = 3;\n\n// Default attribute\nexport const DEFAULT_DATA_ASPECT_RATIO = 1;\nexport const DEFAULT_WIDTH = 100;\nexport const DEFAULT_HEIGHT = 100;\n\n// Default styles\nexport const DEFAULT_POINT_SIZE = 6;\nexport const DEFAULT_POINT_SIZE_SELECTED = 2;\nexport const DEFAULT_POINT_OUTLINE_WIDTH = 2;\n\n// Default colors\nexport const DEFAULT_COLORMAP = [];\nexport const DEFAULT_COLOR_BY = null;\nexport const DEFAULT_COLOR_NORMAL = [0.66, 0.66, 0.66, 1];\nexport const DEFAULT_COLOR_ACTIVE = [0, 0.55, 1, 1];\nexport const DEFAULT_COLOR_HOVER = [1, 1, 1, 1];\nexport const DEFAULT_COLOR_BG = [0, 0, 0, 1];\nexport const DEFAULT_COLORS = [\n  DEFAULT_COLOR_NORMAL,\n  DEFAULT_COLOR_ACTIVE,\n  DEFAULT_COLOR_HOVER,\n  DEFAULT_COLOR_BG\n];\n\n// Default view\nexport const DEFAULT_TARGET = [0, 0];\nexport const DEFAULT_DISTANCE = 1;\nexport const DEFAULT_ROTATION = 0;\n// prettier-ignore\nexport const DEFAULT_VIEW = new Float32Array([\n  1, 0, 0, 0,\n  0, 1, 0, 0,\n  0, 0, 1, 0,\n  0, 0, 0, 1\n]);\n\n// Default misc\nexport const DEFAULT_BACKGROUND_IMAGE = null;\nexport const DEFAULT_LASSO_COLOR = [0, 0.666666667, 1, 1];\nexport const DEFAULT_SHOW_RECTICLE = false;\nexport const DEFAULT_RECTICLE_COLOR = [1, 1, 1, 0.5];\n","import createOriginalRegl from 'regl';\n\nimport { GL_EXTENSIONS } from './constants';\n\n/**\n * Get the max value of an array. helper method to be used with `Array.reduce()`.\n * @param   {number}  max  Accumulator holding the max value.\n * @param   {number}  x  Current value.\n * @return  {number}  Max value.\n */\nexport const arrayMax = (max, x) => (max > x ? max : x);\n\n/**\n * Check if all GL extensions are enabled and warn otherwise\n * @param   {function}  regl  Regl instance to be tested\n * @return  {function}  Returns the Regl instance itself\n */\nexport const checkReglExtensions = regl => {\n  if (!regl) return false;\n  return GL_EXTENSIONS.reduce((every, EXTENSION) => {\n    if (!regl.hasExtension(EXTENSION)) {\n      console.warn(\n        `WebGL: ${EXTENSION} extension not supported. Scatterplot might not render properly`\n      );\n      return false;\n    }\n    return every;\n  }, true);\n};\n\n/**\n * Create a new Regl instance with `GL_EXTENSIONS` enables\n * @param   {object}  canvas  Canvas element to be rendered on\n * @return  {function}  New Regl instance\n */\nexport const createRegl = canvas => {\n  const gl = canvas.getContext('webgl');\n  const extensions = [];\n\n  // Needed to run the tests properly as the headless-gl doesn't support all\n  // extensions, which is fine for the functional tests.\n  GL_EXTENSIONS.forEach(EXTENSION => {\n    if (gl.getExtension(EXTENSION)) {\n      extensions.push(EXTENSION);\n    } else {\n      console.warn(\n        `WebGL: ${EXTENSION} extension not supported. Scatterplot might not render properly`\n      );\n    }\n  });\n\n  return createOriginalRegl({ gl, extensions });\n};\n\n/**\n * L2 distance between a pair of 2D points\n * @param   {number}  x1  X coordinate of the first point\n * @param   {number}  y1  Y coordinate of the first point\n * @param   {number}  x2  X coordinate of the second point\n * @param   {number}  y2  Y coordinate of the first point\n * @return  {number}  L2 distance\n */\nexport const dist = (x1, y1, x2, y2) =>\n  Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);\n\n/**\n * Get the bounding box of a set of 2D positions\n * @param   {array}  positions2d  2D positions to be checked\n * @return  {array}  Quadruple of form `[xMin, yMin, xMax, yMax]` defining the\n *  bounding box\n */\nexport const getBBox = positions2d => {\n  let xMin = Infinity;\n  let xMax = -Infinity;\n  let yMin = Infinity;\n  let yMax = -Infinity;\n\n  for (let i = 0; i < positions2d.length; i += 2) {\n    xMin = positions2d[i] < xMin ? positions2d[i] : xMin;\n    xMax = positions2d[i] > xMax ? positions2d[i] : xMax;\n    yMin = positions2d[i + 1] < yMin ? positions2d[i + 1] : yMin;\n    yMax = positions2d[i + 1] > yMax ? positions2d[i + 1] : yMax;\n  }\n\n  return [xMin, yMin, xMax, yMax];\n};\n\n/**\n * Convert a HEX-encoded color to an RGB-encoded color\n * @param   {string}  hex  HEX-encoded color string.\n * @param   {boolean}  isNormalize  If `true` the returned RGB values will be\n *   normalized to `[0,1]`.\n * @return  {array}  Triple holding the RGB values.\n */\nexport const hexToRgb = (hex, isNormalize = false) =>\n  hex\n    .replace(\n      /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n      (m, r, g, b) => `#${r}${r}${g}${g}${b}${b}`\n    )\n    .substring(1)\n    .match(/.{2}/g)\n    .map(x => parseInt(x, 16) / 255 ** isNormalize);\n\n/**\n * Promised-based image loading\n * @param   {string}  src  Remote image source, i.e., a URL\n * @return  {object}  Promise resolving to the image once its loaded\n */\nexport const loadImage = (src, isCrossOrigin = false) =>\n  new Promise((accept, reject) => {\n    const image = new Image();\n    if (isCrossOrigin) image.crossOrigin = 'anonymous';\n    image.src = src;\n    image.onload = () => {\n      accept(image);\n    };\n    image.onerror = error => {\n      reject(error);\n    };\n  });\n\n/**\n * Create a Regl texture from an URL.\n * @param   {function}  regl  Regl instance used for creating the texture.\n * @param   {string}  url  Source URL of the image.\n * @param   {boolean}  isCrossOrigin  If `true` allow loading image from a\n *   source of another origin.\n * @return  {object}  Promise resolving to the texture object.\n */\nexport const createTextureFromUrl = (regl, url, isCrossOrigin = false) =>\n  new Promise((resolve, reject) => {\n    loadImage(url, isCrossOrigin)\n      .then(image => {\n        resolve(regl.texture(image));\n      })\n      .catch(error => {\n        reject(error);\n      });\n  });\n\n/**\n * Convert a HEX-encoded color to an RGBA-encoded color\n * @param   {string}  hex  HEX-encoded color string.\n * @param   {boolean}  isNormalize  If `true` the returned RGBA values will be\n *   normalized to `[0,1]`.\n * @return  {array}  Triple holding the RGBA values.\n */\nexport const hexToRgba = (hex, isNormalize = false) => [\n  ...hexToRgb(hex, isNormalize),\n  255 ** !isNormalize\n];\n\n/**\n * Tests if a string is a valid HEX color encoding\n * @param   {string}  hex  HEX-encoded color string.\n * @return  {boolean}  If `true` the string is a valid HEX color encoding.\n */\nexport const isHex = hex => /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex);\n\n/**\n * Tests if a number is in `[0,1]`.\n * @param   {number}  x  Number to be tested.\n * @return  {boolean}  If `true` the number is in `[0,1]`.\n */\nexport const isNormFloat = x => x >= 0 && x <= 1;\n\n/**\n * Tests if an array consist of normalized numbers that are in `[0,1]` only.\n * @param   {array}  a  Array to be tested\n * @return  {boolean}  If `true` the array contains only numbers in `[0,1]`.\n */\nexport const isNormFloatArray = a => Array.isArray(a) && a.every(isNormFloat);\n\n/**\n * From: https://wrf.ecse.rpi.edu//Research/Short_Notes/pnpoly.html\n * @param   {Array}  point  Tuple of the form `[x,y]` to be tested.\n * @param   {Array}  polygon  1D list of vertices defining the polygon.\n * @return  {boolean}  If `true` point lies within the polygon.\n */\nexport const isPointInPolygon = ([px, py] = [], polygon) => {\n  let x1;\n  let y1;\n  let x2;\n  let y2;\n  let isWithin = false;\n  for (let i = 0, j = polygon.length - 2; i < polygon.length; i += 2) {\n    x1 = polygon[i];\n    y1 = polygon[i + 1];\n    x2 = polygon[j];\n    y2 = polygon[j + 1];\n    if ((y1 > py) !== (y2 > py) && px < ((x2 - x1) * (py - y1)) / (y2 - y1) + x1)\n      isWithin = !isWithin;\n    j = i;\n  }\n  return isWithin;\n};\n\n/**\n * Tests if a variable is a string\n * @param   {*}  s  Variable to be tested\n * @return  {boolean}  If `true` variable is a string\n */\nexport const isString = s => typeof s === 'string' || s instanceof String;\n\n/**\n * Tests if a number is an interger and in `[0,255]`.\n * @param   {number}  x  Number to be tested.\n * @return  {boolean}  If `true` the number is an interger and in `[0,255]`.\n */\nexport const isUint8 = x => Number.isInteger(x) && x >= 0 && x <= 255;\n\n/**\n * Tests if an array consist of Uint8 numbers only.\n * @param   {array}  a  Array to be tested.\n * @return  {boolean}  If `true` the array contains only Uint8 numbers.\n */\nexport const isUint8Array = a => Array.isArray(a) && a.every(isUint8);\n\n/**\n * Tests if an array is encoding an RGB color.\n * @param   {array}  rgb  Array to be tested\n * @return  {boolean}  If `true` the array hold a triple of Uint8 numbers or\n *   a triple of normalized floats.\n */\nexport const isRgb = rgb =>\n  rgb.length === 3 && (isNormFloatArray(rgb) || isUint8Array(rgb));\n\n/**\n * Tests if an array is encoding an RGBA color.\n * @param   {array}  rgb  Array to be tested\n * @return  {boolean}  If `true` the array hold a quadruple of Uint8 numbers or\n *   a quadruple of normalized floats.\n */\nexport const isRgba = rgba =>\n  rgba.length === 4 && (isNormFloatArray(rgba) || isUint8Array(rgba));\n\n/**\n * Fast version of `Math.max`. Based on\n *   https://jsperf.com/math-min-max-vs-ternary-vs-if/24 `Math.max` is not\n *   very fast\n * @param   {number}  a  Value A\n * @param   {number}  b  Value B\n * @return  {boolean}  If `true` A is greater than B.\n */\nexport const max = (a, b) => (a > b ? a : b);\n\n/**\n * Fast version of `Math.min`. Based on\n *   https://jsperf.com/math-min-max-vs-ternary-vs-if/24 `Math.max` is not\n *   very fast\n * @param   {number}  a  Value A\n * @param   {number}  b  Value B\n * @return  {boolean}  If `true` A is smaller than B.\n */\nexport const min = (a, b) => (a < b ? a : b);\n\n/**\n * Normalize an array\n * @param   {array}  a  Array to be normalized.\n * @return  {array}  Normalized array.\n */\nexport const normNumArray = a => a.map(x => x / a.reduce(arrayMax, -Infinity));\n\n/**\n * Convert a color to an RGBA color\n * @param   {*}  color  Color to be converted. Currently supports:\n *   HEX, RGB, or RGBA.\n * @param   {boolean}  isNormalize  If `true` the returned RGBA values will be\n *   normalized to `[0,1]`.\n * @return  {array}  Quadruple defining an RGBA color.\n */\nexport const toRgba = (color, isNormalize) => {\n  if (isRgba(color))\n    return isNormalize && !isNormFloatArray(color)\n      ? normNumArray(color)\n      : color;\n  if (isRgb(color))\n    return [\n      ...(isNormalize ? normNumArray(color) : color),\n      255 ** !isNormalize\n    ];\n  if (isHex(color)) return hexToRgba(color, isNormalize);\n  console.warn(\n    'Only HEX, RGB, and RGBA are handled by this function. Returning white instead.'\n  );\n  return isNormalize ? [1, 1, 1, 1] : [255, 255, 255, 255];\n};\n","import createDom2dCamera from './camera';\r\nimport KDBush from 'kdbush';\r\nimport createPubSub from 'pub-sub-es';\r\nimport withThrottle from 'lodash-es/throttle';\r\nimport withRaf from 'with-raf';\r\nimport { mat4, vec4 } from 'gl-matrix';\r\nimport createLine from 'regl-line';\r\nimport GLBench from 'gl-bench/dist/gl-bench';\r\nimport _groupBy from 'lodash-es/groupBy';\r\nimport _has from 'lodash-es/has';\r\nimport _mapValues from 'lodash-es/mapValues';\r\n\r\nimport BG_FS from './bg.frag';\r\nimport BG_VS from './bg.vert';\r\nimport POINT_FS from './point.frag';\r\nimport POINT_VS from './point.vert';\r\n\r\nimport PatternManager, { PATTERN_TYPES } from './patterns/PatternManager';\r\n\r\nimport {\r\n  COLOR_ACTIVE_IDX,\r\n  COLOR_BG_IDX,\r\n  COLOR_HOVER_IDX,\r\n  COLOR_NORMAL_IDX,\r\n  COLOR_NUM_STATES,\r\n  DEFAULT_BACKGROUND_IMAGE,\r\n  DEFAULT_COLOR_BG,\r\n  DEFAULT_COLOR_BY,\r\n  DEFAULT_COLORS,\r\n  DEFAULT_DATA_ASPECT_RATIO,\r\n  DEFAULT_DISTANCE,\r\n  DEFAULT_HEIGHT,\r\n  DEFAULT_LASSO_COLOR,\r\n  DEFAULT_SHOW_RECTICLE,\r\n  DEFAULT_RECTICLE_COLOR,\r\n  DEFAULT_POINT_OUTLINE_WIDTH,\r\n  DEFAULT_POINT_SIZE,\r\n  DEFAULT_POINT_SIZE_SELECTED,\r\n  DEFAULT_ROTATION,\r\n  DEFAULT_TARGET,\r\n  DEFAULT_VIEW,\r\n  DEFAULT_WIDTH,\r\n  FLOAT_BYTES,\r\n  LASSO_MIN_DELAY,\r\n  LASSO_MIN_DIST\r\n} from './constants';\r\n\r\nimport {\r\n  checkReglExtensions,\r\n  createRegl,\r\n  createTextureFromUrl,\r\n  dist,\r\n  getBBox,\r\n  isRgb,\r\n  isPointInPolygon,\r\n  isRgba,\r\n  toRgba,\r\n  max,\r\n  min\r\n} from './utils';\r\n\r\n//import { version } from '../package.json';\r\nconst version = '0.7.5';\r\n\r\nconst createScatterplot = ({\r\n  regl: initialRegl,\r\n  background: initialBackground = DEFAULT_COLOR_BG,\r\n  backgroundImage: initialBackgroundImage = DEFAULT_BACKGROUND_IMAGE,\r\n  canvas: initialCanvas = document.createElement('canvas'),\r\n  colorBy: initialColorBy = DEFAULT_COLOR_BY,\r\n  colors: initialColors = DEFAULT_COLORS,\r\n  lassoColor: initialLassoColor = DEFAULT_LASSO_COLOR,\r\n  lassoMinDelay: initialLassoMinDelay = LASSO_MIN_DELAY,\r\n  lassoMinDist: initialLassoMinDist = LASSO_MIN_DIST,\r\n  showRecticle: initialShowRecticle = DEFAULT_SHOW_RECTICLE,\r\n  recticleColor: initialRecticleColor = DEFAULT_RECTICLE_COLOR,\r\n  pointSize: initialPointSize = DEFAULT_POINT_SIZE,\r\n  pointSizeSelected: initialPointSizeSelected = DEFAULT_POINT_SIZE_SELECTED,\r\n  pointOutlineWidth: initialPointOutlineWidth = DEFAULT_POINT_OUTLINE_WIDTH,\r\n  width: initialWidth = DEFAULT_WIDTH,\r\n  height: initialHeight = DEFAULT_HEIGHT,\r\n  target: initialTarget = DEFAULT_TARGET,\r\n  distance: initialDistance = DEFAULT_DISTANCE,\r\n  rotation: initialRotation = DEFAULT_ROTATION,\r\n  view: initialView = DEFAULT_VIEW\r\n} = {}) => {\r\n  const pubSub = createPubSub();\r\n  const scratch = new Float32Array(16);\r\n  const mousePosition = [0, 0];\r\n\r\n  checkReglExtensions(initialRegl);\r\n\r\n  let background = toRgba(initialBackground, true);\r\n  let backgroundImage = initialBackgroundImage;\r\n  let canvas = initialCanvas;\r\n  let colors = initialColors;\r\n  let width = initialWidth;\r\n  let height = initialHeight;\r\n  let pointSize = initialPointSize;\r\n  let pointSizeSelected = initialPointSizeSelected;\r\n  let pointOutlineWidth = initialPointOutlineWidth;\r\n  let regl = initialRegl || createRegl(initialCanvas);\r\n  let camera;\r\n  let lasso;\r\n  let mouseDown = false;\r\n  let mouseDownShift = false;\r\n  let mouseDownPosition = [0, 0];\r\n  let numPoints = 0;\r\n  let selection = [];\r\n  let lassoColor = toRgba(initialLassoColor, true);\r\n  let lassoMinDelay = +initialLassoMinDelay;\r\n  let lassoMinDist = +initialLassoMinDist;\r\n  let lassoPos = [];\r\n  let lassoScatterPos = [];\r\n  let lassoPrevMousePos;\r\n  let searchIndex;\r\n  let viewAspectRatio;\r\n  let dataAspectRatio = DEFAULT_DATA_ASPECT_RATIO;\r\n  let projection;\r\n  let model;\r\n  let showRecticle = initialShowRecticle;\r\n  let recticleHLine;\r\n  let recticleVLine;\r\n  let recticleColor = toRgba(initialRecticleColor, true);\r\n\r\n  let stateTex; // Stores the point texture holding x, y, category, and value\r\n  let stateTexRes = 0; // Width and height of the texture\r\n  let normalPointsIndexBuffer; // Buffer holding the indices pointing to the correct texel\r\n  let selectedPointsIndexBuffer; // Used for pointing to the selected texels\r\n  let hoveredPointIndexBuffer; // Used for pointing to the hovered texels\r\n\r\n  let colorTex; // Stores the color texture\r\n  let colorTexRes = 0; // Width and height of the texture\r\n\r\n  let colorBy = initialColorBy;\r\n  let isViewChanged = false;\r\n  let isInit = false;\r\n\r\n  let opacity = 1;\r\n\r\n  let hoveredPoint;\r\n  let isMouseInCanvas = false;\r\n\r\n  let bboxTex;\r\n  let bboxTexRes = 0;\r\n  let glBench;\r\n  let animationMix = [0, 1, 0]; // s = saturation, v = value, a = alpha\r\n  let animateDepth = false;\r\n  let showPatterns = true;\r\n  let useColors = true;\r\n\r\n  let patternManager = new PatternManager(regl);\r\n  patternManager.set(0, {\r\n    type: PATTERN_TYPES.PLAIN,\r\n    color: [0.2, 1, 0.5, 1],\r\n  });\r\n\r\n  // Get a copy of the current mouse position\r\n  const getMousePos = () => mousePosition.slice();\r\n\r\n  const getNdcX = x => -1 + (x / width) * 2;\r\n\r\n  const getNdcY = y => 1 + (y / height) * -2;\r\n\r\n  // Get relative WebGL position\r\n  const getMouseGlPos = () => [\r\n    getNdcX(mousePosition[0]),\r\n    getNdcY(mousePosition[1])\r\n  ];\r\n\r\n  const getScatterGlPos = () => {\r\n    const [xGl, yGl] = getMouseGlPos();\r\n\r\n    // Homogeneous vector\r\n    const v = [xGl, yGl, 1, 1];\r\n\r\n    // projection^-1 * view^-1 * model^-1 is the same as\r\n    // model * view^-1 * projection\r\n    const mvp = mat4.invert(\r\n      scratch,\r\n      mat4.multiply(\r\n        scratch,\r\n        projection,\r\n        mat4.multiply(scratch, camera.view, model)\r\n      )\r\n    );\r\n\r\n    // Translate vector\r\n    vec4.transformMat4(v, v, mvp);\r\n\r\n    return v.slice(0, 2);\r\n  };\r\n\r\n  const raycast = () => {\r\n    const [x, y] = getScatterGlPos();\r\n\r\n    const scaling = camera.scaling;\r\n    const scaledPointSize =\r\n      2 *\r\n      pointSize *\r\n      (min(1.0, scaling) + Math.log2(max(1.0, scaling))) *\r\n      window.devicePixelRatio;\r\n\r\n    const xNormalizedScaledPointSize = scaledPointSize / width;\r\n    const yNormalizedScaledPointSize = scaledPointSize / height;\r\n\r\n    // Get all points within a close range\r\n    const pointsInBBox = searchIndex.range(\r\n      x - xNormalizedScaledPointSize,\r\n      y - yNormalizedScaledPointSize,\r\n      x + xNormalizedScaledPointSize,\r\n      y + yNormalizedScaledPointSize\r\n    );\r\n\r\n    // Find the closest point\r\n    let minDist = scaledPointSize;\r\n    let clostestPoint;\r\n    pointsInBBox.forEach(idx => {\r\n      const [ptX, ptY] = searchIndex.points[idx];\r\n      const d = dist(ptX, ptY, x, y);\r\n      if (d < minDist) {\r\n        minDist = d;\r\n        clostestPoint = idx;\r\n      }\r\n    });\r\n\r\n    if (minDist < (pointSize / width) * 2) return clostestPoint;\r\n    return -1;\r\n  };\r\n\r\n  const lassoExtend = () => {\r\n    const currMousePos = getMousePos();\r\n\r\n    if (!lassoPrevMousePos) {\r\n      lassoPos = [...getMouseGlPos(currMousePos)];\r\n      lassoScatterPos = [...getScatterGlPos(currMousePos)];\r\n      lassoPrevMousePos = currMousePos;\r\n    } else {\r\n      const d = dist(...currMousePos, ...lassoPrevMousePos);\r\n\r\n      if (d > lassoMinDist) {\r\n        lassoPos.push(...getMouseGlPos(currMousePos));\r\n        lassoScatterPos.push(...getScatterGlPos(currMousePos));\r\n        lassoPrevMousePos = currMousePos;\r\n        if (lassoPos.length > 2) {\r\n          lasso.setPoints(lassoPos);\r\n        }\r\n      }\r\n    }\r\n  };\r\n  let lassoExtendDb = withThrottle(lassoExtend, lassoMinDelay);\r\n\r\n  const findPointsInLasso = lassoPolygon => {\r\n    // get the bounding box of the lasso selection...\r\n    const bBox = getBBox(lassoPolygon);\r\n    // ...to efficiently preselect potentially selected points\r\n    const pointsInBBox = searchIndex.range(...bBox);\r\n    // next we test each point in the bounding box if it is in the polygon too\r\n    const pointsInPolygon = [];\r\n    pointsInBBox.forEach(pointIdx => {\r\n      if (isPointInPolygon(searchIndex.points[pointIdx], lassoPolygon))\r\n        pointsInPolygon.push(pointIdx);\r\n    });\r\n\r\n    return pointsInPolygon;\r\n  };\r\n\r\n  const deselect = () => {\r\n    if (selection.length) {\r\n      pubSub.publish('deselect');\r\n      selection = [];\r\n      //drawRaf(); // eslint-disable-line no-use-before-define\r\n    }\r\n  };\r\n\r\n  const select = points => {\r\n    selection = points;\r\n\r\n    selectedPointsIndexBuffer({\r\n      usage: 'dynamic',\r\n      type: 'float',\r\n      data: new Float32Array(selection)\r\n    });\r\n\r\n    pubSub.publish('select', {\r\n      points: selection\r\n    });\r\n\r\n    //drawRaf(); // eslint-disable-line no-use-before-define\r\n  };\r\n\r\n  const getRelativeMousePosition = event => {\r\n    const rect = canvas.getBoundingClientRect();\r\n\r\n    mousePosition[0] = event.clientX - rect.left;\r\n    mousePosition[1] = event.clientY - rect.top;\r\n\r\n    return [...mousePosition];\r\n  };\r\n\r\n  const lassoEnd = () => {\r\n    // const t0 = performance.now();\r\n    const pointsInLasso = findPointsInLasso(lassoScatterPos);\r\n    // console.log(`found ${pointsInLasso.length} in ${performance.now() - t0} msec`);\r\n    select(pointsInLasso);\r\n    lassoPos = [];\r\n    lassoScatterPos = [];\r\n    lassoPrevMousePos = undefined;\r\n    lasso.clear();\r\n  };\r\n\r\n  const mouseDownHandler = event => {\r\n    if (!isInit) return;\r\n\r\n    mouseDown = true;\r\n\r\n    mouseDownPosition = getRelativeMousePosition(event);\r\n    mouseDownShift = event.shiftKey;\r\n\r\n    if (mouseDownShift) {\r\n      // Fix camera for the lasso selection\r\n      camera.config({ isFixed: true });\r\n      // Make sure we start a new lasso selection\r\n      lassoPrevMousePos = undefined;\r\n    }\r\n  };\r\n\r\n  const mouseUpHandler = () => {\r\n    if (!isInit) return;\r\n\r\n    mouseDown = false;\r\n\r\n    if (mouseDownShift) {\r\n      mouseDownShift = false;\r\n      camera.config({ isFixed: false });\r\n      lassoEnd();\r\n    }\r\n  };\r\n\r\n  const mouseClickHandler = event => {\r\n    if (!isInit) return;\r\n\r\n    const currentMousePosition = getRelativeMousePosition(event);\r\n    const clickDist = dist(...currentMousePosition, ...mouseDownPosition);\r\n\r\n    if (clickDist >= LASSO_MIN_DIST) return;\r\n\r\n    const clostestPoint = raycast();\r\n    if (clostestPoint >= 0) select([clostestPoint]);\r\n  };\r\n\r\n  const mouseDblClickHandler = () => {\r\n    deselect();\r\n  };\r\n\r\n  const mouseMoveHandler = event => {\r\n    if (!isInit) return;\r\n\r\n    getRelativeMousePosition(event);\r\n\r\n    // Only ray cast if the mouse cursor is inside\r\n    if (isMouseInCanvas && !mouseDownShift) {\r\n      const clostestPoint = raycast();\r\n      hover(clostestPoint); // eslint-disable-line no-use-before-define\r\n    }\r\n\r\n    if (mouseDownShift) lassoExtendDb();\r\n\r\n    // Always redraw when mouse as the user might have panned or lassoed\r\n    //if (mouseDown) drawRaf(); // eslint-disable-line no-use-before-define\r\n  };\r\n\r\n  const blurHandler = () => {\r\n    if (!isInit) return;\r\n\r\n    hoveredPoint = undefined;\r\n    isMouseInCanvas = false;\r\n    mouseUpHandler();\r\n    //drawRaf(); // eslint-disable-line no-use-before-define\r\n  };\r\n\r\n  const createColorTexture = (newColors = colors) => {\r\n    const numColors = newColors.length;\r\n    colorTexRes = Math.max(2, Math.ceil(Math.sqrt(numColors)));\r\n    const rgba = new Float32Array(colorTexRes ** 2 * 4);\r\n    newColors.forEach((color, i) => {\r\n      rgba[i * 4] = color[0]; // r\r\n      rgba[i * 4 + 1] = color[1]; // g\r\n      rgba[i * 4 + 2] = color[2]; // b\r\n      // For all normal state colors check if the global opacity is not 1 and\r\n      // if so use that instead.\r\n      rgba[i * 4 + 3] =\r\n        i % COLOR_NUM_STATES > 0 || opacity === 1 ? color[3] : opacity; // a\r\n    });\r\n\r\n    return regl.texture({\r\n      data: rgba,\r\n      shape: [colorTexRes, colorTexRes, 4],\r\n      type: 'float'\r\n    });\r\n  };\r\n\r\n  const updateViewAspectRatio = () => {\r\n    viewAspectRatio = width / height;\r\n    projection = mat4.fromScaling([], [1 / viewAspectRatio, 1, 1]);\r\n    model = mat4.fromScaling([], [dataAspectRatio, 1, 1,]);\r\n  };\r\n\r\n  const setDataAspectRatio = newDataAspectRatio => {\r\n    if (+newDataAspectRatio <= 0) return;\r\n    dataAspectRatio = newDataAspectRatio;\r\n  };\r\n\r\n  const setColors = newColors => {\r\n    if (!newColors || !newColors.length) return;\r\n\r\n    const tmp = [];\r\n    try {\r\n      newColors.forEach(color => {\r\n        if (Array.isArray(color) && !isRgb(color) && !isRgba(color)) {\r\n          // Assuming color is an array of HEX colors\r\n          for (let j = 0; j < 3; j++) {\r\n            tmp.push(toRgba(color[j], true));\r\n          }\r\n        } else {\r\n          const rgba = toRgba(color, true);\r\n          const rgbaOpaque = [...rgba.slice(0, 3), 1];\r\n          tmp.push(rgba, rgbaOpaque, rgbaOpaque); // normal, active, and hover\r\n        }\r\n        tmp.push(background);\r\n      });\r\n    } catch (e) {\r\n      console.error(\r\n        e,\r\n        'Invalid format. Please specify an array of colors or a nested array of accents per colors.'\r\n      );\r\n    }\r\n    colors = tmp;\r\n\r\n    try {\r\n      colorTex = createColorTexture();\r\n    } catch (e) {\r\n      colors = DEFAULT_COLORS;\r\n      colorTex = createColorTexture();\r\n      console.error('Invalid colors. Switching back to default colors.');\r\n    }\r\n  };\r\n  const setHeight = newHeight => {\r\n    if (!+newHeight || +newHeight <= 0) return;\r\n    height = +newHeight;\r\n    canvas.height = height * window.devicePixelRatio;\r\n  };\r\n\r\n  const setPointSize = newPointSize => {\r\n    if (!+newPointSize || +newPointSize <= 0) return;\r\n    pointSize = +newPointSize;\r\n  };\r\n\r\n  const setPointSizeSelected = newPointSizeSelected => {\r\n    if (!+newPointSizeSelected || +newPointSizeSelected < 0) return;\r\n    pointSizeSelected = +newPointSizeSelected;\r\n  };\r\n\r\n  const setPointOutlineWidth = newPointOutlineWidth => {\r\n    if (!+newPointOutlineWidth || +newPointOutlineWidth < 0) return;\r\n    pointOutlineWidth = +newPointOutlineWidth;\r\n  };\r\n\r\n  const setWidth = newWidth => {\r\n    if (!+newWidth || +newWidth <= 0) return;\r\n    width = +newWidth;\r\n    canvas.width = width * window.devicePixelRatio;\r\n  };\r\n\r\n  const setColorBy = type => {\r\n    switch (type) {\r\n      case 'category':\r\n        colorBy = 'category';\r\n        break;\r\n\r\n      case 'value':\r\n        colorBy = 'value';\r\n        break;\r\n\r\n      default:\r\n        colorBy = DEFAULT_COLOR_BY;\r\n    }\r\n  };\r\n\r\n  const setOpacity = newOpacity => {\r\n    if (!+newOpacity || +newOpacity <= 0) return;\r\n\r\n    opacity = +newOpacity;\r\n    colorTex = createColorTexture();\r\n  };\r\n\r\n  const getBackgroundImage = () => backgroundImage;\r\n  const getColorTex = () => colorTex;\r\n  const getColorTexRes = () => colorTexRes;\r\n  const getNormalPointsIndexBuffer = () => normalPointsIndexBuffer;\r\n  const getSelectedPointsIndexBuffer = () => selectedPointsIndexBuffer;\r\n  const getPointSize = () => pointSize * window.devicePixelRatio;\r\n  const getNormalPointSizeExtra = () => 0;\r\n  const getStateTex = () => stateTex;\r\n  const getStateTexRes = () => stateTexRes;\r\n  const getProjection = () => projection;\r\n  const getView = () => camera.view;\r\n  const getModel = () => model;\r\n  const getScaling = () => camera.scaling;\r\n  const getNormalNumPoints = () => numPoints;\r\n  const getIsColoredByCategory = () => (colorBy === 'category') * 1;\r\n  const getIsColoredByValue = () => (colorBy === 'value') * 1;\r\n  const getMaxColor = () => colors.length / COLOR_NUM_STATES - 1;\r\n  const getNumColorStates = () => COLOR_NUM_STATES;\r\n  const getTexture = () => patternManager.getTexture();\r\n  const getAtlasSize = () => patternManager.getAtlasSize();\r\n  const getBBoxTex = () => bboxTex;\r\n  const getBBoxTexRes = () => bboxTexRes;\r\n  const getAnimateDepth = () => animateDepth;\r\n\r\n  const drawPoints = (\r\n    getPointSizeExtra,\r\n    getNumPoints,\r\n    getStateIndexBuffer,\r\n    globalState = COLOR_NORMAL_IDX\r\n  ) =>\r\n    regl({\r\n      frag: POINT_FS,\r\n      vert: POINT_VS,\r\n\r\n      blend: {\r\n        enable: true,\r\n        func: {\r\n          srcRGB: 'src alpha',\r\n          srcAlpha: 'one',\r\n          dstRGB: 'one minus src alpha',\r\n          dstAlpha: 'one minus src alpha'\r\n        }\r\n      },\r\n\r\n      depth: { enable: getAnimateDepth },\r\n\r\n      attributes: {\r\n        stateIndex: {\r\n          buffer: getStateIndexBuffer,\r\n          size: 1\r\n        }\r\n      },\r\n\r\n      uniforms: {\r\n        projection: getProjection,\r\n        model: getModel,\r\n        view: getView,\r\n        scaling: getScaling,\r\n        pointSize: getPointSize,\r\n        pointSizeExtra: getPointSizeExtra,\r\n        globalState,\r\n        colorTex: getColorTex,\r\n        colorTexRes: getColorTexRes,\r\n        stateTex: getStateTex,\r\n        stateTexRes: getStateTexRes,\r\n        isColoredByCategory: getIsColoredByCategory,\r\n        isColoredByValue: getIsColoredByValue,\r\n        maxColor: getMaxColor,\r\n        numColorStates: getNumColorStates,\r\n        textureAtlas: getTexture,\r\n        atlasSize: getAtlasSize,\r\n        bboxTex: getBBoxTex,\r\n        bboxTexRes: getBBoxTexRes,\r\n        animateDepth: getAnimateDepth,\r\n      },\r\n\r\n      count: getNumPoints,\r\n\r\n      primitive: 'points'\r\n    });\r\n\r\n  const drawPointBodies = drawPoints(\r\n    getNormalPointSizeExtra,\r\n    getNormalNumPoints,\r\n    getNormalPointsIndexBuffer\r\n  );\r\n\r\n  const drawHoveredPoint = drawPoints(\r\n    getNormalPointSizeExtra,\r\n    () => 1,\r\n    () => hoveredPointIndexBuffer,\r\n    COLOR_HOVER_IDX\r\n  );\r\n\r\n  const drawSelectedPoint = () => {\r\n    const numOutlinedPoints = selection.length;\r\n\r\n    // Draw outer outline\r\n    drawPoints(\r\n      () =>\r\n        (pointSizeSelected + pointOutlineWidth * 2) * window.devicePixelRatio,\r\n      () => numOutlinedPoints,\r\n      getSelectedPointsIndexBuffer,\r\n      COLOR_ACTIVE_IDX\r\n    )();\r\n\r\n    // Draw inner outline\r\n    drawPoints(\r\n      () => (pointSizeSelected + pointOutlineWidth) * window.devicePixelRatio,\r\n      () => numOutlinedPoints,\r\n      getSelectedPointsIndexBuffer,\r\n      COLOR_BG_IDX\r\n    )();\r\n\r\n    // Draw body\r\n    drawPoints(\r\n      () => pointSizeSelected,\r\n      () => numOutlinedPoints,\r\n      getSelectedPointsIndexBuffer,\r\n      COLOR_ACTIVE_IDX\r\n    )();\r\n  };\r\n\r\n  const drawBackgroundImage = regl({\r\n    frag: BG_FS,\r\n    vert: BG_VS,\r\n\r\n    attributes: {\r\n      position: [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0]\r\n    },\r\n\r\n    uniforms: {\r\n      projection: getProjection,\r\n      model: getModel,\r\n      view: getView,\r\n      texture: getBackgroundImage\r\n    },\r\n\r\n    count: 6\r\n  });\r\n\r\n  const drawRecticle = () => {\r\n    if (!(hoveredPoint >= 0)) return;\r\n\r\n    const [x, y] = searchIndex.points[hoveredPoint].slice(0, 2);\r\n\r\n    // Homogeneous coordinates of the point\r\n    const v = [x, y, 0, 1];\r\n\r\n    // We have to calculate the model-view-projection matrix outside of the\r\n    // shader as we actually don't want the mode, view, or projection of the\r\n    // line view space to change such that the recticle is visualized across the\r\n    // entire view container and not within the view of the scatterplot\r\n    mat4.multiply(\r\n      scratch,\r\n      projection,\r\n      mat4.multiply(scratch, camera.view, model)\r\n    );\r\n\r\n    vec4.transformMat4(v, v, scratch);\r\n\r\n    recticleHLine.setPoints([-1, v[1], 1, v[1]]);\r\n    recticleVLine.setPoints([v[0], 1, v[0], -1]);\r\n\r\n    recticleHLine.draw();\r\n    recticleVLine.draw();\r\n\r\n    // Draw outer outline\r\n    drawPoints(\r\n      () =>\r\n        (pointSizeSelected + pointOutlineWidth * 2) * window.devicePixelRatio,\r\n      () => 1,\r\n      hoveredPointIndexBuffer,\r\n      COLOR_ACTIVE_IDX\r\n    )();\r\n\r\n    // Draw inner outline\r\n    drawPoints(\r\n      () => (pointSizeSelected + pointOutlineWidth) * window.devicePixelRatio,\r\n      () => 1,\r\n      hoveredPointIndexBuffer,\r\n      COLOR_BG_IDX\r\n    )();\r\n  };\r\n\r\n  const createPointIndex = numNewPoints => {\r\n    const index = new Float32Array(numNewPoints);\r\n\r\n    for (let i = 0; i < numNewPoints; ++i) {\r\n      index[i] = i;\r\n    }\r\n\r\n    return index;\r\n  };\r\n\r\n  const createStateTexture = newPoints => {\r\n    const numNewPoints = newPoints.length;\r\n    stateTexRes = Math.max(2, Math.ceil(Math.sqrt(numNewPoints)));\r\n    const data = new Float32Array(stateTexRes ** 2 * 4);\r\n\r\n    for (let i = 0; i < numNewPoints; ++i) {\r\n      data[i * 4] = newPoints[i][0]; // x\r\n      data[i * 4 + 1] = newPoints[i][1]; // y\r\n      data[i * 4 + 2] = newPoints[i][2] || 0; // category\r\n      data[i * 4 + 3] = newPoints[i][3] || 0; // value\r\n    }\r\n\r\n    return regl.texture({\r\n      data,\r\n      shape: [stateTexRes, stateTexRes, 4],\r\n      type: 'float'\r\n    });\r\n  };\r\n\r\n  const createBBoxTexture = (bboxByCategory) => {\r\n    const numCategories = Math.max(...Object.keys(bboxByCategory)) + 1;\r\n    bboxTexRes = Math.max(2, Math.ceil(Math.sqrt(numCategories)));\r\n    const data = new Float32Array(bboxTexRes ** 2 * 4);\r\n    for (let i = 0; i < numCategories; i += 1) {\r\n      if (_has(bboxByCategory, i)) {\r\n        data[i * 4] = bboxByCategory[i][0];\r\n        data[i * 4 + 1] = bboxByCategory[i][1];\r\n        data[i * 4 + 2] = bboxByCategory[i][2];\r\n        data[i * 4 + 3] = bboxByCategory[i][3];\r\n      } else {\r\n        data[i * 4] = 0;\r\n        data[i * 4 + 1] = 0;\r\n        data[i * 4 + 2] = 0;\r\n        data[i * 4 + 3] = 0;\r\n      }\r\n    }\r\n\r\n    return regl.texture({\r\n      data,\r\n      shape: [bboxTexRes, bboxTexRes, 4],\r\n      type: 'float',\r\n    });\r\n  };\r\n\r\n  const computeCentroid = (points) => {\r\n    let sumX = 0;\r\n    let sumY = 0;\r\n\r\n    points.forEach((point) => {\r\n      sumX += point[0];\r\n      sumY += point[1];\r\n    });\r\n\r\n    return [\r\n      sumX / points.length,\r\n      sumY / points.length,\r\n    ];\r\n  };\r\n\r\n  const computeBBox = (points) => {\r\n    const centroid = computeCentroid(points);\r\n\r\n    let maxSquaredDist = 0;\r\n    points.forEach((point) => {\r\n      const squaredDist = (centroid[0] - point[0]) ** 2 + (centroid[1] - point[1]) ** 2;\r\n      if (squaredDist > maxSquaredDist) maxSquaredDist = squaredDist;\r\n    });\r\n\r\n    const maxDist = Math.sqrt(maxSquaredDist);\r\n    \r\n    // returns [xMin, yMin, xMax, yMax]\r\n    return [\r\n      centroid[0] - maxDist,\r\n      centroid[1] - maxDist,\r\n      centroid[0] + maxDist,\r\n      centroid[1] + maxDist,\r\n    ];\r\n  };\r\n\r\n  const setPoints = newPoints => {\r\n    isInit = false;\r\n\r\n    numPoints = newPoints.length;\r\n\r\n    stateTex = createStateTexture(newPoints);\r\n    normalPointsIndexBuffer({\r\n      usage: 'static',\r\n      type: 'float',\r\n      data: createPointIndex(numPoints)\r\n    });\r\n\r\n    searchIndex = new KDBush(\r\n      newPoints,\r\n      p => p[0],\r\n      p => p[1],\r\n      16\r\n    );\r\n\r\n    const pointsByCategory = _groupBy(newPoints, 2);\r\n    const bboxByCategory = _mapValues(pointsByCategory, (_, category) => computeBBox(pointsByCategory[category]));\r\n    bboxTex = createBBoxTexture(bboxByCategory);\r\n\r\n    isInit = true;\r\n  };\r\n\r\n  const draw = (time, showRecticleOnce = false) => {\r\n    if (!isInit) return;\r\n\r\n    regl.clear({\r\n      // background color (transparent)\r\n      color: [0, 0, 0, 0],\r\n      depth: 1,\r\n      stencil: 0,\r\n    });\r\n    patternManager.clear();\r\n\r\n    isViewChanged = camera.tick();\r\n\r\n    if (backgroundImage) {\r\n      drawBackgroundImage();\r\n    }\r\n\r\n    patternManager.draw(time, animationMix, useColors, showPatterns);\r\n\r\n    // The draw order of the following calls is important!\r\n    drawPointBodies();\r\n    if (!mouseDown && (showRecticle || showRecticleOnce)) drawRecticle();\r\n    if (hoveredPoint >= 0) drawHoveredPoint();\r\n    if (selection.length) drawSelectedPoint();\r\n\r\n    lasso.draw();\r\n\r\n    // Publish camera change\r\n    if (isViewChanged) pubSub.publish('view', camera.view);\r\n  };\r\n\r\n  const drawRaf = withRaf(draw);\r\n\r\n  const publicDraw = (newPoints, showRecticleOnce = false) => {\r\n    if (newPoints) setPoints(newPoints);\r\n    //drawRaf(showRecticleOnce);\r\n  };\r\n\r\n  const withDraw = f => (...args) => {\r\n    const out = f(...args);\r\n    drawRaf();\r\n    return out;\r\n  };\r\n\r\n  const setBackground = newBackground => {\r\n    if (!newBackground) return;\r\n\r\n    background = toRgba(newBackground, true);\r\n  };\r\n\r\n  const setBackgroundImage = newBackgroundImage => {\r\n    if (!newBackgroundImage) {\r\n      backgroundImage = null;\r\n    } else {\r\n      backgroundImage = newBackgroundImage;\r\n    }\r\n  };\r\n\r\n  const setLassoColor = newLassoColor => {\r\n    if (!newLassoColor) return;\r\n\r\n    lassoColor = toRgba(newLassoColor, true);\r\n\r\n    lasso.setStyle({ color: lassoColor });\r\n  };\r\n\r\n  const setLassoMinDelay = newLassoMinDelay => {\r\n    if (!+newLassoMinDelay) return;\r\n\r\n    lassoMinDelay = +newLassoMinDelay;\r\n    lassoExtendDb = withThrottle(lassoExtend, lassoMinDelay);\r\n  };\r\n\r\n  const setLassoMinDist = newLassoMinDist => {\r\n    if (!+newLassoMinDist) return;\r\n\r\n    lassoMinDist = +newLassoMinDist;\r\n  };\r\n\r\n  const setShowRecticle = newShowRecticle => {\r\n    if (newShowRecticle === null) return;\r\n\r\n    showRecticle = newShowRecticle;\r\n  };\r\n\r\n  const setRecticleColor = newRecticleColor => {\r\n    if (!newRecticleColor) return;\r\n\r\n    recticleColor = toRgba(newRecticleColor, true);\r\n\r\n    recticleHLine.setStyle({ color: recticleColor });\r\n    recticleVLine.setStyle({ color: recticleColor });\r\n  };\r\n\r\n  const setAnimationMix = (newAnimationMix) => {\r\n    if (newAnimationMix === null) return;\r\n\r\n    animationMix = newAnimationMix;\r\n  }\r\n\r\n  const setAnimateDepth = (newAnimateDepth) => {\r\n    if (newAnimateDepth === null) return;\r\n\r\n    animateDepth = newAnimateDepth;\r\n  }\r\n\r\n  const setShowPatterns = (newShowPatterns) => {\r\n    if (newShowPatterns === null) return;\r\n\r\n    showPatterns = newShowPatterns;\r\n  }\r\n\r\n  const setUseColors = (newUseColors) => {\r\n    if (newUseColors === null) return;\r\n\r\n    useColors = newUseColors;\r\n  }\r\n\r\n  /**\r\n   * Update Regl's viewport, drawingBufferWidth, and drawingBufferHeight\r\n   *\r\n   * @description Call this method after the viewport has changed, e.g., width\r\n   * or height have been altered\r\n   */\r\n  const refresh = () => {\r\n    regl.poll();\r\n    camera.refresh();\r\n  };\r\n\r\n  const get = property => {\r\n    if (property === 'background') return background;\r\n    if (property === 'backgroundImage') return backgroundImage;\r\n    if (property === 'colorBy') return colorBy;\r\n    if (property === 'colors') return colors;\r\n    if (property === 'lassoColor') return lassoColor;\r\n    if (property === 'showRecticle') return showRecticle;\r\n    if (property === 'recticleColor') return recticleColor;\r\n    if (property === 'opacity') return opacity;\r\n    if (property === 'pointOutlineWidth') return pointOutlineWidth;\r\n    if (property === 'pointSize') return pointSize;\r\n    if (property === 'pointSizeSelected') return pointSizeSelected;\r\n    if (property === 'width') return width;\r\n    if (property === 'height') return height;\r\n    if (property === 'aspectRatio') return dataAspectRatio;\r\n    if (property === 'canvas') return canvas;\r\n    if (property === 'regl') return regl;\r\n    if (property === 'version') return version;\r\n\r\n    return undefined;\r\n  };\r\n\r\n  const set = ({\r\n    background: newBackground = null,\r\n    backgroundImage: newBackgroundImage = backgroundImage,\r\n    colorBy: newColorBy = colorBy,\r\n    colors: newColors = null,\r\n    opacity: newOpacity = null,\r\n    lassoColor: newLassoColor = null,\r\n    lassoMinDelay: newLassoMinDelay = null,\r\n    lassoMinDist: newLassoMinDist = null,\r\n    showRecticle: newShowRecticle = null,\r\n    recticleColor: newRecticleColor = null,\r\n    pointOutlineWidth: newPointOutlineWidth = null,\r\n    pointSize: newPointSize = null,\r\n    pointSizeSelected: newPointSizeSelected = null,\r\n    height: newHeight = null,\r\n    width: newWidth = null,\r\n    aspectRatio: newDataAspectRatio = null,\r\n    animationMix: newAnimationMix = null,\r\n    animateDepth: newAnimateDepth = null,\r\n    showPatterns: newShowPatterns = null,\r\n    useColors: newUseColors = null,\r\n  } = {}) => {\r\n    setBackground(newBackground);\r\n    setBackgroundImage(newBackgroundImage);\r\n    setColorBy(newColorBy);\r\n    setColors(newColors);\r\n    setOpacity(newOpacity);\r\n    setLassoColor(newLassoColor);\r\n    setLassoMinDelay(newLassoMinDelay);\r\n    setLassoMinDist(newLassoMinDist);\r\n    setShowRecticle(newShowRecticle);\r\n    setRecticleColor(newRecticleColor);\r\n    setPointOutlineWidth(newPointOutlineWidth);\r\n    setPointSize(newPointSize);\r\n    setPointSizeSelected(newPointSizeSelected);\r\n    setHeight(newHeight);\r\n    setWidth(newWidth);\r\n    setDataAspectRatio(newDataAspectRatio);\r\n    setAnimationMix(newAnimationMix);\r\n    setAnimateDepth(newAnimateDepth);\r\n    setShowPatterns(newShowPatterns);\r\n    setUseColors(newUseColors);\r\n\r\n    updateViewAspectRatio();\r\n    camera.refresh();\r\n    refresh();\r\n    //drawRaf();\r\n  };\r\n\r\n  const hover = (point, showRecticleOnce = false) => {\r\n    let needsRedraw = false;\r\n\r\n    if (point >= 0) {\r\n      needsRedraw = true;\r\n      const newHoveredPoint = point !== hoveredPoint;\r\n      hoveredPoint = point;\r\n      hoveredPointIndexBuffer.subdata([point]);\r\n      if (newHoveredPoint) pubSub.publish('pointover', hoveredPoint);\r\n    } else {\r\n      needsRedraw = hoveredPoint;\r\n      hoveredPoint = undefined;\r\n      if (+needsRedraw >= 0) pubSub.publish('pointout', needsRedraw);\r\n    }\r\n\r\n    //if (needsRedraw) drawRaf(null, showRecticleOnce);\r\n  };\r\n\r\n  const reset = () => {\r\n    if (initialView) camera.set(mat4.clone(initialView));\r\n    else camera.lookAt([...initialTarget], initialDistance, initialRotation);\r\n    pubSub.publish('view', camera.view);\r\n  };\r\n\r\n  const keyUpHandler = ({ key }) => {\r\n    switch (key) {\r\n      case 'Escape':\r\n        deselect();\r\n        break;\r\n      default:\r\n      // Nothing\r\n    }\r\n  };\r\n\r\n  const mouseEnterCanvasHandler = () => {\r\n    isMouseInCanvas = true;\r\n  };\r\n\r\n  const mouseLeaveCanvasHandler = () => {\r\n    hover();\r\n    isMouseInCanvas = false;\r\n    //drawRaf();\r\n  };\r\n\r\n  const initCamera = () => {\r\n    camera = createDom2dCamera(canvas);\r\n\r\n    if (initialView) camera.set(mat4.clone(initialView));\r\n    else camera.lookAt([...initialTarget], initialDistance, initialRotation);\r\n  };\r\n\r\n  const wheelHandler = () => {\r\n    //drawRaf();\r\n  };\r\n\r\n  const clear = () => {\r\n    setPoints([]);\r\n  };\r\n\r\n  const init = () => {\r\n    updateViewAspectRatio();\r\n    initCamera();\r\n\r\n    lasso = createLine(regl, { color: lassoColor, width: 3, is2d: true });\r\n    recticleHLine = createLine(regl, {\r\n      color: recticleColor,\r\n      width: 1,\r\n      is2d: true\r\n    });\r\n    recticleVLine = createLine(regl, {\r\n      color: recticleColor,\r\n      width: 1,\r\n      is2d: true\r\n    });\r\n\r\n    // Event listeners\r\n    canvas.addEventListener('wheel', wheelHandler);\r\n\r\n    // Buffers\r\n    normalPointsIndexBuffer = regl.buffer();\r\n    selectedPointsIndexBuffer = regl.buffer();\r\n    hoveredPointIndexBuffer = regl.buffer({\r\n      usage: 'dynamic',\r\n      type: 'float',\r\n      length: FLOAT_BYTES // This buffer is fixed to exactly 1 point\r\n    });\r\n\r\n    colorTex = createColorTexture();\r\n\r\n    // Set dimensions\r\n    set({ width, height });\r\n\r\n    // Setup event handler\r\n    window.addEventListener('keyup', keyUpHandler, false);\r\n    window.addEventListener('blur', blurHandler, false);\r\n    window.addEventListener('mousedown', mouseDownHandler, false);\r\n    window.addEventListener('mouseup', mouseUpHandler, false);\r\n    window.addEventListener('mousemove', mouseMoveHandler, false);\r\n    canvas.addEventListener('mouseenter', mouseEnterCanvasHandler, false);\r\n    canvas.addEventListener('mouseleave', mouseLeaveCanvasHandler, false);\r\n    canvas.addEventListener('click', mouseClickHandler, false);\r\n    canvas.addEventListener('dblclick', mouseDblClickHandler, false);\r\n\r\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\r\n    glBench = new GLBench(gl);\r\n\r\n    regl.frame(({ time }) => {\r\n      glBench.begin();\r\n      draw(time);\r\n      glBench.end();\r\n      glBench.nextFrame(Math.floor(time * 1000));\r\n    });\r\n  };\r\n\r\n  const destroy = () => {\r\n    window.removeEventListener('keyup', keyUpHandler, false);\r\n    window.removeEventListener('blur', blurHandler, false);\r\n    window.removeEventListener('mousedown', mouseDownHandler, false);\r\n    window.removeEventListener('mouseup', mouseUpHandler, false);\r\n    window.removeEventListener('mousemove', mouseMoveHandler, false);\r\n    canvas.removeEventListener('mouseenter', mouseEnterCanvasHandler, false);\r\n    canvas.removeEventListener('mouseleave', mouseLeaveCanvasHandler, false);\r\n    canvas.removeEventListener('click', mouseClickHandler, false);\r\n    canvas.removeEventListener('dblclick', mouseDblClickHandler, false);\r\n    canvas = undefined;\r\n    camera = undefined;\r\n    regl = undefined;\r\n    lasso.destroy();\r\n    pubSub.clear();\r\n  };\r\n\r\n  init(canvas);\r\n\r\n  return {\r\n    clear: withDraw(clear),\r\n    deselect,\r\n    destroy,\r\n    draw: publicDraw,\r\n    get,\r\n    hover,\r\n    refresh,\r\n    reset: withDraw(reset),\r\n    select,\r\n    set,\r\n    subscribe: pubSub.subscribe,\r\n    unsubscribe: pubSub.unsubscribe,\r\n    patternManager,\r\n  };\r\n};\r\n\r\nexport default createScatterplot;\r\n\r\nexport { createRegl, createTextureFromUrl };\r\n","import { PATTERN_TYPES, defaultOptions } from './scatterplot/patterns/PatternManager';\r\n\r\nexport const defaultValues = {\r\n  showPatterns: true,\r\n  useColors: true,\r\n  pointSize: 5,\r\n  animationMix: [0, 1, 0],\r\n};\r\n\r\nexport const defaultPatterns = [\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.RADAR],\r\n    type: PATTERN_TYPES.RADAR,\r\n    category: 0,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.PULSE],\r\n    type: PATTERN_TYPES.PULSE,\r\n    category: 1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.RADAR],\r\n    type: PATTERN_TYPES.RADAR,\r\n    category: 2,\r\n    direction: -1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.PULSE],\r\n    type: PATTERN_TYPES.PULSE,\r\n    category: 3,\r\n    direction: -1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.RADAR],\r\n    type: PATTERN_TYPES.RADAR,\r\n    category: 4,\r\n    invert: 1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.PULSE],\r\n    type: PATTERN_TYPES.PULSE,\r\n    category: 5,\r\n    invert: 1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.RADAR],\r\n    type: PATTERN_TYPES.RADAR,\r\n    category: 6,\r\n    direction: -1,\r\n    invert: 1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.PULSE],\r\n    type: PATTERN_TYPES.PULSE,\r\n    category: 7,\r\n    direction: -1,\r\n    invert: 1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.RADAR],\r\n    type: PATTERN_TYPES.RADAR,\r\n    category: 8,\r\n    direction: -1,\r\n  },\r\n  {\r\n    ...defaultOptions[PATTERN_TYPES.PULSE],\r\n    type: PATTERN_TYPES.PULSE,\r\n    category: 9,\r\n    direction: -1,\r\n    invert: 1,\r\n  }\r\n];\r\n\r\nexport const debounceTime = 100;\r\n\r\n\r\n","export const TOGGLE_THEME = 'toggle theme';\r\nexport const SET_LOADING = 'set loading';\r\nexport const SET_MAX_CATEGORIES = 'set max categories';\r\nexport const UPDATE_CATEGORY_COLOR = 'update category color';\r\n\r\nexport const toggleTheme = () => ({\r\n  type: TOGGLE_THEME\r\n});\r\n\r\n\r\nexport const setLoading = (value) => ({\r\n  type: SET_LOADING,\r\n  value\r\n});\r\n\r\nexport const setMaxCategories = (value) => ({\r\n  type: SET_MAX_CATEGORIES,\r\n  value\r\n});\r\n\r\nexport const updateCategoryColor = (category, color) => ({\r\n  type: UPDATE_CATEGORY_COLOR,\r\n  category,\r\n  color\r\n});\r\n","import { useState, useEffect } from 'react';\r\nimport _debounce from 'lodash-es/debounce';\r\nimport _isFunction from 'lodash-es/isFunction';\r\nimport { debounceTime } from './constants';\r\n\r\nconst updateValue = _debounce((set, optionName, newValue) => set({ [optionName]: newValue }), debounceTime);\r\nexport default function useSlider(optionName, defaultValue, set, processNewValueFn = null) {\r\n  const [value, setValue] = useState(defaultValue);\r\n  const onChange = (newValue) => {\r\n    if (_isFunction(processNewValueFn)) newValue = processNewValueFn(newValue);\r\n    setValue(newValue);\r\n    updateValue(set, optionName, newValue);\r\n  };\r\n\r\n  // this makes it so that if the defaultValue changes, update the underlying state too! (useful for imports)\r\n  useEffect(() => {\r\n    if (value !== defaultValue) setValue(defaultValue);\r\n  }, [defaultValue]);\r\n\r\n  return [value, onChange];\r\n}\r\n","import React, { useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport { FormGroup, Slider, Switch, Alignment, Divider } from '@blueprintjs/core';\r\nimport { defaultValues } from './constants';\r\nimport { toggleTheme } from './actions';\r\nimport useSlider from './useSlider';\r\n\r\nfunction renderPercentage(val) {\r\n  return `${Math.round(val * 100)}%`;\r\n}\r\n\r\nexport default function ScatterplotOptions({ scatterplot }) {\r\n  const [pointSize, pointSizeChange] = useSlider('pointSize', defaultValues.pointSize, scatterplot && scatterplot.set);\r\n  const [animationMix, animationMixChange] = useSlider('animationMix', defaultValues.animationMix, scatterplot && scatterplot.set);\r\n  const [animateDepth, setAnimateDepth] = useState(false);\r\n\r\n  const showPatternsChange = (event) => scatterplot.set({ 'showPatterns': event.target.checked });\r\n  const useColorsChange = (event) => scatterplot.set({ 'useColors': event.target.checked });\r\n\r\n  const isDarkTheme = useSelector((state) => state.isDarkTheme);\r\n  const dispatch = useDispatch();\r\n\r\n  const animateDepthChange = (event) => {\r\n    setAnimateDepth(event.target.checked);\r\n    scatterplot && scatterplot.set({ animateDepth: event.target.checked });\r\n    if (event.target.checked)\r\n      animationMixChange([0, 0, 1]);\r\n    else\r\n      animationMixChange([0, 1, 0]);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Divider />\r\n      <FormGroup>\r\n        <Switch\r\n          defaultChecked={isDarkTheme}\r\n          label=\"Dark theme\"\r\n          onChange={() => dispatch(toggleTheme())}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Switch\r\n          defaultChecked={defaultValues.useColors}\r\n          label=\"Use colors\"\r\n          onChange={useColorsChange}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Switch\r\n          defaultChecked={defaultValues.showPatterns}\r\n          label=\"Show patterns\"\r\n          onChange={showPatternsChange}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label={\"Point size\"}\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={10}\r\n          labelStepSize={10}\r\n          labelPrecision={1}\r\n          value={pointSize}\r\n          onChange={pointSizeChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <Divider />\r\n      <span className=\"option-title bp3-text-muted\">Animation mix</span>\r\n\r\n      <FormGroup\r\n        label=\"Saturation\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          labelRenderer={renderPercentage}\r\n          value={animationMix[0]}\r\n          onChange={(newSat) => animationMixChange([newSat, animationMix[1], animationMix[2]])}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <FormGroup\r\n        label=\"Value\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          labelRenderer={renderPercentage}\r\n          value={animationMix[1]}\r\n          onChange={(newVal) => animationMixChange([animationMix[0], newVal, animationMix[2]])}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <FormGroup\r\n        label=\"Alpha\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          labelRenderer={renderPercentage}\r\n          value={animationMix[2]}\r\n          onChange={(newAlpha) => animationMixChange([animationMix[0], animationMix[1], newAlpha])}\r\n          fill={true}\r\n          disabled={animateDepth}\r\n        />\r\n      </FormGroup>\r\n       <FormGroup>\r\n        <Switch\r\n          checked={animateDepth}\r\n          label=\"Depth (experimental)\"\r\n          onChange={animateDepthChange}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <Divider />\r\n\r\n      <p style={{ textAlign: 'center' }}>\r\n        <b>Note: </b> \r\n        <span className=\"bp3-text-muted\">Each slider has a 100ms debounce to avoid clogging the system.</span>\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","function boxMuller(x, y, sigma, a, k) {\r\n  const twoPI = 2 * Math.PI;\r\n\r\n  let u1;\r\n  let u2;\r\n  do {\r\n    u1 = Math.random();\r\n    u2 = Math.random();\r\n  } while (u1 <= Number.EPSILON);\r\n\r\n  const angle = twoPI * u2;\r\n  const radius = Math.sqrt(-2 * Math.log(u1));\r\n\r\n  let z0 = radius * Math.cos(angle);\r\n  let z1 = radius * Math.sin(angle);\r\n\r\n  const cosA = Math.cos(a);\r\n  const sinA = Math.sin(a);\r\n\r\n  const kcos2Psin2 = k * cosA ** 2 + sinA ** 2;\r\n  const kcossinMcossin = cosA * sinA * (k - 1);\r\n  const cos2Pksin2 = cosA ** 2 + k * sinA ** 2;\r\n\r\n  // elliptic shape is accomplished by rotating and stretching\r\n  // https://www.wolframalpha.com/input/?i=%7B%7Bcos%28a%29%2C-sin%28a%29%2C0%7D%2C%7Bsin%28a%29%2Ccos%28a%29%2C0%7D%2C%7B0%2C0%2C1%7D%7D*%7B%7Bk%2C0%2C0%7D%2C%7B0%2C1%2C0%7D%2C%7B0%2C0%2C1%7D%7D*%7B%7Bcos%28a%29%2Csin%28a%29%2C0%7D%2C%7B-sin%28a%29%2Ccos%28a%29%2C0%7D%2C%7B0%2C0%2C1%7D%7D\r\n  z0 = kcos2Psin2 * z0 + kcossinMcossin * z1;\r\n  z1 = kcossinMcossin * z0 + cos2Pksin2 * z1;\r\n\r\n  return [z0 * sigma + x, z1 * sigma + y];\r\n}\r\n\r\nexport default function dataGen({ x = 0, y = 0, sigma, angle = 0, amplitude = 2, n, category }) {\r\n  const data = [];\r\n\r\n  // generate normal distribution from uniform distribution using box muller algorithm and stretch it so it's elliptic\r\n  for (let i = 0; i < n; ++i) {\r\n    data.push([\r\n      ...boxMuller(x, y, sigma, angle, amplitude),\r\n      category,\r\n      0\r\n    ]);\r\n  }\r\n\r\n  return data;\r\n}\r\n","import React from 'react';\r\nimport { useSelector, shallowEqual } from 'react-redux';\r\nimport { Button } from '@blueprintjs/core';\r\n\r\nexport default function ClusterHeader({ clusterKey, category, setIsOpen, isOpen }) {\r\n  const categoryColors = useSelector((state) => state.categoryColors, shallowEqual);\r\n  const clickHandler = () => setIsOpen(!isOpen);\r\n\r\n  return (\r\n    <Button className=\"cluster-button\" minimal={true} fill={true} active={isOpen} onClick={clickHandler}>\r\n      <div className=\"cluster-header\">\r\n        <div className=\"cluster-title\">\r\n          <b>Cluster: </b> #{clusterKey}\r\n        </div>\r\n        <div className=\"cluster-category\">\r\n          <div style={{ backgroundColor: categoryColors[category] }} className=\"cluster-category__color-box\" />\r\n        </div>\r\n\r\n        <style jsx global>{`\r\n          .cluster-button .bp3-button-text {\r\n            width: 100%;\r\n          }\r\n        `}</style>\r\n        <style jsx>{`\r\n          .cluster-header {\r\n            display: flex;\r\n            align-items: center;\r\n            width: 100%;\r\n          }\r\n\r\n          .cluster-title {\r\n            flex-grow: 1;\r\n          }\r\n\r\n          .cluster-category__color-box {\r\n            float: left;\r\n            width: 20px;\r\n            height: 20px;\r\n            margin: 5px;\r\n            border: 1px solid rgba(0, 0, 0, .2);\r\n          }\r\n        `}</style>\r\n      </div>\r\n    </Button>\r\n  );  \r\n}\r\n","import React, { useState } from 'react';\r\nimport _debounce from 'lodash-es/debounce';\r\nimport { FormGroup, Slider, Collapse, Divider, Button, Intent } from '@blueprintjs/core';\r\nimport ClusterHeader from './ClusterHeader';\r\n\r\nconst debounceTime = 500;\r\n\r\nconst updateX = _debounce((setCluster, newValue) => setCluster({ x: newValue }), debounceTime);\r\nconst updateY = _debounce((setCluster, newValue) => setCluster({ y: newValue }), debounceTime);\r\nconst updateSigma = _debounce((setCluster, newValue) => setCluster({ sigma: newValue }), debounceTime);\r\nconst updateAngle = _debounce((setCluster, newValue) => setCluster({ angle: newValue }), debounceTime);\r\nconst updateAmplitude = _debounce((setCluster, newValue) => setCluster({ amplitude: newValue }), debounceTime);\r\nconst updateN = _debounce((setCluster, newValue) => setCluster({ n: newValue }), debounceTime);\r\nconst updateCategory = _debounce((setCluster, newValue) => setCluster({ category: newValue }), debounceTime);\r\n\r\n\r\nexport default function ClusterOptions({ clusterKey, cluster, setCluster, removeCluster }) {\r\n  const [x, setX] = useState(cluster.x);\r\n  const [y, setY] = useState(cluster.y);\r\n  const [sigma, setSigma] = useState(cluster.sigma);\r\n  const [angle, setAngle] = useState(cluster.angle);\r\n  const [amplitude, setAmplitude] = useState(cluster.amplitude);\r\n  const [n, setN] = useState(cluster.n);\r\n  const [category, setCategory] = useState(cluster.category);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  const xChange = (newValue) => {\r\n    setX(newValue);\r\n    updateX(setCluster, newValue);\r\n  };\r\n  const yChange = (newValue) => {\r\n    setY(newValue);\r\n    updateY(setCluster, newValue);\r\n  };\r\n  const sigmaChange = (newValue) => {\r\n    setSigma(newValue);\r\n    updateSigma(setCluster, newValue);\r\n  };\r\n  const angleChange = (newValue) => {\r\n    setAngle(newValue);\r\n    updateAngle(setCluster, newValue);\r\n  };\r\n  const amplitudeChange = (newValue) => {\r\n    setAmplitude(newValue);\r\n    updateAmplitude(setCluster, newValue);\r\n  };\r\n  const nChange = (newValue) => {\r\n    setN(newValue);\r\n    updateN(setCluster, newValue);\r\n  };\r\n  const categoryChange = (newValue) => {\r\n    setCategory(newValue);\r\n    updateCategory(setCluster, newValue);\r\n  };\r\n\r\n  const removeClickHandler = () => removeCluster(clusterKey);\r\n\r\n  return (\r\n    <div>\r\n      <ClusterHeader clusterKey={clusterKey} category={category} setIsOpen={setIsOpen} isOpen={isOpen} />\r\n      <Collapse isOpen={isOpen}>\r\n        <FormGroup\r\n          label=\"X-pos\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={0.01}\r\n            min={-1}\r\n            max={1}\r\n            labelPrecision={1}\r\n            labelStepSize={2}\r\n            value={x}\r\n            onChange={xChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Y-pos\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={0.01}\r\n            min={-1}\r\n            max={1}\r\n            labelPrecision={1}\r\n            labelStepSize={2}\r\n            value={y}\r\n            onChange={yChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Std. Dev.\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={0.01}\r\n            min={0}\r\n            max={0.8}\r\n            labelPrecision={1}\r\n            labelStepSize={0.8}\r\n            value={sigma}\r\n            onChange={sigmaChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Angle\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={0.03}\r\n            min={0}\r\n            max={Math.PI}\r\n            labelPrecision={1}\r\n            labelStepSize={Math.PI}\r\n            value={angle}\r\n            onChange={angleChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Amplitude\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={0.03}\r\n            min={0}\r\n            max={3}\r\n            labelPrecision={1}\r\n            labelStepSize={3}\r\n            value={amplitude}\r\n            onChange={amplitudeChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Points\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={10}\r\n            min={1}\r\n            max={10000}\r\n            labelStepSize={9999}\r\n            value={n}\r\n            onChange={nChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label=\"Category\"\r\n          inline={true}\r\n        >\r\n          <Slider\r\n            stepSize={1}\r\n            min={0}\r\n            max={9}\r\n            labelStepSize={9}\r\n            value={category}\r\n            onChange={categoryChange}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        <div className=\"cluster-remove\">\r\n          <Button intent={Intent.DANGER} onClick={removeClickHandler}>\r\n            Remove this cluster\r\n          </Button>\r\n        </div>\r\n        <Divider />\r\n      </Collapse>\r\n\r\n      <style jsx>{`\r\n        .cluster-remove {\r\n          margin: 10px 0;\r\n          text-align: center;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","import diamondsCsv from './diamonds.csv';\r\n\r\nexport default {\r\n  csv: diamondsCsv,\r\n  dataFields: ['carat', 'depth', 'table', 'price', 'x', 'y', 'z'],\r\n  catFields: ['cut']\r\n};\r\n","export default __webpack_public_path__ + \"3345740ca9df509867741b3971dd6bb1.csv\";","import abaloneCsv from './abalone.csv';\r\n\r\nexport default {\r\n  csv: abaloneCsv,\r\n  dataFields: ['Length', 'Diameter', 'Height', 'Whole weight', 'Shucked weight', 'Viscera weight', 'Shell weight', 'Rings'],\r\n  catFields: ['Sex']\r\n};\r\n","export default __webpack_public_path__ + \"72b7a04c97f6f9cedc338634227060b2.csv\";","import beautifulCsv from './BeautifulClusters.csv';\r\n\r\nexport default {\r\n  csv: beautifulCsv,\r\n  dataFields: ['x', 'y'],\r\n  catFields: ['c']\r\n};\r\n","export default __webpack_public_path__ + \"51ca2023fb832d7f5a4a5e8c46d94683.csv\";","import Papa from 'papaparse';\r\n\r\nexport default function loadData(csv, dataOptions) {\r\n  const { xField, yField, catField } = dataOptions;\r\n\r\n  const categories = new Map();\r\n  let nCategories = 0;\r\n\r\n  let xMin = Number.POSITIVE_INFINITY;\r\n  let yMin = Number.POSITIVE_INFINITY;\r\n  let xMax = Number.NEGATIVE_INFINITY;\r\n  let yMax = Number.NEGATIVE_INFINITY;\r\n\r\n  const res = [];\r\n\r\n  return new Promise((resolve, reject) => {\r\n    Papa.parse(csv, {\r\n      header: true,\r\n      dynamicTyping: true,\r\n      skipEmptyLines: true,\r\n      download: true,\r\n      step: (results) => {\r\n        if (!categories.has(results.data[catField]))\r\n          categories.set(results.data[catField], nCategories++);\r\n\r\n        res.push([\r\n          results.data[xField],\r\n          results.data[yField],\r\n          categories.get(results.data[catField]),\r\n          0\r\n        ]);\r\n\r\n        if (results.data[xField] < xMin) xMin = results.data[xField];\r\n        if (results.data[xField] > xMax) xMax = results.data[xField];\r\n        if (results.data[yField] < yMin) yMin = results.data[yField];\r\n        if (results.data[yField] > yMax) yMax = results.data[yField];\r\n      },\r\n      complete: () => {\r\n        const xLength = (xMax - xMin) / 2;\r\n        const yLength = (yMax - yMin) / 2;\r\n\r\n        for(let i = 0; i < res.length; ++i) {\r\n          res[i][0] = (res[i][0] - xMin) / xLength - 1;\r\n          res[i][1] = (res[i][1] - yMin) / yLength - 1;\r\n        }\r\n\r\n        resolve({ results: res, nCategories });\r\n      },\r\n      error: () => {\r\n        reject();\r\n      }\r\n    });\r\n  });\r\n}\r\n","import Papa from 'papaparse';\r\n\r\n// ISSUE: needs to be async\r\nexport default function parseData(csvFile) {\r\n  let fieldNames = [];\r\n  let parsedFields = false;\r\n\r\n  let fieldIsCategory = {};\r\n  let fieldValuesSet = {};\r\n  let fieldIsData = {};\r\n\r\n  let promise = new Promise((resolve, reject) => {\r\n    Papa.parse(csvFile, {\r\n      //header: true,\r\n      dynamicTyping: true,\r\n      skipEmptyLines: true,\r\n      step: (results) => {\r\n        if (!parsedFields) {\r\n          fieldNames = [...results.data];\r\n          parsedFields = true;\r\n\r\n          fieldNames.forEach((fieldName) => {\r\n            if (fieldName) { // do this to avoid empty string\r\n              fieldIsCategory[fieldName] = true;\r\n              fieldValuesSet[fieldName] = new Set();\r\n              fieldIsData[fieldName] = true;\r\n            }\r\n          });\r\n\r\n          return;\r\n        }\r\n\r\n        fieldNames.forEach((fieldName, i) => {\r\n          if (fieldIsCategory[fieldName]) {\r\n            if (!fieldValuesSet[fieldName].has(results.data[i])) {\r\n              fieldValuesSet[fieldName].add(results.data[i]);\r\n              if (fieldValuesSet[fieldName].size > 10) fieldIsCategory[fieldName] = false;\r\n            }\r\n          }\r\n\r\n          if (fieldIsData[fieldName] && typeof results.data[i] !== 'number')\r\n            fieldIsData[fieldName] = false;\r\n        });\r\n      },\r\n      complete: () => {\r\n        const catFields = [];\r\n        const dataFields = [];\r\n\r\n        fieldNames.forEach((fieldName) => {\r\n          if (fieldIsCategory[fieldName]) catFields.push(fieldName);\r\n          if (fieldIsData[fieldName]) dataFields.push(fieldName);\r\n        });\r\n\r\n        resolve([dataFields, catFields]);\r\n      },\r\n      error: () => {\r\n        reject();\r\n      }\r\n    });\r\n  });\r\n\r\n  return promise;\r\n}\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { FormGroup, HTMLSelect, Divider, Button, Intent, FileInput } from '@blueprintjs/core';\r\nimport { useDispatch } from 'react-redux';\r\nimport { setLoading, setMaxCategories } from './actions';\r\nimport Diamonds from './data/Diamonds';\r\nimport Abalone from './data/Abalone';\r\nimport Beautiful from './data/Beautiful';\r\nimport loadData from './loadData';\r\nimport parseData from './parseData';\r\n\r\n// each data source should be an object containing 3 props: csv, dataFields, and catFields\r\nconst dataSources = {\r\n  Diamonds,\r\n  Abalone,\r\n  Beautiful,\r\n};\r\n\r\nfunction DataOptions({ dataFields, catFields, dataOptions, setDataOptions }) {\r\n  const { xField, yField, catField } = dataOptions;\r\n\r\n  useEffect(() => {\r\n    setDataOptions((prevState) => ({\r\n      ...prevState,\r\n      xField: dataFields[0],\r\n      yField: dataFields[1],\r\n      catField: catFields[0],\r\n    }));\r\n  }, [dataFields, catFields]);\r\n\r\n  const xOptions = dataFields.filter((field) => field !== yField);\r\n  const yOptions = dataFields.filter((field) => field !== xField);\r\n\r\n  const xChange = (event) => {\r\n    const newX = event.target.value;\r\n    setDataOptions((prevState) => ({ ...prevState, xField: newX }));\r\n  };\r\n  const yChange = (event) => {\r\n    const newY = event.target.value;\r\n    setDataOptions((prevState) => ({ ...prevState, yField: newY }));\r\n  };\r\n  const catChange = (event) => {\r\n    const newCat = event.target.value;\r\n    setDataOptions((prevState) => ({ ...prevState, catField: newCat }));\r\n  };\r\n\r\n  if (xField === null || yField === null || catField === null) return null;\r\n\r\n  return (\r\n    <div>\r\n      <FormGroup\r\n        label=\"X\"\r\n        inline={true}\r\n        className=\"data-option-select\"\r\n      >\r\n        <HTMLSelect\r\n          options={xOptions}\r\n          onChange={xChange}\r\n          value={xField}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <FormGroup\r\n        label=\"Y\"\r\n        inline={true}\r\n        className=\"data-option-select\"\r\n      >\r\n        <HTMLSelect\r\n          options={yOptions}\r\n          onChange={yChange}\r\n          value={yField}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <FormGroup\r\n        label=\"Category\"\r\n        inline={true}\r\n        className=\"data-option-select\"\r\n      >\r\n        <HTMLSelect\r\n          options={catFields}\r\n          onChange={catChange}\r\n          value={catField}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n\r\n      <style jsx global>\r\n      {`\r\n        .data-option-select {\r\n          margin-bottom: 5px;\r\n        }\r\n      `}  \r\n      </style>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function DataLoader({ scatterplot }) {\r\n  const [dataSource, setDataSource] = useState('Diamonds');\r\n  const [dataOptions, setDataOptions] = useState({\r\n    xField: null,\r\n    yField: null,\r\n    catField: null,\r\n  });\r\n  const dispatch = useDispatch();\r\n\r\n  const [inputFile, setInputFile] = useState(null);\r\n  const fileInputRef = useRef(null);\r\n  const inputFieldsRef = useRef(null);\r\n\r\n  const dataSourceChange = (event) => {\r\n    if (!event.target.value) return;\r\n\r\n    setDataSource(event.target.value)\r\n    setInputFile(null);\r\n    fileInputRef.current.value = '';\r\n  }\r\n  const loadClickHandler = async () => {\r\n    const csv = inputFile ? inputFile : dataSources[dataSource].csv;\r\n\r\n    await dispatch(setLoading(true));\r\n    const { results, nCategories } = await loadData(csv, dataOptions);\r\n    await dispatch(setLoading(false));\r\n\r\n    dispatch(setMaxCategories(nCategories));\r\n    scatterplot.draw(results);\r\n  }\r\n  const inputFileChange = async () =>  {\r\n    if (fileInputRef.current.files.length === 0) return;\r\n\r\n    await dispatch(setLoading(true));\r\n    inputFieldsRef.current = await parseData(fileInputRef.current.files[0]);\r\n    await dispatch(setLoading(false));\r\n\r\n    setInputFile(fileInputRef.current.files[0]);\r\n    setDataSource('');\r\n  }\r\n\r\n  const dataFields = inputFile ? inputFieldsRef.current[0] : dataSources[dataSource].dataFields;\r\n  const catFields = inputFile ? inputFieldsRef.current[1] : dataSources[dataSource].catFields;\r\n\r\n  return (\r\n    <div>\r\n      <FormGroup\r\n        label=\"Data source\"\r\n        inline={true}\r\n      >\r\n        <HTMLSelect\r\n          options={[{ label: '---', value: '' }, ...Object.keys(dataSources).map((value) => ({ label: value + '.csv', value }))]}\r\n          onChange={dataSourceChange}\r\n          value={dataSource}\r\n          fill={true}\r\n        />\r\n\r\n      </FormGroup>\r\n\r\n      <div className=\"v-space\" />\r\n\r\n      <FormGroup className=\"v-space\">\r\n        <FileInput\r\n          text={inputFile ? inputFile.name : 'Other CSV file...'}\r\n          hasSelection={inputFile !== null}\r\n          fill={true}\r\n          inputProps={{ onChange: inputFileChange, ref: fileInputRef }}\r\n        />\r\n      </FormGroup>\r\n\r\n      <Divider />\r\n\r\n      <DataOptions\r\n        dataFields={dataFields}\r\n        catFields={catFields}\r\n        dataOptions={dataOptions}\r\n        setDataOptions={setDataOptions}\r\n      />\r\n\r\n      <div className=\"data-add-new\">\r\n        <Button intent={Intent.PRIMARY} onClick={loadClickHandler}>\r\n          Load data\r\n        </Button>\r\n      </div>\r\n      <style jsx>\r\n      {`\r\n        .data-add-new {\r\n          margin: 10px 0;\r\n          text-align: center;\r\n        }\r\n\r\n        .v-space {\r\n          margin-top: 5px;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { Divider, Button, Intent } from '@blueprintjs/core';\r\nimport dataGen from './dataGen';\r\nimport ClusterOptions from './ClusterOptions';\r\nimport { setMaxCategories } from './actions';\r\nimport DataLoader from './DataLoader';\r\n\r\n// sigma ~ x radius\r\n// amplitude ~ y radius\r\nconst defaultCluster = (category) => {\r\n  if (category > 9) throw new Error(\"There are at most 10 categories!\");\r\n\r\n  const sigma = Math.random() / 3 + 0.1;\r\n  const max = 1 - sigma * 2 - 0.2; // want x, y mean in interval (-max, max) to avoid points outside of canvas boundary.\r\n\r\n  return {\r\n    x: Math.random() * max * 2 - max,\r\n    y: Math.random() * max * 2 - max,\r\n    sigma,\r\n    angle: Math.random() * Math.PI,\r\n    amplitude: Math.random(),\r\n    n: 100,\r\n    category\r\n  };\r\n};\r\n\r\n// gives you a new key when you call it.\r\nconst keyGen = (() => {\r\n  let i = 3;\r\n  return () => i++;\r\n})();\r\n\r\nexport default function DataOptions({ scatterplot }) {\r\n  const [clusters, setClusters] = useState({\r\n    1: defaultCluster(0),\r\n    2: defaultCluster(1)\r\n  });\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (scatterplot !== null) {\r\n      scatterplot.draw(Object.keys(clusters).map((clusterKey) => dataGen(clusters[clusterKey]))\r\n        .reduce((acc, curr) => acc.concat(curr), []));\r\n      dispatch(setMaxCategories(Math.max(...Object.keys(clusters).map((clusterKey) => clusters[clusterKey].category)) + 1));\r\n    }\r\n  }, [scatterplot, clusters])\r\n\r\n  const createSetCluster = (clusterKey) => {\r\n    return (newCluster) => {\r\n      setClusters((oldClusters) => ({ ...oldClusters, [clusterKey]: { ...oldClusters[clusterKey], ...newCluster }}));\r\n    };\r\n  };\r\n\r\n  const addCluster = (category) => setClusters((oldClusters) => ({\r\n    ...oldClusters,\r\n    [keyGen()]: defaultCluster(category)\r\n  }));\r\n\r\n  const removeCluster = (clusterKey) => setClusters((oldClusters) => {\r\n    const { [clusterKey]: _, ...otherKeys } = oldClusters; /* eslint-disable-line no-unused-vars */\r\n    return otherKeys;\r\n  });\r\n\r\n  const unusedCategory = () => {\r\n    const usedCategories = new Set();\r\n    Object.keys(clusters).forEach((clusterKey) => usedCategories.add(clusters[clusterKey].category));\r\n\r\n    for (let i = 0; i < 10; ++i) {\r\n      if (!usedCategories.has(i)) return i;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  const addClickHandler = () => addCluster(unusedCategory());\r\n\r\n  const renderClusterOptions = Object.keys(clusters).map((clusterKey) => (\r\n    <ClusterOptions\r\n      key={clusterKey}\r\n      clusterKey={clusterKey}\r\n      cluster={clusters[clusterKey]}\r\n      setCluster={createSetCluster(clusterKey)}\r\n      removeCluster={removeCluster}\r\n    />\r\n  ));\r\n\r\n  return (\r\n    <div>\r\n      <Divider />\r\n      <p className=\"bp3-text-muted\" style={{ textAlign: 'center' }}>\r\n        Click on a cluster to show/hide options.\r\n      </p>\r\n      {renderClusterOptions}\r\n      <div className=\"data-add-new\">\r\n        <Button intent={Intent.PRIMARY} onClick={addClickHandler}>\r\n          Add cluster\r\n        </Button>\r\n      </div>\r\n\r\n      <Divider />\r\n\r\n      <span className=\"option-title bp3-text-muted\">LOAD REAL DATA</span>\r\n      <DataLoader scatterplot={scatterplot} />\r\n\r\n      <style jsx>{`\r\n        .data-add-new {\r\n          margin: 10px 0;\r\n          text-align: center;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { useSelector, shallowEqual } from 'react-redux';\r\nimport { Button } from '@blueprintjs/core';\r\n\r\nexport default function PatternHeader({ patternKey, category, setIsOpen, isOpen }) {\r\n  const categoryColors = useSelector((state) => state.categoryColors, shallowEqual);\r\n  const clickHandler = () => setIsOpen(!isOpen);\r\n\r\n  return (\r\n    <Button className=\"pattern-button\" minimal={true} fill={true} active={isOpen} onClick={clickHandler}>\r\n      <div className=\"pattern-header\">\r\n        <div className=\"pattern-title\">\r\n          <b>Pattern: </b> #{patternKey}\r\n        </div>\r\n        <div className=\"pattern-category\">\r\n          <div style={{ backgroundColor: categoryColors[category] }} className=\"pattern-category__color-box\" />\r\n        </div>\r\n\r\n        <style jsx global>{`\r\n          .pattern-button .bp3-button-text {\r\n            width: 100%;\r\n          }\r\n        `}</style>\r\n        <style jsx>{`\r\n          .pattern-header {\r\n            display: flex;\r\n            align-items: center;\r\n            width: 100%;\r\n          }\r\n\r\n          .pattern-title {\r\n            flex-grow: 1;\r\n          }\r\n\r\n          .pattern-category__color-box {\r\n            float: left;\r\n            width: 20px;\r\n            height: 20px;\r\n            margin: 5px;\r\n            border: 1px solid rgba(0, 0, 0, .2);\r\n          }\r\n        `}</style>\r\n      </div>\r\n    </Button>\r\n  );  \r\n}\r\n","import { UPDATE_CATEGORY_COLOR } from '../actions';\r\n\r\n// http://colorbrewer2.org/?type=qualitative&scheme=Set1&n=9\r\nexport const defaultColors = ['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#ffff33','#a65628','#f781bf','#999999', '#0fc'];\r\n\r\n// https://blueprintjs.com/docs/#core/colors\r\n/*export const defaultColors = [\r\n  \"#DB2C6F\",\r\n  \"#2965CC\",\r\n  \"#29A634\",\r\n  \"#D99E0B\",\r\n  \"#D13913\",\r\n  \"#8F398F\",\r\n  \"#00B3A4\",\r\n  \"#9BBF30\",\r\n  \"#96622D\",\r\n  \"#7157D9\"\r\n];*/\r\n\r\nexport default function categoryColors(state = defaultColors, action) {\r\n  if (action.type === UPDATE_CATEGORY_COLOR) {\r\n    const shallowCopy = [...state];\r\n    shallowCopy[action.category] = action.color;\r\n    return shallowCopy;\r\n  }\r\n  return state;\r\n}\r\n","import { useState } from 'react';\r\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\r\nimport { updateCategoryColor } from './actions';\r\n\r\nexport default function useColorPicker(pattern, setPattern) {\r\n  const dispatch = useDispatch();\r\n  const categoryColors = useSelector((state) => state.categoryColors, shallowEqual);\r\n  const [color, setColor] = useState(categoryColors[pattern.category]);\r\n  const colorChange = (newColor) => {\r\n    setPattern({ hsvColor: [newColor.hsv.h / 360, newColor.hsv.s, newColor.hsv.v]});\r\n    dispatch(updateCategoryColor(pattern.category, newColor.hex));\r\n    setColor(newColor.hex);\r\n  };\r\n\r\n  return [color, colorChange];\r\n}\r\n","import React from 'react';\r\nimport { FormGroup, Slider, Switch, Alignment } from '@blueprintjs/core';\r\nimport { CirclePicker } from 'react-color';\r\nimport { defaultColors } from './reducers/categoryColors';\r\nimport useSlider from './useSlider';\r\nimport useColorPicker from './useColorPicker';\r\n\r\nfunction renderPercentage(val) {\r\n  return `${Math.round(val * 100)}%`;\r\n}\r\n\r\nfunction renderSeconds(val) {\r\n  return `${val.toPrecision(2)}s`;\r\n}\r\n\r\nexport default function PulseOptions({ pattern, setPattern }) {\r\n  const [a, aChange] = useSlider('a', pattern.a, setPattern);\r\n  const [c1, c1Change] = useSlider('c1', pattern.c1, setPattern);\r\n  const [c2, c2Change] = useSlider('c2', pattern.c2, setPattern);\r\n  const [minValue, minValueChange] = useSlider('minValue', pattern.minValue, setPattern);\r\n  const [phaseShift, phaseShiftChange] = useSlider('phaseShift', pattern.phaseShift, setPattern);\r\n  const [cyclesPerSecond, cyclesPerSecondChange] = useSlider('cyclesPerSecond', pattern.cyclesPerSecond, setPattern);\r\n  const [wavesPerCycle, wavesPerCycleChange] = useSlider('wavesPerCycle', pattern.wavesPerCycle, setPattern);\r\n  const [curve, curveChange] = useSlider('curve', pattern.curve, setPattern);\r\n  const [color, colorChange] = useColorPicker(pattern, setPattern);\r\n  const [hueVariation, hueVariationChange] = useSlider('hueVariation', pattern.hueVariation, setPattern);\r\n  const [hueVariationPeriod, hueVariationPeriodChange] = useSlider('hueVariationPeriod', pattern.hueVariationPeriod, setPattern);\r\n\r\n  const directionChange = (event) => setPattern({ direction: event.target.checked ? 1 : -1 });\r\n  const invertChange = (event) => setPattern({ invert: event.target.checked ? 1 : 0 });\r\n\r\n  const direction = pattern.direction === 1;\r\n  const invert = pattern.invert === 1;\r\n\r\n  return (\r\n    <>\r\n      <span className=\"option-title bp3-text-muted\">Wave Parameters</span>\r\n      <FormGroup>\r\n        <Switch\r\n          checked={direction}\r\n          label=\"Direction\"\r\n          onChange={directionChange}\r\n          innerLabel=\"In\"\r\n          innerLabelChecked=\"Out\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Switch\r\n          checked={invert}\r\n          label=\"Invert\"\r\n          onChange={invertChange}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"a\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelPrecision={2}\r\n          labelStepSize={1}\r\n          value={a}\r\n          onChange={aChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"c1\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelPrecision={2}\r\n          labelStepSize={1}\r\n          value={c1}\r\n          onChange={c1Change}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"c2\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelPrecision={2}\r\n          labelStepSize={1}\r\n          value={c2}\r\n          onChange={c2Change}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Min value\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          labelRenderer={renderPercentage}\r\n          value={minValue}\r\n          onChange={minValueChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Phase shift\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          value={phaseShift}\r\n          onChange={phaseShiftChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Cycles/s\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={5}\r\n          labelPrecision={1}\r\n          labelStepSize={5}\r\n          value={cyclesPerSecond}\r\n          onChange={cyclesPerSecondChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Waves/cycle\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={5}\r\n          labelPrecision={1}\r\n          labelStepSize={5}\r\n          value={wavesPerCycle}\r\n          onChange={wavesPerCycleChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Curve\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={-5}\r\n          max={5}\r\n          labelStepSize={10}\r\n          value={curve}\r\n          onChange={curveChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <span className=\"option-title bp3-text-muted\">Color Parameters</span>\r\n      <FormGroup\r\n        label=\"Color\"\r\n        inline={true}\r\n      >\r\n        <CirclePicker\r\n          color={color}\r\n          colors={defaultColors}\r\n          onChange={colorChange}\r\n          circleSize={14}\r\n          circleSpacing={1}\r\n          width={150}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Hue amp.\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.005}\r\n          min={0}\r\n          max={0.2}\r\n          labelPrecision={2}\r\n          labelStepSize={0.2}\r\n          labelRenderer={renderPercentage}\r\n          value={hueVariation}\r\n          onChange={hueVariationChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Hue period\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={5}\r\n          labelStepSize={5}\r\n          labelRenderer={renderSeconds}\r\n          value={hueVariationPeriod}\r\n          onChange={hueVariationPeriodChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { FormGroup, Slider, Switch, Alignment } from '@blueprintjs/core';\r\nimport { CirclePicker } from 'react-color';\r\nimport { defaultColors } from './reducers/categoryColors';\r\nimport useSlider from './useSlider';\r\nimport useColorPicker from './useColorPicker';\r\n\r\nfunction renderPercentage(val) {\r\n  return `${Math.round(val * 100)}%`;\r\n}\r\n\r\nfunction renderSeconds(val) {\r\n  return `${val.toPrecision(2)}s`;\r\n}\r\n\r\nexport default function RadarOptions({ pattern, setPattern }) {\r\n  const [gamma1, gamma1Change] = useSlider('gamma1', pattern.gamma1, setPattern);\r\n  const [gamma2, gamma2Change] = useSlider('gamma2', pattern.gamma2, setPattern);\r\n  const [maxValue, maxValueChange] = useSlider('maxValue', pattern.maxValue, setPattern);\r\n  const [minValue, minValueChange] = useSlider('minValue', pattern.minValue, setPattern);\r\n  const [phaseShift, phaseShiftChange] = useSlider('phaseShift', pattern.phaseShift, setPattern);\r\n  const [cyclesPerSecond, cyclesPerSecondChange] = useSlider('cyclesPerSecond', pattern.cyclesPerSecond, setPattern);\r\n  const [nSpokes, nSpokesChange] = useSlider('nSpokes', pattern.nSpokes, setPattern);\r\n  const [curve, curveChange] = useSlider('curve', pattern.curve, setPattern);\r\n  const [color, colorChange] = useColorPicker(pattern, setPattern);\r\n  const [hueVariation, hueVariationChange] = useSlider('hueVariation', pattern.hueVariation, setPattern);\r\n  const [hueVariationPeriod, hueVariationPeriodChange] = useSlider('hueVariationPeriod', pattern.hueVariationPeriod, setPattern);\r\n\r\n  const directionChange = (event) => setPattern({ direction: event.target.checked ? 1 : -1 });\r\n  const invertChange = (event) => setPattern({ invert: event.target.checked ? 1 : 0 });\r\n\r\n  const direction = pattern.direction === 1;\r\n  const invert = pattern.invert === 1;\r\n\r\n  return (\r\n    <>\r\n      <span className=\"option-title bp3-text-muted\">Rotation Parameters</span>\r\n      <FormGroup>\r\n        <Switch\r\n          checked={direction}\r\n          label=\"Direction\"\r\n          onChange={directionChange}\r\n          innerLabel=\"Counter-clockwise\"\r\n          innerLabelChecked=\"Clockwise\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup>\r\n        <Switch\r\n          checked={invert}\r\n          label=\"Invert\"\r\n          onChange={invertChange}\r\n          innerLabel=\"No\"\r\n          innerLabelChecked=\"Yes\"\r\n          alignIndicator={Alignment.RIGHT}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"gamma1\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={25}\r\n          labelPrecision={1}\r\n          labelStepSize={25}\r\n          value={gamma1}\r\n          onChange={gamma1Change}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"gamma2\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={25}\r\n          labelPrecision={1}\r\n          labelStepSize={25}\r\n          value={gamma2}\r\n          onChange={gamma2Change}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Max value\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          value={maxValue}\r\n          onChange={(newValue) => { \r\n            if (newValue > minValue) maxValueChange(newValue);\r\n            else if (maxValue !== minValue) maxValueChange(minValue);\r\n          }}\r\n          labelRenderer={renderPercentage}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Min value\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          value={minValue}\r\n          onChange={(newValue) => {\r\n            if (newValue < maxValue) minValueChange(newValue);\r\n            else if (minValue !== maxValue) minValueChange(maxValue);\r\n          }}\r\n          labelRenderer={renderPercentage}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Phase shift\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={1}\r\n          labelStepSize={1}\r\n          value={phaseShift}\r\n          onChange={phaseShiftChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Cycles/s\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={5}\r\n          labelPrecision={1}\r\n          labelStepSize={5}\r\n          value={cyclesPerSecond}\r\n          onChange={cyclesPerSecondChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label='\"Spokes\"'\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={1}\r\n          min={1}\r\n          max={10}\r\n          labelStepSize={9}\r\n          value={nSpokes}\r\n          onChange={nSpokesChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Curve\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={-5}\r\n          max={5}\r\n          labelStepSize={10}\r\n          value={curve}\r\n          onChange={curveChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <span className=\"option-title bp3-text-muted\">Color Parameters</span>\r\n      <FormGroup\r\n        label=\"Color\"\r\n        inline={true}\r\n      >\r\n        <CirclePicker\r\n          color={color}\r\n          colors={defaultColors}\r\n          onChange={colorChange}\r\n          circleSize={14}\r\n          circleSpacing={1}\r\n          width={150}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Hue amp.\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.005}\r\n          min={0}\r\n          max={0.2}\r\n          labelPrecision={2}\r\n          labelStepSize={0.2}\r\n          labelRenderer={renderPercentage}\r\n          value={hueVariation}\r\n          onChange={hueVariationChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n      <FormGroup\r\n        label=\"Hue period\"\r\n        inline={true}\r\n      >\r\n        <Slider\r\n          stepSize={0.01}\r\n          min={0}\r\n          max={5}\r\n          labelStepSize={5}\r\n          labelRenderer={renderSeconds}\r\n          value={hueVariationPeriod}\r\n          onChange={hueVariationPeriodChange}\r\n          fill={true}\r\n        />\r\n      </FormGroup>\r\n    </>\r\n  );\r\n}\r\n","import React, { useState, useRef } from 'react';\r\nimport { FormGroup, HTMLSelect, Collapse, Divider, Button, Intent, FileInput } from '@blueprintjs/core';\r\nimport { saveAs } from 'file-saver';\r\nimport PatternHeader from './PatternHeader';\r\nimport { PATTERN_TYPES, defaultOptions } from './scatterplot/patterns/PatternManager';\r\nimport PulseOptions from './PulseOptions';\r\nimport RadarOptions from './RadarOptions';\r\n\r\nexport default function PatternOptions({ patternKey, pattern, setPattern }) {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const importFileRef = useRef(null);\r\n  const { type } = pattern;\r\n\r\n  const typeChange = (event) => {\r\n    const newValue = parseInt(event.target.value, 10);\r\n    setPattern({ type: newValue, ...defaultOptions[newValue] });\r\n  };\r\n\r\n  let typeOptions;\r\n  if (type === PATTERN_TYPES.PULSE) {\r\n    typeOptions = <PulseOptions pattern={pattern} setPattern={setPattern} />\r\n  } else if (type === PATTERN_TYPES.RADAR) {\r\n    typeOptions = <RadarOptions pattern={pattern} setPattern={setPattern} />\r\n  }\r\n\r\n  const onExportClick = () => {\r\n    // hsvColor and category should not be exported! (it's too much work)\r\n    const {\r\n      hsvColor, // eslint-disable-line no-unused-vars\r\n      category, // eslint-disable-line no-unused-vars\r\n      ...patternOptions\r\n    } = pattern;\r\n\r\n    const jsonFile = new Blob([JSON.stringify(patternOptions, null, 2)], {\r\n      type: 'application/json',\r\n    });\r\n\r\n    saveAs(jsonFile, 'pattern.json');\r\n  };\r\n\r\n  const onImportClick = async () => {\r\n    if (importFileRef.current === null)\r\n      throw new Error('Import doesn\\'t work for some reason');\r\n\r\n    const textPromise = importFileRef.current.files[0].text();\r\n    const patternJSON = JSON.parse(await textPromise);\r\n\r\n    setPattern(patternJSON);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <PatternHeader patternKey={patternKey} category={pattern.category} setIsOpen={setIsOpen} isOpen={isOpen} />\r\n      <Collapse isOpen={isOpen}>\r\n        <FormGroup\r\n          label=\"Type\"\r\n          inline={true}\r\n        >\r\n          <HTMLSelect\r\n            options={[\r\n              { label: 'Radar', value: PATTERN_TYPES.RADAR },\r\n              { label: 'Pulse', value: PATTERN_TYPES.PULSE },\r\n            ]}\r\n            onChange={typeChange}\r\n            value={type}\r\n            fill={true}\r\n          />\r\n        </FormGroup>\r\n        {typeOptions}\r\n        <span className=\"option-title bp3-text-muted\">Import/Export</span>\r\n        <div className=\"pattern-buttons\">\r\n          <Button onClick={onExportClick} className=\"pattern-buttons__button\" fill={true}>\r\n            Export pattern\r\n          </Button>\r\n\r\n          <FileInput\r\n            buttonText=\"Import pattern\"\r\n            inputProps={{ onChange: onImportClick, ref: importFileRef, intent: Intent.PRIMARY, accept: 'application/json' }}\r\n            fill={true}\r\n            className=\"pattern-buttons__button\"\r\n          />\r\n        </div>\r\n        <Divider />\r\n        \r\n      </Collapse>\r\n      <style jsx>\r\n      {`\r\n        .pattern-buttons {\r\n          text-align: center;\r\n          margin: 15px 0;\r\n        }\r\n      `}\r\n      </style>\r\n      <style jsx global>\r\n      {`\r\n        .pattern-buttons__button {\r\n          margin: 5px 0;\r\n        }\r\n\r\n        .pattern-buttons__button.bp3-file-input {\r\n          box-shadow: 0 0 0 1px rgba(16, 22, 26, 0.4);\r\n        }\r\n\r\n        .pattern-buttons .bp3-file-upload-input::after {\r\n          margin: 0;\r\n          width: 100%;\r\n          line-height: inherit;\r\n        }\r\n      `}\r\n      </style>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useSelector, shallowEqual } from 'react-redux'\r\nimport tinycolor from 'tinycolor2';\r\nimport { Divider } from '@blueprintjs/core';\r\nimport PatternOptions from './PatternOptions';\r\nimport { PATTERN_TYPES, defaultOptions } from './scatterplot/patterns/PatternManager';\r\nimport { defaultPatterns } from './constants';\r\n\r\n// gives you a new key when you call it.\r\nconst keyGen = (() => {\r\n  let i = 3;\r\n  return () => i++;\r\n})();\r\n\r\nfunction toHsvColor(hex) {\r\n  const hsvObj = tinycolor(hex).toHsv();\r\n  return [hsvObj.h / 360, hsvObj.s, hsvObj.v];\r\n}\r\n\r\nexport default function DataOptions({ scatterplot }) {\r\n  const categoryColors = useSelector((state) => state.categoryColors, shallowEqual);\r\n\r\n  const [patterns, setPatterns] = useState({\r\n    1: {...defaultPatterns[0], hsvColor: toHsvColor(categoryColors[0])},\r\n    2: {...defaultPatterns[1], hsvColor: toHsvColor(categoryColors[1])},\r\n\r\n    //1: defaultRadar(0, toHsvColor(categoryColors[0])),\r\n    //2: defaultPulse(1, toHsvColor(categoryColors[1]))\r\n  });\r\n\r\n  const maxCategories = useSelector((state) => state.maxCategories);\r\n\r\n  // TODO: effect when maxCategories change, add/remove patterns\r\n\r\n  useEffect(() => {\r\n    if (scatterplot !== null) {\r\n      scatterplot.patternManager.setAll(Object.keys(patterns).map((patternKey) => patterns[patternKey]));\r\n    }\r\n  }, [scatterplot, patterns])\r\n\r\n  const createSetPattern = (patternKey) => {\r\n    return (newPattern) => {\r\n      setPatterns((oldPatterns) => ({ ...oldPatterns, [patternKey]: { ...oldPatterns[patternKey], ...newPattern }}));\r\n    };\r\n  };\r\n\r\n  const addPattern = (category) => setPatterns((oldPatterns) => ({\r\n    ...oldPatterns,\r\n    [keyGen()]: {...defaultPatterns[category], hsvColor: toHsvColor(categoryColors[category])}\r\n    //[keyGen()]: defaultPulse(category, toHsvColor(categoryColors[category]))\r\n  }));\r\n\r\n  const removePattern = (patternKey) => setPatterns((oldPatterns) => {\r\n    const { [patternKey]: _, ...otherKeys } = oldPatterns; /* eslint-disable-line no-unused-vars */\r\n    return otherKeys;\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (maxCategories > 0) { // initial state\r\n      // try delete first\r\n      const categoriesToAdd = new Set(new Array(maxCategories).fill().map((_, i) => i));\r\n      Object.keys(patterns).forEach((patternKey) => {\r\n        const pattern = patterns[patternKey];\r\n        if (pattern.category >= maxCategories) removePattern(patternKey);\r\n        else categoriesToAdd.delete(pattern.category);\r\n      });\r\n\r\n      // try add\r\n      categoriesToAdd.forEach((category) => addPattern(category));\r\n    }\r\n  }, [maxCategories]);\r\n\r\n\r\n  const renderPatternOptions = Object.keys(patterns).map((patternKey) => (\r\n    <PatternOptions\r\n      key={patternKey}\r\n      patternKey={patternKey}\r\n      pattern={patterns[patternKey]}\r\n      setPattern={createSetPattern(patternKey)}\r\n    />\r\n  ));\r\n\r\n  return (\r\n    <div>\r\n      <Divider />\r\n      <p className=\"bp3-text-muted\" style={{ textAlign: 'center' }}>\r\n        Click on a pattern to show/hide options.\r\n      </p>\r\n      {renderPatternOptions}\r\n\r\n      <style jsx>{`\r\n        .data-add-new {\r\n          margin: 10px 0;\r\n          text-align: center;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Card, Tabs, Tab } from '@blueprintjs/core';\r\nimport ScatterplotOptions from './ScatterplotOptions';\r\nimport DataOptions from './DataOptions';\r\nimport PatternsOptions from './PatternsOptions';\r\n\r\nexport default function Sidebar({ scatterplot }) {\r\n  const isDarkTheme = useSelector((state) => state.isDarkTheme);\r\n\r\n  return (\r\n    <Card className={`card-sidebar ${isDarkTheme ? 'bp3-dark' : ''}`} elevation={2}>\r\n      <Tabs\r\n        id=\"sidebar-tabs\"\r\n      >\r\n        <Tab\r\n          title=\"Scatterplot\"\r\n          id=\"scatterplot-options-tab\"\r\n          panel={<ScatterplotOptions scatterplot={scatterplot} />}\r\n        />\r\n        <Tab\r\n          title=\"Data\"\r\n          id=\"data-options-tab\"\r\n          panel={<DataOptions scatterplot={scatterplot} />}\r\n        />\r\n        <Tab\r\n          title=\"Patterns\"\r\n          id=\"patterns-options-tab\"\r\n          panel={<PatternsOptions scatterplot={scatterplot} />}\r\n        />\r\n      </Tabs>\r\n      \r\n      <style jsx global>{`\r\n        .card-sidebar {\r\n          width: 300px;\r\n          border-radius: 0;\r\n          overflow-y: scroll;\r\n          overflow-x: hidden;\r\n        }\r\n\r\n        .bp3-tab-list {\r\n          justify-content: center;\r\n        }\r\n      `}</style>\r\n    </Card>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function Meta() {\r\n  return (\r\n    <>\r\n      <style jsx global>{`\r\n        html, body, #root {\r\n          margin: 0;\r\n          padding: 0;\r\n          width: 100%;\r\n          height: 100%;\r\n        }\r\n\r\n        .bp3-collapse-body {\r\n          padding: 10px 0;\r\n        }\r\n\r\n        .bp3-form-group {\r\n          margin-bottom: 0px;\r\n        }\r\n\r\n        .bp3-form-group.bp3-inline label.bp3-label {\r\n          margin-right: 20px;\r\n          min-width: 70px;\r\n        }\r\n\r\n        .circle-picker {\r\n          margin-top: 5px;\r\n        }\r\n\r\n        .option-title {\r\n          font-weight: 600;\r\n          text-transform: uppercase;\r\n          text-align: center;\r\n          display: block;\r\n          margin: 10px 0 5px 0;\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Spinner } from '@blueprintjs/core';\r\n\r\nexport default function LoadingOverlay() {\r\n  const isLoading = useSelector((state) => state.isLoading);\r\n\r\n  return (\r\n    <div className=\"overlay\" style={{ display: isLoading ? 'block' : 'none' }}>\r\n      <div className=\"container\">\r\n        <Spinner\r\n          size={200}\r\n        />\r\n        <span className=\"text bp3-text-muted\">\r\n          Loading\r\n        </span>\r\n      </div>\r\n      \r\n      <style jsx>\r\n      {`\r\n        .overlay {\r\n          position: absolute;\r\n          top: 0;\r\n          left: 0;\r\n          bottom: 0;\r\n          right: 0;\r\n          background-color: rgba(255, 255, 255, .2);\r\n          backdrop-filter: blur(3px);\r\n        }\r\n\r\n        .container {\r\n          position: absolute;\r\n          top: 50%;\r\n          left: 50%;\r\n          transform: translate3d(-50%, -50%, 0);\r\n          width: 200px;\r\n          height: 200px;\r\n          padding: 0px;\r\n          border-radius: 50%;\r\n          background-color: rgba(255, 255, 255, .05);\r\n          box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        .text {\r\n          font-weight: 600;\r\n          text-transform: uppercase;\r\n          font-size: 2em;\r\n          position: absolute;\r\n          top: 50%;\r\n          left: 50%;\r\n          transform: translate3d(-50%, -50%, 0);\r\n          text-shadow: 0px 0px 8px rgba(0,0,0,0.8);\r\n        }\r\n      `}\r\n      </style>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useCallback, useState } from 'react';\nimport { useSelector, shallowEqual } from 'react-redux'\nimport createScatterplot from './scatterplot';\nimport Sidebar from './Sidebar';\nimport Meta from './Meta';\nimport LoadingOverlay from './LoadingOverlay';\nimport { defaultValues } from './constants';\n\nfunction initScatterplot(canvas, setScatterplot, initColors) {\n  let { width, height } = canvas.getBoundingClientRect();\n\n  const lassoMinDelay = 10;\n  const lassoMinDist = 2;\n  const pointSize = defaultValues.pointSize;\n  const showRecticle = true;\n  const recticleColor = [1, 1, 0.878431373, 0.33];\n\n  const scatterplot = createScatterplot({\n    canvas,\n    width,\n    height,\n    lassoMinDelay,\n    lassoMinDist,\n    pointSize,\n    showRecticle,\n    recticleColor,\n  });\n\n  const resizeHandler = () => {\n    ({ width, height } = canvas.getBoundingClientRect());\n    scatterplot.set({ width, height });\n  };\n  window.addEventListener('resize', resizeHandler);\n\n  scatterplot.set({ colorBy: 'category', colors: initColors });\n  setScatterplot(scatterplot);\n}\n\nfunction App() {\n  const [scatterplot, setScatterplot] = useState(null);\n  const isDarkTheme = useSelector((state) => state.isDarkTheme);\n  const categoryColors = useSelector((state) => state.categoryColors, shallowEqual);\n  const canvasRef = useCallback((canvas) => {\n    initScatterplot(canvas, setScatterplot, categoryColors);\n  }, [setScatterplot]);\n\n  //const darkBg = '#10161A';\n  const darkBg = '#000000';\n  //const lightBg = '#efefef';\n  const lightBg = '#ffffff';\n\n  return (\n    <div className=\"App\">\n      <Meta />\n      <div className=\"content\">\n        <div className=\"canvas-wrapper\">\n          <canvas className=\"canvas\" ref={canvasRef}></canvas>\n        </div>\n      </div>\n      <Sidebar scatterplot={scatterplot} />\n      <LoadingOverlay />\n      <style jsx>{`\n        .App {\n          background-color: ${isDarkTheme ? darkBg : lightBg};\n          width: 100%;\n          height: 100%;\n          position: relative;\n          display: flex;\n        }\n\n        .content {\n          flex-grow: 1;\n          height: 100%;\n          position: relative;\n        }\n\n        .canvas-wrapper {\n          position: absolute;\n          top: 0;\n          right: 0;\n          bottom: 0;\n          left: 0;\n        }\n\n        .canvas {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux';\r\nimport categoryColors from './categoryColors';\r\nimport isDarkTheme from './isDarkTheme';\r\nimport isLoading from './isLoading';\r\nimport maxCategories from './maxCategories';\r\n\r\nexport default combineReducers({\r\n  categoryColors,\r\n  isDarkTheme,\r\n  isLoading,\r\n  maxCategories\r\n});\r\n","import { TOGGLE_THEME } from '../actions';\r\n\r\nexport default function isDarkTheme(state = true, action) {\r\n  if (action.type === TOGGLE_THEME)\r\n    return !state;\r\n  return state;\r\n}\r\n","import { SET_LOADING } from '../actions';\r\n\r\nexport default function isLoading(state = false, action) {\r\n  if (action.type === SET_LOADING)\r\n    return action.value;\r\n  return state;\r\n}\r\n","import { SET_MAX_CATEGORIES } from '../actions';\r\n\r\nexport default function maxCategories(state = 0, action) {\r\n  if (action.type === SET_MAX_CATEGORIES)\r\n    return action.value;\r\n  return state;\r\n}\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport { createStore } from 'redux';\nimport { Provider } from 'react-redux'\nimport * as serviceWorker from './serviceWorker';\nimport rootReducer from './reducers';\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(<Provider store={store}><App /></Provider>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}